!function(e){function t(t){for(var r,a,c=t[0],s=t[1],l=t[2],d=0,f=[];d<c.length;d++)a=c[d],i[a]&&f.push(i[a][0]),i[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(u&&u(t);f.length;)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==i[s]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={2:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise(function(t,r){n=i[e]=[t,r]});t.push(n[2]=r);var o,c=document.createElement("script");c.charset="utf-8",c.timeout=120,a.nc&&c.setAttribute("nonce",a.nc),c.src=function(e){return a.p+""+({1:"@atlaskit-internal_media-viewer-pdf-viewer"}[e]||e)+"/notes."+{1:"8aa56780ed18d05d67c9"}[e]+".js"}(e);var s=new Error;o=function(t){c.onerror=c.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,n[1](s)}i[e]=void 0}};var l=setTimeout(function(){o({type:"timeout",target:c})},12e4);c.onerror=c.onload=o,document.head.appendChild(c)}return Promise.all(t)},a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a.oe=function(e){throw console.error(e),e};var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=s;o.push([1,0]),n()}({"/KVF":function(e,t,n){var r={"./en":"7dT6","./en.json":"7dT6"};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id="/KVF"},"/kYV":function(e,t,n){},0:function(e,t){},1:function(e,t,n){n("201c"),n("7NIr"),e.exports=n("LiWt")},2:function(e,t){},3:function(e,t){},4:function(e,t){},"7dT6":function(e){e.exports=JSON.parse("{}")},LiWt:function(e,t,n){"use strict";n.r(t);n("/kYV");var r,i=n("q1tI"),o=n.n(i),a=n("SH7X"),c=n.n(a),s=n("i8i4"),l=n("buk/"),u=n("Zlyp"),d=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e};document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[role=application]").dataset,t=d(e.cozyIconPath,n("ZAKO")),i=d(e.cozyAppNamePrefix||n("pZg0").name_prefix,""),f=d(e.cozyAppName,n("pZg0").name),p=d(e.cozyAppSlug,n("pZg0").slug),h=d(e.cozyAppVersion,n("pZg0").version);r=d(e.cozyLocale,"en");var m=window.location?window.location.protocol:"https:",b=new c.a({uri:"".concat(m,"//").concat(e.cozyDomain),token:e.cozyToken,schema:u.c,appMetadata:{slug:p,version:h}});cozy.bar.init({appName:f,appNamePrefix:i,iconPath:t,lang:r,replaceTitleOnMobile:!0}),function(e){var t=n("pL5B").default;Object(s.render)(o.a.createElement(l.b,{lang:r,dictRequire:function(e){return n("/KVF")("./".concat(e))}},o.a.createElement(a.CozyProvider,{client:e},o.a.createElement(t,null))),document.querySelector("[role=application]"))}(b)})},ZAKO:function(e,t){e.exports="/img/icon.fb88641112cd58fc47c6da6668a1808a.svg"},Zlyp:function(e,t,n){"use strict";var r=n("q1tI"),i=n.n(r),o=n("V2U0"),a=n("55Ip"),c=n("SH7X"),s=n("vEVt"),l=n("KXWi"),u=n("y6ex"),d=n("kyGY"),f=n("o0o1"),p=n.n(f),h=n("Ty5D"),m="io.cozy.notes";function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(l){return void n(l)}c.done?t(s):Promise.resolve(s).then(r,i)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=function(e){function t(e,n){var r,i,o,a,c,s,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,o=y(t).call(this,e,n),r=!o||"object"!==b(o)&&"function"!=typeof o?g(i):o,c=g(r),s="handleClick",a=p.a.mark(function e(){var t,n,i;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState(function(){}),t=r.props.createDocument,e.next=4,t(m,{});case 4:n=e.sent,i=n.data,r.setState(function(){}),r.props.history.push("/n/".concat(i.id));case 8:case"end":return e.stop()}},e,this)}),l=function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function o(e){v(i,n,r,o,c,"next",e)}function c(e){v(i,n,r,o,c,"throw",e)}o(void 0)})},s in c?Object.defineProperty(c,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):c[s]=l,r.state={isWorking:!1},r}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,r["Component"]),n=t,(o=[{key:"render",value:function(){var e=this.state.isWorking;return i.a.createElement("div",null,i.a.createElement(l.a,{onClick:this.handleClick,type:"submit",busy:e,icon:"plus",label:"ajouter une note",extension:"narrow"}))}}])&&_(n.prototype,o),a&&_(n,a),t}(),x=Object(c.withMutations)()(Object(h.f)(w)),E=function(e){var t=e&&e.cozyMetadata&&e.cozyMetadata.createdAt;return t?"Note sans titre du ".concat(new Date(t).toLocaleString()):null},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;return e.title||(t instanceof Function?t(e):t)},O=function(e){return i.a.createElement("header",{className:"page-header-menu "+(e.className||"")},i.a.createElement("div",{className:"page-header-menu--left"},e.left),e.children,i.a.createElement("div",{className:"page-header-menu--right"},e.right))},S=n("4BeY"),P=n.n(S),T=n("IaFt"),C=n.n(T),z=new P.a({id:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d",use:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d">\n<style type="text/css">\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st0{fill-rule:evenodd;clip-rule:evenodd;fill:#ACF5F7;}\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st1{fill-rule:evenodd;clip-rule:evenodd;fill:#0DCBCF;}\n</style>\n<g transform="translate(2)">\n\t<path class="st0" d="M0,2c0-1.1,0.9-2,2-2h22c1.1,0,2,0.9,2,2v28c0,1.1-0.9,2-2,2H2c-1.1,0-2-0.9-2-2V2z" />\n\t<path class="st1" d="M6,8h14v2H6V8z M6,12h8v2H6V12z M6,16h14v2H6V16z M6,20h10v2H6V20z" />\n</g>\n<g transform="translate(0 4)">\n\t<path class="st1" d="M1.5,0h2C4.3,0,5,0.7,5,1.5l0,0C5,2.3,4.3,3,3.5,3h-2C0.7,3,0,2.3,0,1.5l0,0C0,0.7,0.7,0,1.5,0z" />\n\t<path class="st1" d="M1.5,7h2C4.3,7,5,7.7,5,8.5l0,0C5,9.3,4.3,10,3.5,10h-2C0.7,10,0,9.3,0,8.5l0,0C0,7.7,0.7,7,1.5,7z" />\n\t<path class="st1" d="M1.5,14h2C4.3,14,5,14.7,5,15.5l0,0C5,16.3,4.3,17,3.5,17h-2C0.7,17,0,16.3,0,15.5l0,0C0,14.7,0.7,14,1.5,14z" />\n\t<path class="st1" d="M1.5,21h2C4.3,21,5,21.7,5,22.5l0,0C5,23.3,4.3,24,3.5,24h-2C0.7,24,0,23.3,0,22.5l0,0C0,21.7,0.7,21,1.5,21z" />\n</g>\n<g>\n\t<path class="st1" d="M31.4,18.4l-2.8-2.8c0.8-0.8,2-0.8,2.8,0S32.2,17.6,31.4,18.4z" />\n\t<path class="st1" d="M30.7,19.1L20.8,29l-2.5,0.9c-0.5,0.2-1.1-0.1-1.3-0.6c-0.1-0.2-0.1-0.5,0-0.7l0.9-2.5l9.9-9.9L30.7,19.1z" />\n</g>\n</symbol>'}),N=(C.a.add(z),z),I=function(e){return i.a.createElement("div",{className:"note-item"},i.a.createElement(u.a,{icon:N,width:32,height:32,className:"note-icon"}),i.a.createElement(a.b,{to:"/n/".concat(e.note.id),className:"note-link"},i.a.createElement(s.a,{primaryText:k(e.note),secondaryText:"/Notes/2019/demo"})))},D=function(e){var t=new Date(e.note.cozyMetadata.updatedAt).toLocaleDateString(void 0,{day:"numeric",month:"long",year:"numeric"});return i.a.createElement("tr",{className:"c-table-row"},i.a.createElement("th",{className:"c-table-cell c-table-cell--primary"},i.a.createElement(I,e)),i.a.createElement("td",{className:"c-table-cell"},i.a.createElement("time",{datatime:e.note.cozyMetadata.updatedAt},t)),i.a.createElement("td",{className:"c-table-cell"},"—"),i.a.createElement("td",{className:"c-table-cell"},i.a.createElement(l.a,{theme:"action",extension:"narrow",icon:i.a.createElement(u.a,{icon:"dots",color:"coolGrey",width:"17",height:"17"}),iconOnly:!0,label:"actions"})))},M=function(e){var t=e.notes;return t&&t.length?i.a.createElement("table",{className:"notes-list c-table"},i.a.createElement("thead",{className:"c-table-head"},i.a.createElement("tr",{className:"c-table-row-head"},i.a.createElement("th",{className:"c-table-header"},"Nom"),i.a.createElement("th",{className:"c-table-header"},"Dernière mise à jour"),i.a.createElement("th",{className:"c-table-header"},"Partages"),i.a.createElement("th",{className:"c-table-header"}))),i.a.createElement("tbody",null,t.map(function(e){return i.a.createElement(D,{key:e._id,note:e})}))):null},A=Object(c.queryConnect)({notes:{query:function(e){return e.find(m).where({}).sortBy({"cozyMetadata.updatedAt":"desc"})},as:"notes"}})(function(e){var t=e.notes,n=t.data,r=t.fetchStatus,a="loading"===r||"pending"===r;return i.a.createElement("div",{className:"notes notes-list-container"},a?i.a.createElement(o.a,{size:"xxlarge",middle:!0}):i.a.createElement("div",null,i.a.createElement(O,{left:i.a.createElement(d.b,{tag:"h1"},"Mes notes"),right:i.a.createElement(x,null)}),i.a.createElement(M,{notes:n})))}),q=n("bfWj"),V=n("9/5/"),L=n.n(V),R=n("k4o+"),B=n("9jEr"),F=n("jWvl"),Z={allowTables:!0,allowRule:!0,allowLists:!0,allowTextColor:!0,allowPanel:!0};function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function U(e){e.style.height="inherit",e.style.height="".concat(e.scrollHeight,"px")}function H(e){var t=e.defaultValue,n=e.onTitleChange,o=e.onContentChange,c=e.defaultTitle,s=e.collabProvider,u=Object(r.useRef)(null),f=Object(r.useCallback)(function(e){U(e.target),n&&n(e)},[n]);Object(r.useEffect)(function(){return U(u.current)},[]);var p=i.a.createElement(i.a.Fragment,null,i.a.createElement(l.a,{icon:"previous",tag:a.b,to:"/",className:"sto-app-back",subtle:!0}));return i.a.createElement("article",{className:"note-article"},i.a.createElement("style",null,"#coz-bar ","{ display: none }"),i.a.createElement(O,{left:p,className:"note-header-menu--editing"}),i.a.createElement("section",{className:"note-editor-container"},i.a.createElement(R.a,Q({collabEdit:s,onChange:o,defaultValue:t.content},Z,{appearance:"full-page",placeholder:"Que voulez-vous dire ?",shouldFocus:!0,contentComponents:i.a.createElement(B.a,{render:function(){return i.a.createElement(d.b,{tag:"h1",className:"note-title"},i.a.createElement(F.a,{ref:u,rows:"1",fullwidth:!0,defaultValue:t.title,onChange:f,readOnly:!n,placeholder:c,className:"note-title-input"}))}})}))))}function K(){var e=i.a.createElement(l.a,{icon:"back",tag:a.b,to:"/",className:"sto-app-back",label:"Retour à la liste",subtle:!0});return i.a.createElement("div",null,i.a.createElement(O,{left:e}),i.a.createElement(o.a,{size:"xxlarge",middle:!0}))}var W=n("cjKa"),J=n("O1Kf"),G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"color:blue;font-weight:bold;";console.log("%cCollab-Edit: ".concat(e),n),t&&console.log(t)};function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(l){return void n(l)}c.done?t(s):Promise.resolve(s).then(r,i)}function $(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){Y(o,r,i,a,c,"next",e)}function c(e){Y(o,r,i,a,c,"throw",e)}a(void 0)})}}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var te=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.service=n,this.eventEmitter=new W.EventEmitter2}var t,n,r,i,o,a,c,s;return t=e,(n=[{key:"getDocument",value:(s=$(p.a.mark(function e(t,n){var r,i,o,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this.config.docId,e.next=4,this.service.getDoc(r,t,n);case 4:return i=e.sent,o=i.doc,a=i.version,e.abrupt("return",{doc:o,version:a});case 10:return e.prev=10,e.t0=e.catch(0),G('Collab-Edit: Document "'.concat(this.config.docId,'" does not exist. Creating one locally.')),e.abrupt("return",{doc:{type:"doc",content:[{type:"paragraph"}]},version:1});case 14:case"end":return e.stop()}},e,this,[[0,10]])})),function(e,t){return s.apply(this,arguments)})},{key:"connect",value:(c=$(p.a.mark(function e(t,n){var r,i,o,a,c=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.config.docId,e.next=3,this.getDocument(t,n);case 3:i=e.sent,o=i.doc,a=i.version,this.service.join(r),this.service.onStepsCreated(r,function(e){G("Received FPS-payload",e),c.emit("data",e)}),this.service.onTelepointerUpdated(r,function(e){G("Received telepointer-payload",{payload:e}),c.emit("telepointer",e)}),this.eventEmitter.emit("connected",{doc:o,version:a});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"debounce",value:function(e){var t=this;G("Debouncing steps"),this.debounced&&clearTimeout(this.debounced),this.debounced=window.setTimeout(function(){G("Sending debounced"),t.sendSteps(e(),e)},250)}},{key:"sendSteps",value:(a=$(p.a.mark(function e(t,n,r){var i,o,a,c,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.config.docId,!this.isSending){e.next=4;break}return this.debounce(n),e.abrupt("return");case 4:if(void 0!==X(o=Object(J.getVersion)(t))){e.next=7;break}return e.abrupt("return");case 7:if(a=r||Object(J.sendableSteps)(t)||{steps:[]},0!==(c=a.steps).length){e.next=11;break}return G("No steps to send. Aborting."),e.abrupt("return");case 11:return this.isSending=!0,e.prev=12,this.isSending=!1,e.next=16,this.service.pushSteps(i,o,c);case 16:s=e.sent,G("Steps sent and accepted by service."),this.emit("data",s),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(12),this.debounce(n),this.isSending=!1,G('Error sending steps: "'.concat(e.t0,'"'));case 26:case"end":return e.stop()}},e,this,[[12,21]])})),function(e,t,n){return a.apply(this,arguments)})},{key:"getSteps",value:(o=$(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.docId,e.next=3,this.service.getSteps(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"sendTelepointer",value:(i=$(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.docId,G("Sending telepointer",t),e.next=4,this.service.pushTelepointer(n,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}}])&&ee(t.prototype,n),r&&ee(t,r),e}();function ne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){i=!0,o=s}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function re(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(l){return void n(l)}c.done?t(s):Promise.resolve(s).then(r,i)}function ie(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ce=new q.a,se=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae(this,"processRemoteData",function(e,t){if(!r.pauseQueue||t){var n=e.version,i=e.steps;if(G("Processing data. Version: ".concat(n)),i&&i.length){var o=i.map(function(e){return e.userId||e.sessionId});r.emit("data",{json:i,version:n,userIds:o})}r.processQeueue()}else G("Queue is paused. Aborting.")}),ae(this,"onReceiveData",function(e,t){var n=Object(J.getVersion)(r.getState()),i=n+e.steps.length;e.version===n?G("Received data we already have. Ignoring."):e.version===i?r.processRemoteData(e,t):e.version>i&&(G("Version too high. Expected ".concat(i," but got ").concat(e.version,". Current local version is ").concat(n)),r.queueData(e))}),ae(this,"onReceiveTelepointer",function(e){var t=e.sessionId;if(t!==r.config.userId){var n=r.participants.get(t);n&&n.lastActive>e.timestamp?G("Old telepointer event. Ignoring."):(r.updateParticipant(t,e.timestamp),G("Remote telepointer from ".concat(t)),r.emit("telepointer",e))}}),this.config=t,this.channel=t.channel||new te(t,n),this.eventEmitter=new W.EventEmitter2,this.queue=[],this.getState=function(){},this.participants=new Map,this.pauseQueue=!1}var t,n,r,i,o;return t=e,(n=[{key:"initialize",value:function(e){var t=this;this.getState=e,this.channel.on("connected",function(e){var n=e.doc,r=e.version,i=t.config.userId;G("Joined collab-session. The document version is ".concat(r)),t.emit("init",{sid:i,doc:n,version:r}),t.emit("connected",{sid:i})}),this.channel.on("data",this.onReceiveData),this.channel.on("telepointer",this.onReceiveTelepointer);var n=e(),r=ce.encode(n.doc),i=r.version;return this.channel.connect(i,r),this}},{key:"send",value:function(e,t,n){e.steps&&e.steps.length&&this.channel.sendSteps(n,this.getState)}},{key:"sendMessage",value:function(e){if(e)switch(e.type){case"telepointer":this.channel.sendTelepointer(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ae(e,t,n[t])})}return e}({},e,{timestamp:(new Date).getTime()}))}}},{key:"queueData",value:function(e){var t=this;G("Queuing data for version ".concat(e.version));var n=[].concat(ie(this.queue),[e]).sort(function(e,t){return e.version>t.version?1:-1});this.queue=n,this.queueTimeout||this.pauseQueue||(this.queueTimeout=window.setTimeout(function(){t.catchup()},1e3))}},{key:"catchup",value:(i=p.a.mark(function e(){var t,n,r,i,o,a,c,s,l;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseQueue=!0,G("Too far behind - fetching data from service"),t=Object(J.getVersion)(this.getState()),e.prev=3,e.next=6,this.channel.getSteps(t);case 6:n=e.sent,r=n.doc,i=n.version,o=n.steps,this.queue=this.queue.filter(function(e){return e.version>i}),r?(G("Replacing document."),a=this.config.userId,c=Object(J.sendableSteps)(this.getState())||{},s=c.steps,l=void 0===s?[]:s,this.emit("init",{sid:a,doc:r,version:i}),l.length&&this.emit("local-steps",{steps:l}),clearTimeout(this.queueTimeout),this.pauseQueue=!1,this.queueTimeout=void 0):o&&(G("Applying the new steps. Version: ".concat(i),o),this.onReceiveData({steps:o,version:i},!0),clearTimeout(this.queueTimeout),this.pauseQueue=!1,this.queueTimeout=void 0),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),G("Unable to get latest steps: ".concat(e.t0));case 17:case"end":return e.stop()}},e,this,[[3,14]])}),o=function(){var e=this,t=arguments;return new Promise(function(n,r){var o=i.apply(e,t);function a(e){re(o,n,r,a,c,"next",e)}function c(e){re(o,n,r,a,c,"throw",e)}a(void 0)})},function(){return o.apply(this,arguments)})},{key:"processQeueue",value:function(){if(this.pauseQueue)G("Queue is paused. Aborting.");else if(G("Looking for proccessable data"),0!==this.queue.length){var e=ne(this.queue,1)[0],t=Object(J.getVersion)(this.getState())+e.steps.length;e.version===t&&(G("Applying data from queue!"),this.queue.splice(0,1),this.processRemoteData(e))}}},{key:"updateParticipant",value:function(e,t){var n=this,r=function(e){return{userId:e,name:e,avatar:"https://api.adorable.io/avatars/80/".concat(e.replace(/[^a-zA-Z0-9]/g,""),".png"),email:"".concat(e.replace(/\s+/g,".").replace(/[^a-zA-Z0-9.]/g,""),".toLocaleLowerCase()}@mycozy.cloud")}}(e),i=r.name,o=void 0===i?"":i,a=r.email,c=void 0===a?"":a,s=r.avatar,l=void 0===s?"":s;this.participants.set(e,{name:o,email:c,avatar:l,sessionId:e,lastActive:t});var u=[this.participants.get(e)],d=(new Date).getTime(),f=Array.from(this.participants.values()).filter(function(e){return(d-e.lastActive)/1e3>300});f.forEach(function(e){return n.participants.delete(e.sessionId)}),this.emit("presence",{joined:u,left:f})}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}}])&&oe(t.prototype,n),r&&oe(t,r),e}(),le=n("gFX4"),ue=n.n(le);function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){fe(e,t,n[t])})}return e}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(l){return void n(l)}c.done?t(s):Promise.resolve(s).then(r,i)}function he(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){pe(o,r,i,a,c,"next",e)}function c(e){pe(o,r,i,a,c,"throw",e)}a(void 0)})}}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var be=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.url,r=t.sessionId;this.sessionId=r,this.socket=ue.a.connect(n)}var t,n,r,i,o,a,c,s,l,u;return t=e,(n=[{key:"join",value:(u=he(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.socket.emit("join",this.sessionId,t);case 1:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"onStepsCreated",value:(l=he(p.a.mark(function e(t,n){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.socket.on("steps:created:".concat(t),function(e){return n(e)});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(s=he(p.a.mark(function e(t,n){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.socket.on("telepointer:updated:".concat(t),function(e){return n(e)});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getDoc",value:(c=he(p.a.mark(function e(t,n,r){var i=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){i.socket.emit("doc:get",i.sessionId,t,1,r,function(n){return e(de({},n,{docId:t}))})}));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return c.apply(this,arguments)})},{key:"getSteps",value:(a=he(p.a.mark(function e(t,n){var r=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){r.socket.emit("steps:get",r.sessionId,t,n,function(n){return e(de({},n,{docId:t}))})}));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"pushSteps",value:(o=he(p.a.mark(function e(t,n,r){var i=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,o){i.socket.emit("steps:push",i.sessionId,t,n,r,function(n){n?e(de({},n,{docId:t})):o("Probable conflict")})}));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"pushTelepointer",value:(i=he(p.a.mark(function e(t,n){var r=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){r.socket.emit("telepointer:push",r.sessionId,t,n,function(n){return e(de({},n,{docId:t}))})}));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})}])&&me(t.prototype,n),r&&me(t,r),e}();function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_e(e,t,n[t])})}return e}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ye=new q.a,ge=Object(c.withMutations)()(function(e){var t=e.autoSave,n=Object(r.useMemo)(function(){return{title:e.note.title,content:e.note.content}},[e.note._id]),o=Object(r.useMemo)(function(){return e.note.defaultTitle||E(e.note)},[e.note._id]),a=Object(r.useMemo)(function(){return"user".concat(Math.floor(1e3*Math.random()))},[]),c=a,s=e.note._id,l=Object(r.useMemo)(function(){return{useNativePlugin:!0,provider:Promise.resolve(new se({docId:s,userId:a,sessionId:c},new be({url:"https://poc-collab.cozycloud.cc/",docId:s,userId:a,sessionId:c}))),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!0,userId:a}},[e.note._id,a]),u=Object(r.useRef)(e.note);Object(r.useEffect)(function(){u.current=e.note},[e.note._rev]);var d=Object(r.useRef)({title:e.note.title,content:e.note.content}),f=Object(r.useMemo)(function(){return L()(function(){return e.saveDocument(ve({},u.current,d.current))},5e3,{leading:!0,trailing:!0})},[e.note._id]);Object(r.useEffect)(function(){return function(){return f.flush()}},[e.note._id]);var p=Object(r.useCallback)(function(e){var t=e.target.value,n=t&&t.trim().length>0?t:null;n!=d.current.title&&(d.current=ve({},d.current,{title:n}),window.setTimeout(function(){return f()}))},[e.note._id]),h=Object(r.useCallback)(function(e){var t=JSON.stringify(ye.encode(e.state.doc),null,2);t!=d.current.content&&(d.current=ve({},d.current,{content:t}),window.setTimeout(function(){return f()}))},[e.note._id]);return Object(r.useMemo)(function(){return i.a.createElement(H,{onTitleChange:t?p:void 0,onContentChange:t?h:void 0,collabProvider:l,defaultTitle:o,defaultValue:n})},[e.note._id])}),je=function(e){var t=e.notes,n=t.data,o=t.fetchStatus,a="loading"===o||"pending"===o,c=n&&n[0],s=Object(r.useMemo)(function(){return{_id:e.id,id:e.id,title:"Note collaborative"}},[e.id,!0]),l=c||s;return a||l||window.setTimeout(function(){return e.history.push("/")},0),a||!l?i.a.createElement(K,null):i.a.createElement(ge,{note:l,autoSave:!!c})},we=function(e){var t=e.match.params.id,n=Object(c.queryConnect)({notes:{query:function(e){return e.find(m).where({_id:t})},as:"notes"}})(Object(h.f)(je));return i.a.createElement(n,{id:t})},xe={notes:{doctype:m,doctypeVersion:1,attributes:{},relationships:{}}};n.d(t,"b",function(){return A}),n.d(t,"a",function(){return we}),n.d(t,"c",function(){return xe})},nw0P:function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"kOWh","./ar/build_distance_in_words_locale/index.js":"XxX6","./ar/build_format_locale/index.js":"alis","./ar/index.js":"EDRf","./be/build_distance_in_words_locale/index.js":"LQ09","./be/build_format_locale/index.js":"kj7F","./be/index.js":"YEhR","./bg/build_distance_in_words_locale/index.js":"7K3h","./bg/build_format_locale/index.js":"RrdL","./bg/index.js":"isx8","./ca/build_distance_in_words_locale/index.js":"wqqj","./ca/build_format_locale/index.js":"qcV0","./ca/index.js":"Vwa+","./cs/build_distance_in_words_locale/index.js":"ZKDM","./cs/build_format_locale/index.js":"ipyF","./cs/index.js":"dvhP","./da/build_distance_in_words_locale/index.js":"2Mgc","./da/build_format_locale/index.js":"Gned","./da/index.js":"7ur/","./de/build_distance_in_words_locale/index.js":"5IWf","./de/build_format_locale/index.js":"THCn","./de/index.js":"bgw5","./el/build_distance_in_words_locale/index.js":"o/GB","./el/build_format_locale/index.js":"8T9h","./el/index.js":"dH0v","./en/build_distance_in_words_locale/index.js":"LZbM","./en/build_format_locale/index.js":"6DAA","./en/index.js":"Us+F","./eo/build_distance_in_words_locale/index.js":"qrnn","./eo/build_format_locale/index.js":"Bl15","./eo/index.js":"UB7v","./es/build_distance_in_words_locale/index.js":"GEfZ","./es/build_format_locale/index.js":"O+zC","./es/index.js":"/S0t","./fi/build_distance_in_words_locale/index.js":"VHtQ","./fi/build_format_locale/index.js":"Oydx","./fi/index.js":"ndVD","./fil/build_distance_in_words_locale/index.js":"uq4p","./fil/build_format_locale/index.js":"d7hw","./fil/index.js":"pNfm","./fr/build_distance_in_words_locale/index.js":"IzMR","./fr/build_format_locale/index.js":"I3Zg","./fr/index.js":"LKA2","./hr/build_distance_in_words_locale/index.js":"DPvn","./hr/build_format_locale/index.js":"puw3","./hr/index.js":"L9Jq","./hu/build_distance_in_words_locale/index.js":"w2RQ","./hu/build_format_locale/index.js":"/0iD","./hu/index.js":"Nm+E","./id/build_distance_in_words_locale/index.js":"JbvB","./id/build_format_locale/index.js":"0wlw","./id/index.js":"A6C3","./is/build_distance_in_words_locale/index.js":"qzMC","./is/build_format_locale/index.js":"S3yD","./is/index.js":"N4bE","./it/build_distance_in_words_locale/index.js":"MDEp","./it/build_format_locale/index.js":"aUJd","./it/index.js":"hmb4","./ja/build_distance_in_words_locale/index.js":"nNvt","./ja/build_format_locale/index.js":"buui","./ja/index.js":"uAXs","./ko/build_distance_in_words_locale/index.js":"oEw+","./ko/build_format_locale/index.js":"9SQf","./ko/index.js":"iW8+","./mk/build_distance_in_words_locale/index.js":"nmwZ","./mk/build_format_locale/index.js":"htxJ","./mk/index.js":"GzBU","./nb/build_distance_in_words_locale/index.js":"SL1f","./nb/build_format_locale/index.js":"CJ5F","./nb/index.js":"73vv","./nl/build_distance_in_words_locale/index.js":"Uyu0","./nl/build_format_locale/index.js":"doCD","./nl/index.js":"hCQt","./pl/build_distance_in_words_locale/index.js":"FUBD","./pl/build_format_locale/index.js":"nOYf","./pl/index.js":"B6yL","./pt/build_distance_in_words_locale/index.js":"aTPA","./pt/build_format_locale/index.js":"TTT0","./pt/index.js":"gdks","./ro/build_distance_in_words_locale/index.js":"gI+A","./ro/build_format_locale/index.js":"njjO","./ro/index.js":"r2yp","./ru/build_distance_in_words_locale/index.js":"KmPx","./ru/build_format_locale/index.js":"UUBw","./ru/index.js":"nz/o","./sk/build_distance_in_words_locale/index.js":"q2Bs","./sk/build_format_locale/index.js":"9sxn","./sk/index.js":"Wqan","./sl/build_distance_in_words_locale/index.js":"mlv2","./sl/build_format_locale/index.js":"vHkZ","./sl/index.js":"KYSo","./sr/build_distance_in_words_locale/index.js":"LlkS","./sr/build_format_locale/index.js":"RhjJ","./sr/index.js":"7mU3","./sv/build_distance_in_words_locale/index.js":"UNBN","./sv/build_format_locale/index.js":"zTNB","./sv/index.js":"hxgj","./th/build_distance_in_words_locale/index.js":"XAGa","./th/build_format_locale/index.js":"We2s","./th/index.js":"Pk+z","./tr/build_distance_in_words_locale/index.js":"aFZF","./tr/build_format_locale/index.js":"jh7A","./tr/index.js":"3ZWG","./zh_cn/build_distance_in_words_locale/index.js":"KdB7","./zh_cn/build_format_locale/index.js":"l4EP","./zh_cn/index.js":"8tMq","./zh_tw/build_distance_in_words_locale/index.js":"vyyr","./zh_tw/build_format_locale/index.js":"uYH7","./zh_tw/index.js":"QPlQ"};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id="nw0P"},pL5B:function(e,t,n){"use strict";n.r(t),function(e){var r=n("q1tI"),i=n.n(r),o=n("0cfB"),a=n("55Ip"),c=n("Ty5D"),s=n("jDpt"),l=n("le8I"),u=n("Zlyp");t.default=Object(o.hot)(e)(function(){return i.a.createElement(a.a,null,i.a.createElement(s.b,{monoColumn:!0},i.a.createElement(s.c,null,i.a.createElement(s.a,{className:"app-content"},i.a.createElement(c.c,null,i.a.createElement(c.a,{path:"/n/:id",component:u.a}),i.a.createElement(c.a,{path:"/",component:u.b})))),i.a.createElement(l.a,null)))})}.call(this,n("3UD+")(e))},pZg0:function(e,t){e.exports={name:"Cozy Notes",slug:"notes",icon:"icon.svg",categories:[],version:"1.0.8",licence:"AGPL-3.0",editor:"",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"edas",url:"https://eric.daspet.name/"},routes:{"/":{folder:"/",index:"index.html",public:!1}},permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},notes:{description:"Notes",type:"io.cozy.notes"}}}}});