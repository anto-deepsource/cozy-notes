!function(e){function t(t){for(var r,o,s=t[0],c=t[1],u=t[2],d=0,f=[];d<s.length;d++)o=s[d],i[o]&&f.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);f.length;)f.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={2:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise(function(t,r){n=i[e]=[t,r]});t.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({1:"@atlaskit-internal_media-viewer-pdf-viewer"}[e]||e)+"/notes."+{1:"637d53b05e492464016e"}[e]+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var u=setTimeout(function(){a({type:"timeout",target:s})},12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([1,0]),n()}({"/KVF":function(e,t,n){var r={"./en":"7dT6","./en.json":"7dT6","./fr":"9pOX","./fr.json":"9pOX"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="/KVF"},"/kYV":function(e,t,n){},0:function(e,t){},1:function(e,t,n){n("201c"),n("7NIr"),e.exports=n("LiWt")},2:function(e,t){},3:function(e,t){},"7dT6":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"EditorLoading":{"back_to_list":"Back to the list"},"EditorView":{"main_placeholder":"Write anything…"},"Editor":{"title_placeholder":"Here is your title"}},"Error":{"unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this share. You can no longer edit a note at this address."}}')},"9pOX":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"EditorLoading":{"back_to_list":"Retour à la liste"},"EditorView":{"main_placeholder":"Écrivez ce que vous souhaitez…"},"Editor":{"title_placeholder":"Ici votre titre"}},"Error":{"unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriétaire a peut-être révoqué ce partage. Vous ne pouvez plus éditer de note à cette adresse."}}')},LiWt:function(e,t,n){"use strict";n.r(t);n("/kYV");var r,i=n("q1tI"),a=n.n(i),o=n("JRPe"),s=n("SH7X"),c=n.n(s),u=n("i8i4"),l=n("buk/"),d=n("ZNGu");function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var p={en:{react:n("PTt1"),atlaskit:n("eFxx").default},fr:{react:n("Z6Ro"),atlaskit:n("XCed").default}};Object(o.d)(p.en.react),Object(o.d)(p.fr.react);var h=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e};document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[role=application]").dataset,t=h(e.cozyIconPath,n("ZAKO")),i=h(e.cozyAppNamePrefix||n("pZg0").name_prefix,""),v=h(e.cozyAppName,n("pZg0").name),b=h(e.cozyAppSlug,n("pZg0").slug),m=h(e.cozyAppVersion,n("pZg0").version);r=h(e.cozyLocale,"en");var y=window.location?window.location.protocol:"https:",g=e.cozyToken,_=!!window.location.search.substring(1).split("&").map(function(e){return e.split("=")}).reduce(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=f(arguments.length>1?arguments[1]:void 0,2),n=t[0],r=t[1],i=void 0===r||r;return e[n]=i,e},{}).sharecode,w=new c.a({uri:"".concat(y,"//").concat(e.cozyDomain),token:g,appMetadata:{slug:b,version:m}});_||cozy.bar.init({appName:v,appNamePrefix:i,iconPath:t,lang:r,replaceTitleOnMobile:!0,cozyClient:w,isPublic:_}),function(e,t){var i=n("pL5B").default;Object(u.render)(a.a.createElement(l.b,{lang:r,dictRequire:function(e){return n("/KVF")("./".concat(e))}},a.a.createElement(o.c,{locale:r,messages:p[r].atlaskit},a.a.createElement(s.CozyProvider,{client:e},a.a.createElement(d.a.Provider,{value:t},a.a.createElement(i,{isPublic:t}))))),document.querySelector("[role=application]"))}(w,_)})},ZAKO:function(e,t){e.exports="/img/icon.fb88641112cd58fc47c6da6668a1808a.svg"},ZNGu:function(e,t,n){"use strict";var r=n("q1tI"),i=n.n(r).a.createContext(!1);t.a=i},Zlyp:function(e,t,n){"use strict";var r=n("q1tI"),i=n.n(r),a=n("kyGY"),o=n("o0o1"),s=n.n(o),c=n("SH7X"),u=n("Ty5D"),l=n("KXWi"),d=n("buk/"),f=n("byeC"),p=[["doc",{content:"(block)+",marks:"link"}],["paragraph",{content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",parseDOM:[{tag:"ul"}]}],["orderedList",{group:"block",content:"listItem+",parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph ) (paragraph | bulletList | orderedList )*",defining:!0,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList)+",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["tableHeader",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"",parseDOM:[{tag:"th"}]}],["tableRow",{content:"(tableCell | tableHeader)+",tableRole:"row",parseDOM:[{tag:"tr"}]}],["tableCell",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}]],h=[["link",{excludes:"color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{style:"font-weight"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{excludes:"searchQuery",inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}]];function v(e){return e.reduce(function(e,t){return e[t[0]]=t[1],e},{})}var b={nodes:p,marks:h},m={nodes:v(p),marks:v(h)},y=(new f.Schema(m),n("snnE"));function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=function(e){function t(e,n){var r,i,a,o,c,u,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=j(t).call(this,e,n),r=!a||"object"!==g(a)&&"function"!=typeof a?k(i):a,c=k(r),u="handleClick",o=s.a.mark(function e(){var t,n,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState(function(){}),t=r.props.client,e.next=4,t.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:b}}});case 4:n=e.sent,i=n.data,r.setState(function(){}),window.location.href=Object(y.a)(i);case 8:case"end":return e.stop()}},e,this)}),l=function(){var e=this,t=arguments;return new Promise(function(n,r){var i=o.apply(e,t);function a(e){_(i,n,r,a,s,"next",e)}function s(e){_(i,n,r,a,s,"throw",e)}a(void 0)})},u in c?Object.defineProperty(c,u,{value:l,enumerable:!0,configurable:!0,writable:!0}):c[u]=l,r.state={isWorking:!1},r}var n,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,r["Component"]),n=t,(a=[{key:"render",value:function(){var e=this.state.isWorking,t=this.props.t;return i.a.createElement("div",null,i.a.createElement(l.c,{onClick:this.handleClick,type:"submit",busy:e,icon:"plus",label:t("Notes.Add.add_note"),extension:"narrow"}))}}])&&w(n.prototype,a),o&&w(n,o),t}(),S=Object(d.c)()(Object(c.withClient)(Object(u.f)(O))),E=function(e){return i.a.createElement("header",{className:"page-header-menu "+(e.className||"")},i.a.createElement("div",{className:"page-header-menu--left"},e.left),e.children,i.a.createElement("div",{className:"page-header-menu--right"},e.right))},C=function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(E,{left:i.a.createElement(a.b,{tag:"h1"},"Mes notes"),right:i.a.createElement(S,null)}))},I=n("k4o+"),P=n("9jEr"),T=n("jWvl"),D={allowTables:!0,allowRule:!0,allowLists:!0,allowTextColor:!0,allowPanel:!0},z=n("55Ip"),M=n("ZNGu");function A(e){var t=e.returnUrl,n=Object(r.useContext)(M.a);return t?i.a.createElement(l.b,{icon:"previous",href:t,className:"sto-app-back",subtle:!0}):n?null:i.a.createElement(l.a,{icon:"previous",tag:z.b,to:"/",className:"sto-app-back",subtle:!0})}function q(){return(q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e){e.style.height="inherit",e.style.height="".concat(e.scrollHeight,"px")}var U=Object(d.c)()(function(e){var t=e.defaultValue,n=e.onTitleChange,o=e.onContentChange,s=e.defaultTitle,c=e.title,u=e.collabProvider,l=e.returnUrl,d=e.t,f=Object(r.useRef)(null),p=Object(r.useCallback)(function(e){N(e.target),n&&n(e)},[n]);return Object(r.useEffect)(function(){return N(f.current)},[]),i.a.createElement("article",{className:"note-article"},i.a.createElement("style",null,"#coz-bar ","{ display: none }"),i.a.createElement(E,{left:i.a.createElement(A,{returnUrl:l}),className:"note-header-menu--editing",right:e.actions}),i.a.createElement("section",{className:"note-editor-container"},i.a.createElement(I.a,q({collabEdit:u,onChange:o,defaultValue:t},D,{appearance:"full-page",placeholder:d("Notes.EditorView.main_placeholder"),shouldFocus:!0,contentComponents:i.a.createElement(P.a,{render:function(){return i.a.createElement(a.b,{tag:"h1",className:"note-title"},i.a.createElement(T.a,{ref:f,rows:"1",fullwidth:!0,value:c,onChange:p,placeholder:s,className:"note-title-input"}))}})}))))}),L=n("V2U0");var R=Object(d.c)()(function(e){var t=e.t,n=i.a.createElement(l.c,{icon:"back",tag:z.b,to:"/",className:"sto-app-back",label:t("Notes.EditorLoading.back_to_list"),subtle:!0});return i.a.createElement("div",null,i.a.createElement(E,{left:n}),i.a.createElement(L.a,{size:"xxlarge",middle:!0}))}),Q=n("UmWK"),B=n("AQIY");function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=Object(B.a)(Q.c);function W(e){var t=Object(r.useMemo)(function(){var t=e.fileId||e.file.id||e.file._id,n=e.file&&(e.file.type||e.file._type)||"io.cozy.files";return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Z(e,t,n[t])})}return e}({_id:t,id:t,_type:n,type:n},e.file||{})}),n=V(Object(r.useState)(!1),2),a=n[0],o=n[1],s=Object(r.useCallback)(function(){return o(!a)},[]),c=Object(r.useCallback)(function(){return o(!1)},[]),u=t.id;return i.a.createElement(J,{doctype:t.type,documentType:"Notes"},i.a.createElement(Q.a,{theme:"primary",docId:u,onClick:s,label:"",extension:"narrow",iconOnly:!0}),a&&i.a.createElement(Q.b,{document:t,onClose:c}))}var F=n("cjKa"),G=n("O1Kf"),H=n("bfWj");function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function Y(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){X(a,r,i,o,s,"next",e)}function s(e){X(a,r,i,o,s,"throw",e)}o(void 0)})}}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.service=n,this.eventEmitter=new F.EventEmitter2,this.resetBackoff(),this.initializeStepsQueue(),this.isSending=!1}var t,n,r,i,a,o,c,u;return t=e,(n=[{key:"resetBackoff",value:function(){this.backoff=0,this.failures=0}},{key:"increaseBackoff",value:function(){this.failures=this.failures+1,this.failures%4==0&&this.emit("needcatchup",{failures:this.failures}),this.backoff=Math.max(Math.min(2*this.backoff,3e5),128)}},{key:"afterBackoff",value:function(){var e=this;return new Promise(function(t){e.backoff<128?t():window.setTimeout(t,e.backoff)})}},{key:"initializeStepsQueue",value:function(){this.queuedStep=void 0}},{key:"enqueueSteps",value:function(e){var t=e.getState,n=e.state,r=e.localSteps;this.queuedStep={getState:t,state:n,localSteps:r}}},{key:"dequeueSteps",value:function(){var e=this.queuedStep,t=e.getState,n=e.state||t(),r=e.localSteps||Object(G.sendableSteps)(n)||{steps:[]};return this.queuedStep=void 0,{getState:t,state:n,localSteps:r}}},{key:"hasQueuedSteps",value:function(){return!!this.queuedStep}},{key:"rebaseStepsInQueue",value:function(){this.queuedStep&&(this.queuedStep={getState:this.queuedStep.getState})}},{key:"sendSteps",value:(u=Y(s.a.mark(function e(t,n,r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.enqueueSteps({getState:t,state:n,localSteps:r}),e.next=3,this.processQueue();case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"processQueue",value:(c=Y(s.a.mark(function e(){var t,n,r,i,a,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSending){e.next=2;break}return e.abrupt("return");case 2:if(this.hasQueuedSteps()){e.next=4;break}return e.abrupt("return");case 4:return this.isSending=!0,e.next=7,this.afterBackoff();case 7:if(t=this.dequeueSteps(),n=t.getState,r=t.state,i=t.localSteps.steps,void 0!==K(a=Object(G.getVersion)(r))){e.next=11;break}return e.abrupt("return");case 11:if(0!==i.length){e.next=13;break}return e.abrupt("return");case 13:return e.prev=13,o=this.config.docId,e.next=17,this.service.pushSteps(o,a,i);case 17:c=e.sent,this.rebaseStepsInQueue(),this.resetBackoff(),this.isSending=!1,c&&c.steps&&c.steps.length>0&&this.emit("data",c),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(13),this.hasQueuedSteps()?this.rebaseStepsInQueue():this.enqueueSteps({getState:n}),this.increaseBackoff(),this.isSending=!1;case 29:this.processQueue();case 30:case"end":return e.stop()}},e,this,[[13,24]])})),function(){return c.apply(this,arguments)})},{key:"connect",value:(o=Y(s.a.mark(function e(t,n){var r,i=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=this.config.docId,this.service.join(r),this.service.onStepsCreated(r,function(e){i.emit("data",{version:e.version,steps:[e]})}),this.service.onTelepointerUpdated(r,function(e){i.emit("telepointer",e)}),this.eventEmitter.emit("connected",{doc:n,version:t});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getSteps",value:(a=Y(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.docId,e.next=3,this.service.getSteps(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"sendTelepointer",value:(i=Y(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.docId,e.next=3,this.service.pushTelepointer(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}}])&&$(t.prototype,n),r&&$(t,r),e}();function te(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function ne(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ae(e,t,n[t])})}return e}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe=new H.a,se=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae(this,"processRemoteData",function(e){var t=e.version,n=e.steps;if(n&&n.length){var i=n.map(function(e){return e.sessionId||r.serviceClient.getUserId(e.sessionId)});r.emit("data",{json:n,version:t,userIds:i})}else console.warn("Collab.Provider: processRemoteData no steps ? ",n,e)}),ae(this,"onReceiveData",function(e){r.queueData(e),r.processQueue()}),ae(this,"onReceiveTelepointer",function(e){var t=e.sessionId,n=r.serviceClient.getUserId(t);if(n!==r.config.userId){var i=r.participants.get(n);i&&i.lastActive>e.timestamp||(r.updateParticipant(t,e.timestamp),r.emit("telepointer",e))}}),this.config=t,this.config.sessionId=n.getSessionId(),this.config.userId=n.getUserId(),this.serviceClient=n,this.channel=t.channel||new ee(t,n),this.eventEmitter=new F.EventEmitter2,this.queue=[],this.getState=function(){},this.participants=new Map,this.pauseQueue=!1,this.initialVersion=t.version,this.pauseQueue=!1}var t,n,r,i,a;return t=e,(n=[{key:"initialize",value:function(e){var t=this;this.getState=e,this.channel.on("connected",function(e){var n=e.doc,r=e.version,i=t.config.sessionId;t.emit("init",{sid:i,doc:n,version:r}),t.emit("connected",{sid:i})}),this.channel.on("data",this.onReceiveData),this.channel.on("telepointer",this.onReceiveTelepointer),this.channel.on("needcatchup",function(){return t.catchup()});var n=e(),r=oe.encode(n.doc),i=void 0!==this.initialVersion?this.initialVersion:r.version,a=re({},r,{version:i});return this.channel.connect(i,a),this}},{key:"send",value:function(e,t,n){e.steps&&e.steps.length&&this.channel.sendSteps(this.getState,n)}},{key:"sendMessage",value:function(e){if(e)switch(e.type){case"telepointer":this.channel.sendTelepointer(re({},e,{timestamp:(new Date).getTime()}))}}},{key:"queueData",value:function(e){var t=[].concat(ne(this.queue),[e]).sort(function(e,t){var n=e.version-e.steps.length,r=t.version-t.steps.length;return n>r?1:n<r?-1:e.version>t.version?-1:e.version>t.version?1:0});this.queue=t}},{key:"catchup",value:(i=s.a.mark(function e(){var t,n,r,i,a,o,c,u,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseQueue=!0,t=Object(G.getVersion)(this.getState()),e.prev=2,e.next=5,this.channel.getSteps(t);case 5:n=e.sent,r=n.doc,i=n.version,a=n.steps,r?(o=this.config.sessionId,c=Object(G.sendableSteps)(this.getState())||{},u=c.steps,l=void 0===u?[]:u,this.emit("init",{sid:o,doc:r,version:i}),l.length&&this.emit("local-steps",{steps:l})):this.onReceiveData({steps:a,version:i},!0),this.queueTimeout=void 0,this.pauseQueue=!1,this.processQueue(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),this.pauseQueue=!1,this.programCatchup();case 19:case"end":return e.stop()}},e,this,[[2,15]])}),a=function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function o(e){te(a,n,r,o,s,"next",e)}function s(e){te(a,n,r,o,s,"throw",e)}o(void 0)})},function(){return a.apply(this,arguments)})},{key:"programCatchup",value:function(){var e=this;this.queueTimeout||(this.queueTimeout=window.setTimeout(function(){e.catchup()},1e3))}},{key:"cancelCatchup",value:function(){this.queueTimeout&&(window.clearTimeout(this.queueTimeout),this.queueTimeout=void 0)}},{key:"processQueue",value:function(){if(this.queue.length>0&&!this.pauseQueue)for(var e=Object(G.getVersion)(this.getState());this.queue.length>0;){var t=this.queue[0],n=t.version,r=t.steps.length+e;if(n==r)this.cancelCatchup(),this.queue.shift(),this.processRemoteData(t),e=n;else if(n<=r&&this.queue.shift(),n>r){this.programCatchup();break}}}},{key:"updateParticipant",value:function(e,t){var n=this,r=this.serviceClient.getUserId(e),i=function(e){var t=e.userId,n=e.sessionId;return{userId:n,sessionId:n||t,name:t,avatar:"https://api.adorable.io/avatars/80/".concat(t.replace(/[^a-zA-Z0-9]/g,""),".png"),email:"".concat(t.replace(/\s+/g,".").replace(/[^a-zA-Z0-9.]/g,""),".toLocaleLowerCase()}@mycozy.cloud")}}({userId:r,sessionId:e});this.participants.set(r,re({name:"",email:"",avatar:"",sessionId:e,userId:r},i,{lastActive:t}));var a=[this.participants.get(r)],o=(new Date).getTime(),s=Array.from(this.participants.values()).filter(function(e){return(o-e.lastActive)/1e3>300});s.forEach(function(e){return n.participants.delete(e.userId)}),this.emit("presence",{joined:a,left:s})}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"unsubscribeAll",value:function(e){this.eventEmitter.removeAllListeners(e)}}])&&ie(t.prototype,n),r&&ie(t,r),e}(),ce=n("oBqo"),ue=n.n(ce);function le(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function de(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){le(a,r,i,o,s,"next",e)}function s(e){le(a,r,i,o,s,"throw",e)}o(void 0)})}}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){pe(e,t,n[t])})}return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.userId,r=t.cozyClient,i=t.schema,a=new Date,o=a.getTime()+"."+a.getMilliseconds()+"."+Math.random();this.sessionId=n+":"+o,this.userId=this.getUserId(n),this.cozyClient=r,this.stackClient=r.getStackClient(),this.schema=i,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=new ue.a({client:r}),this.resetCallbacks()}var t,n,r,i,a,o,c,u,l,d,f,p,h;return t=e,(n=[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return fe({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return fe({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(h=de(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||b}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"setTitle",value:(p=de(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype;if(this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not manager",n,t,this.callbacks)}},{key:"join",value:(f=de(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e){return e.id==t?this.onRealtimeEvent(t):void 0},e.next=3,Promise.all([this.realtime.subscribe("created","io.cozy.notes.events",n),this.realtime.subscribe("updated","io.cozy.notes.events",t,this.onRealtimeEvent),this.realtime.subscribe("deleted","io.cozy.notes.events",t,this.onRealtimeEvent)]);case 3:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"onStepsCreated",value:(d=de(s.a.mark(function e(t,n){var r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,function(e){return n(r.server2client(e))});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(l=de(s.a.mark(function e(t,n){var r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,function(e){return n(r.server2client(e))});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"onTitleUpdated",value:(u=de(s.a.mark(function e(t,n){var r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"getDoc",value:(c=de(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,e.abrupt("return",{doc:n.data.attributes.metadata.content,version:n.data.attributes.metadata.version,title:n.data.attributes.metadata.title,file:n.data});case 4:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"pushSteps",value:(o=de(s.a.mark(function e(t,n,r){var i,a,o=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={headers:{"if-match":n}},a={data:r.map(function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}})},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),a,i);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"getSteps",value:(a=de(s.a.mark(function e(t,n){var r,i,a,o,c,u,l,d=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return e.abrupt("return",{version:r.data[r.data.length-1].version,steps:r.data.map(function(e){return fe({},e,{attributes:d.client2server(e.attributes)})})});case 9:e.next=25;break;case 11:if(e.prev=11,e.t0=e.catch(0),i=e.t0.response,a=e.t0.reason&&e.t0.reason.data,o=a&&a.attributes&&a.attributes.metadata,c=o&&o.content,u=o&&o.version,412!=i.status||!c||!u){e.next=24;break}return l="io.cozy.notes.documents",this.callbacks[l]&&this.callbacks[l][c.id||c._id]&&this.callbacks[l][c.id||c._id](c),e.abrupt("return",{doc:c,version:u});case 24:throw e.t0;case 25:case"end":return e.stop()}},e,this,[[0,11]])})),function(e,t){return a.apply(this,arguments)})},{key:"pushTelepointer",value:(i=de(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})}])&&he(t.prototype,n),r&&he(t,r),e}();function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){me(e,t,n[t])})}return e}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _e=Object(d.c)()(Object(c.withClient)(function(e){var t=e.client,n=e.noteId,a=e.t,o=Object(r.useMemo)(function(){return e.userName||Object(y.e)(t)},[e.userName]),c=Object(r.useContext)(M.a),u=n,l=o,d=t,f=ge(Object(r.useState)(!0),2),p=f[0],h=f[1],v=ge(Object(r.useState)(void 0),2),b=v[0],m=v[1],g=ge(Object(r.useState)(void 0),2),_=g[0],w=g[1],j=Object(r.useMemo)(function(){return new ve({userId:l,userName:o,cozyClient:d})},[n]),k=b&&b.version,x=Object(r.useMemo)(function(){if(void 0!==k){var e=new se({version:b.version,docId:u},j);return{useNativePlugin:!0,provider:Promise.resolve(e),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:j.getSessionId()}}return null},[n,k,o,j]);Object(r.useEffect)(function(){(function(){var e,t=(e=s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p||h(!0),e.next=4,j.getDoc(n);case 4:t=e.sent,w(t.title||""),m(t),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),w(!1),m(!1);case 13:h(!1);case 14:case"end":return e.stop()}},e,this,[[0,9]])}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ye(a,r,i,o,s,"next",e)}function s(e){ye(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return t.apply(this,arguments)}})()()},[n]);var O=Object(r.useCallback)(function(){return null},[n]),S=Object(r.useCallback)(function(e){var t=e.target.value;_!=t&&(w(t),j.setTitle(n,t))},[n,w,j]),E=Object(r.useCallback)(function(e){_!=e&&w(e)},[n,w]);Object(r.useMemo)(function(){j.onTitleUpdated(n,E)},[E,j]),Object(r.useEffect)(function(){p||b||(console.warn("Could not load note ".concat(n)),e.history.push("/"))});var C=Object(r.useMemo)(function(){return void 0!==e.returnUrl?e.returnUrl:b?Object(y.b)(t,b.file):e.returnUrl},[e.returnUrl,b]);return p||!b?i.a.createElement(R,null):i.a.createElement(U,{onTitleChange:S,onContentChange:O,collabProvider:x,defaultTitle:a("Notes.Editor.title_placeholder"),defaultValue:be({},b.doc,{version:b.version}),title:_&&_.length>0?_:void 0,returnUrl:C,actions:!c&&i.a.createElement(W,{fileId:n})})}));n.d(t,"b",function(){return C}),n.d(t,"a",function(){return _e})},nw0P:function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"kOWh","./ar/build_distance_in_words_locale/index.js":"XxX6","./ar/build_format_locale/index.js":"alis","./ar/index.js":"EDRf","./be/build_distance_in_words_locale/index.js":"LQ09","./be/build_format_locale/index.js":"kj7F","./be/index.js":"YEhR","./bg/build_distance_in_words_locale/index.js":"7K3h","./bg/build_format_locale/index.js":"RrdL","./bg/index.js":"isx8","./ca/build_distance_in_words_locale/index.js":"wqqj","./ca/build_format_locale/index.js":"qcV0","./ca/index.js":"Vwa+","./cs/build_distance_in_words_locale/index.js":"ZKDM","./cs/build_format_locale/index.js":"ipyF","./cs/index.js":"dvhP","./da/build_distance_in_words_locale/index.js":"2Mgc","./da/build_format_locale/index.js":"Gned","./da/index.js":"7ur/","./de/build_distance_in_words_locale/index.js":"5IWf","./de/build_format_locale/index.js":"THCn","./de/index.js":"bgw5","./el/build_distance_in_words_locale/index.js":"o/GB","./el/build_format_locale/index.js":"8T9h","./el/index.js":"dH0v","./en/build_distance_in_words_locale/index.js":"LZbM","./en/build_format_locale/index.js":"6DAA","./en/index.js":"Us+F","./eo/build_distance_in_words_locale/index.js":"qrnn","./eo/build_format_locale/index.js":"Bl15","./eo/index.js":"UB7v","./es/build_distance_in_words_locale/index.js":"GEfZ","./es/build_format_locale/index.js":"O+zC","./es/index.js":"/S0t","./fi/build_distance_in_words_locale/index.js":"VHtQ","./fi/build_format_locale/index.js":"Oydx","./fi/index.js":"ndVD","./fil/build_distance_in_words_locale/index.js":"uq4p","./fil/build_format_locale/index.js":"d7hw","./fil/index.js":"pNfm","./fr/build_distance_in_words_locale/index.js":"IzMR","./fr/build_format_locale/index.js":"I3Zg","./fr/index.js":"LKA2","./hr/build_distance_in_words_locale/index.js":"DPvn","./hr/build_format_locale/index.js":"puw3","./hr/index.js":"L9Jq","./hu/build_distance_in_words_locale/index.js":"w2RQ","./hu/build_format_locale/index.js":"/0iD","./hu/index.js":"Nm+E","./id/build_distance_in_words_locale/index.js":"JbvB","./id/build_format_locale/index.js":"0wlw","./id/index.js":"A6C3","./is/build_distance_in_words_locale/index.js":"qzMC","./is/build_format_locale/index.js":"S3yD","./is/index.js":"N4bE","./it/build_distance_in_words_locale/index.js":"MDEp","./it/build_format_locale/index.js":"aUJd","./it/index.js":"hmb4","./ja/build_distance_in_words_locale/index.js":"nNvt","./ja/build_format_locale/index.js":"buui","./ja/index.js":"uAXs","./ko/build_distance_in_words_locale/index.js":"oEw+","./ko/build_format_locale/index.js":"9SQf","./ko/index.js":"iW8+","./mk/build_distance_in_words_locale/index.js":"nmwZ","./mk/build_format_locale/index.js":"htxJ","./mk/index.js":"GzBU","./nb/build_distance_in_words_locale/index.js":"SL1f","./nb/build_format_locale/index.js":"CJ5F","./nb/index.js":"73vv","./nl/build_distance_in_words_locale/index.js":"Uyu0","./nl/build_format_locale/index.js":"doCD","./nl/index.js":"hCQt","./pl/build_distance_in_words_locale/index.js":"FUBD","./pl/build_format_locale/index.js":"nOYf","./pl/index.js":"B6yL","./pt/build_distance_in_words_locale/index.js":"aTPA","./pt/build_format_locale/index.js":"TTT0","./pt/index.js":"gdks","./ro/build_distance_in_words_locale/index.js":"gI+A","./ro/build_format_locale/index.js":"njjO","./ro/index.js":"r2yp","./ru/build_distance_in_words_locale/index.js":"KmPx","./ru/build_format_locale/index.js":"UUBw","./ru/index.js":"nz/o","./sk/build_distance_in_words_locale/index.js":"q2Bs","./sk/build_format_locale/index.js":"9sxn","./sk/index.js":"Wqan","./sl/build_distance_in_words_locale/index.js":"mlv2","./sl/build_format_locale/index.js":"vHkZ","./sl/index.js":"KYSo","./sr/build_distance_in_words_locale/index.js":"LlkS","./sr/build_format_locale/index.js":"RhjJ","./sr/index.js":"7mU3","./sv/build_distance_in_words_locale/index.js":"UNBN","./sv/build_format_locale/index.js":"zTNB","./sv/index.js":"hxgj","./th/build_distance_in_words_locale/index.js":"XAGa","./th/build_format_locale/index.js":"We2s","./th/index.js":"Pk+z","./tr/build_distance_in_words_locale/index.js":"aFZF","./tr/build_format_locale/index.js":"jh7A","./tr/index.js":"3ZWG","./zh_cn/build_distance_in_words_locale/index.js":"KdB7","./zh_cn/build_format_locale/index.js":"l4EP","./zh_cn/index.js":"8tMq","./zh_tw/build_distance_in_words_locale/index.js":"vyyr","./zh_tw/build_format_locale/index.js":"uYH7","./zh_tw/index.js":"QPlQ"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="nw0P"},pL5B:function(e,t,n){"use strict";n.r(t),function(e){var r=n("o0o1"),i=n.n(r),a=n("q1tI"),o=n.n(a),s=n("0cfB"),c=n("Ty5D"),u=n("55Ip"),l=n("SH7X"),d=n("buk/"),f=n("jDpt"),p=n("le8I"),h=n("V2U0"),v=n("GoJ1"),b=n("Zlyp"),m=n("snnE");function y(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _=Object(c.f)(function(e){var t=Object(m.c)();return o.a.createElement(b.a,{noteId:e.match.params.id,returnUrl:t})}),w=function(){return o.a.createElement(c.c,null,o.a.createElement(c.a,{path:"/n/:id",component:_}),o.a.createElement(c.a,{path:"/",component:b.b}))},j=Object(d.c)()(function(e){var t=e.t;return o.a.createElement(v.a,{icon:"warning-circle",title:t("Error.unshared_title"),text:t("Error.unshared_text")})}),k=Object(l.withClient)(function(e){var t=e.client,n=g(Object(a.useState)(null),2),r=n[0],s=n[1],c=Object(a.useMemo)(function(){return Object(m.c)()},[]);return Object(a.useEffect)(function(){(function(){var e,n=(e=i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(m.d)(t);case 3:n=e.sent,s(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),s(!1);case 10:case"end":return e.stop()}},e,this,[[0,7]])}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){y(a,r,i,o,s,"next",e)}function s(e){y(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return n.apply(this,arguments)}})()()},[]),r?o.a.createElement(b.a,{noteId:r,returnUrl:c||!1}):null!==r?o.a.createElement(j,null):o.a.createElement(h.a,{size:"xxlarge",middle:!0})});t.default=Object(s.hot)(e)(function(e){var t=e.isPublic;return o.a.createElement(u.a,null,o.a.createElement(f.b,{monoColumn:!0},o.a.createElement(f.c,null,o.a.createElement(f.a,{className:"app-content"},t?o.a.createElement(k,null):o.a.createElement(w,null))),o.a.createElement(p.a,null)))})}.call(this,n("3UD+")(e))},pZg0:function(e,t){e.exports={name:"Notes",name_prefix:"Cozy",slug:"notes",icon:"icon.svg",categories:[],version:"1.0.7",licence:"AGPL-3.0",editor:"",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"edas",url:"https://eric.daspet.name/"},routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0}},permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"}}}},snnE:function(e,t,n){"use strict";n.d(t,"e",function(){return d}),n.d(t,"c",function(){return p}),n.d(t,"a",function(){return h}),n.d(t,"d",function(){return v}),n.d(t,"b",function(){return m});var r=n("o0o1"),i=n.n(r),a=n("mwIZ"),o=n.n(a),s=n("snfs"),c=n("AHTZ");function u(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function d(e){return new URL(e.getStackClient().uri).hostname+Math.floor(100*Math.random())}var f="returnUrl";function p(){var e=new URLSearchParams(window.location.search),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=l(i.value,2),s=o[0],c=o[1];if(s===f)return c}}catch(u){n=!0,r=u}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}var h=function(e){var t=new URL(window.location);return t.searchParams.append(f,window.location.origin),t.hash="#/n/".concat(e.id),t};function v(e){return b.apply(this,arguments)}function b(){var e;return e=i.a.mark(function e(t){var n,r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").getOwnPermissions();case 2:return n=e.sent,r=n.data,a=r.attributes.permissions,s=o()(Object.values(a),"0.values.0"),e.abrupt("return",s);case 7:case"end":return e.stop()}},e,this)}),(b=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,s,"next",e)}function s(e){u(a,r,i,o,s,"throw",e)}o(void 0)})}).apply(this,arguments)}function m(e,t){return function(e,t){var n=new URL(e.getStackClient().uri),r=e.getInstanceOptions().cozySubdomainType,i=function(e){return"/folder/".concat(e.replace(/-/g,""))}(t),a=Object(c.b)({cozyUrl:n.origin,slug:"drive",subDomainType:r,nativePath:i});return Object(s.isMobile)()?Object(c.a)({slug:"drive",fallbackUrl:a,nativePath:i,subDomainType:r}):a}(e,function(e){return e.relationships.parent.data.id}(t))}}});