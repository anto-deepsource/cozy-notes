!function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={4:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({1:"@atlaskit-internal_media-archive-viewer",2:"@atlaskit-internal_media-pdf-viewer",3:"@atlaskit-internal_media-viewer"}[e]||e)+"/notes."+{1:"6d81e334d4fbdcbb13e6",2:"0d4452cee07bbd782a6f",3:"8768ce2ace01909b2b2f"}[e]+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([1,0]),n()}({"/KVF":function(e,t,n){var r={"./atlassian_missing_french":"BwLP","./atlassian_missing_french.json":"BwLP","./en":"7dT6","./en.json":"7dT6","./fr":"9pOX","./fr.json":"9pOX"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="/KVF"},0:function(e,t){},1:function(e,t,n){n("55Il"),n("7NIr"),e.exports=n("LiWt")},2:function(e,t){},3:function(e,t){},4:function(e,t){},"7dT6":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"Delete":{"delete_note":"Delete","deleted":"The note has been moved to the trash of your Drive","failed":"The note could not be deleted, please try again"},"EditorView":{"main_placeholder":"Write anything…"},"Editor":{"title_placeholder":"Here is your title","exit_confirmation_message":"Automatic saving has not taken into account the latest changes in your doc. Please stay on your current note if you want to keep them.","exit_confirmation_title":"Abandon your changes?","exit_confirmation_leave":"Leave without saving","exit_confirmation_cancel":"Cancel","read_only":"This note is in read-only mode."},"List":{"latest_notes":"Latest Notes","name":"Name","updated_at":"Updated at","location":"Location","sharings":"Sharings","at":"%{date} at %{time}"},"Empty":{"welcome":"Welcome on Cozy Notes","after_created":"Once your Note is created, you can find it in your "},"SavingIndicator":{"saved":{"default":"Up to date","just_now":"Up to date","secs_ago":"Up to date (saved %{time} sec. ago)","min_ago":"Up to date (saved %{time} min. ago)","mins_ago":"Up to date (saved %{time} min. ago)","hour_ago":"Up to date (saved %{time} hour ago)","hours_ago":"Up to date (saved %{time} hours ago)","day_ago":"Up to date (saved %{time} day ago)","days_ago":"Up to date (saved %{time} days ago)","month_ago":"Up to date (saved %{time} month ago)","monthes_ago":"Up to date (saved %{time} monthes ago)","year_ago":"Up to date (saved %{time} year ago)","years_ago":"Up to date (saved %{time} years ago)"},"saving":"Saving...","still_saving":"Saving......","out_of_sync":{"default":"Saved (off-line)","just_now":"Saved (off-line)","secs_ago":"Saved (off-line for %{time} sec)","min_ago":"Saved (off-line for %{time} min)","mins_ago":"Saved (off-line for %{time} min)","hour_ago":"Saved (off-line for %{time} hour)","hours_ago":"Saved (off-line for %{time} hours)","day_ago":"Saved (off-line for %{time} day)","days_ago":"Saved (off-line for %{time} days)","month_ago":"Saved (off-line for %{time} month)","monthes_ago":"Saved (off-line for %{time} monthes)","year_ago":"Saved (off-line for %{time} year)","years_ago":"Saved (off-line for %{time} years)"},"saving_impossible":{"default":"Changes unsaved (off-line)","just_now":"Changes unsaved (off-line)","secs_ago":"Changes unsaved (off-line for %{time} sec)","min_ago":"Changes unsaved (off-line for %{time} min)","mins_ago":"Changes unsaved (off-line for %{time} min)","hour_ago":"Changes unsaved (off-line for %{time} hour)","hours_ago":"Changes unsaved (off-line for %{time} hours)","day_ago":"Changes unsaved (off-line for %{time} day)","days_ago":"Changes unsaved (off-line for %{time} days)","month_ago":"Changes unsaved (off-line for %{time} month)","monthes_ago":"Changes unsaved (off-line for %{time} monthes)","year_ago":"Changes unsaved (off-line for %{time} year)","years_ago":"Changes unsaved (off-line for %{time} years)"}},"OfflineIndicator":{"message":"You\'re not connected to internet anymore. Your changes will be saved once you will be connected again."}},"Error":{"422":"Only images are accepted","unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this sharing. You can no longer edit a note at this address.","loading_error_title":"The note couldn\'t be loaded","loading_error_text_noReturnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please try again later.","loading_error_text_returnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please go <a href=\'%{url}\'>back</a> and try again later.","unknown_error":"An unexpected error occured"},"manifest":{"short_description":"Cozy Notes is your personal and collaborative note-taking application.","long_description":"Notes is an online text editor that can already offer you to:\\n\\n* Create your own notes with the essential features (bold, underlined, links, tables...)\\n* Fill and find your notes with you other documents in files of your personal Drive\\n* Edit easily your notes from all your devices\\n* Access your notes offline\\n* For the fans, use shortcuts and input in markdown format ... and even write with contacts together on the same note (coming soon)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]}}')},"84gJ":function(e,t,n){e.exports={"saving-indicator":"saving-indicator--rzoXB"}},"9pOX":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"Delete":{"delete_note":"Supprimer","deleted":"La note a été placée dans la corbeille de votre Drive","failed":"La note n\'a pas pu être supprimée, merci de re-essayer plus tard"},"EditorView":{"main_placeholder":"Écrivez ce que vous souhaitez…"},"Editor":{"title_placeholder":"Ici votre titre","exit_confirmation_message":"La sauvegarde automatique n\'a pas encore pris en compte vos dernières modifications. Merci de retourner sur votre note pour ne pas les perdre.","exit_confirmation_title":"Abandonner les modifications ?","exit_confirmation_leave":"Quitter sans sauvegarder","exit_confirmation_cancel":"Retour","read_only":"Cette note est en mode lecture-seule."},"List":{"latest_notes":"Notes récentes","name":"Nom","updated_at":"Mise à jour","location":"Emplacement","sharings":"Partage","at":"%{date} à %{time}"},"Empty":{"welcome":"Bienvenue sur Cozy Notes","after_created":"Une fois votre note créée, il vous est possible de la retrouver dans "},"SavingIndicator":{"saved":{"default":"À jour","just_now":"À jour","secs_ago":"À jour (enregistré il y a %{time} sec.)","min_ago":"À jour (enregistré il y a %{time} min.)","mins_ago":"À jour (enregistré il y a %{time} min.)","hour_ago":"À jour (enregistré il y a %{time} heure)","hours_ago":"À jour (enregistré il y a %{time} heures)","day_ago":"À jour (enregistré il y a %{time} jour)","days_ago":"À jour (enregistré il y a %{time} jours)","month_ago":"À jour (enregistré il y a %{time} mois)","monthes_ago":"À jour (enregistré il y a %{time} mois)","year_ago":"À jour (enregistré il y a %{time} an)","years_ago":"À jour (enregistré il y a %{time} ans)"},"saving":"Enregistrement en cours...","still_saving":"Enregistrement en cours......","out_of_sync":{"default":"Enregistré (hors ligne)","just_now":"Enregistré (hors ligne)","secs_ago":"Enregistré (hors ligne depuis %{time} sec)","min_ago":"Enregistré (hors ligne depuis %{time} min)","mins_ago":"Enregistré (hors ligne depuis %{time} min)","hour_ago":"Enregistré (hors ligne depuis %{time} h)","hours_ago":"Enregistré (hors ligne depuis %{time} h)","day_ago":"Enregistré (hors ligne depuis %{time} jour)","days_ago":"Enregistré (hors ligne depuis %{time} jours)","month_ago":"Enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Enregistré (hors ligne depuis %{time} mois)","year_ago":"Enregistré (hors ligne depuis %{time} an)","years_ago":"Enregistré (hors ligne depuis %{time} ans)"},"saving_impossible":{"default":"Non enregistré (hors ligne)","just_now":"Non enregistré (hors ligne)","secs_ago":"Non enregistré (hors ligne depuis %{time} sec)","min_ago":"Non enregistré (hors ligne depuis %{time} min)","mins_ago":"Non enregistré (hors ligne depuis %{time} min)","hour_ago":"Non enregistré (hors ligne depuis %{time} h)","hours_ago":"Non enregistré (hors ligne depuis %{time} h)","day_ago":"Non enregistré (hors ligne depuis %{time} jour)","days_ago":"Non enregistré (hors ligne depuis %{time} jours)","month_ago":"Non enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Non enregistré (hors ligne depuis %{time} mois)","year_ago":"Non enregistré (hors ligne depuis %{time} an)","years_ago":"Non enregistré (hors ligne depuis %{time} ans)"}},"OfflineIndicator":{"message":"Vous n’êtes plus connecté à internet. Vos modifications seront enregistrées quand vous serez connecté à nouveau."}},"Error":{"422":"Seules les images sont acceptées","unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriétaire a peut-être révoqué ce partage. Vous ne pouvez plus éditer de note à cette adresse.","loading_error_title":"La note n\'a pas pu être chargée","loading_error_text_noReturnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci de retenter plus tard.","loading_error_text_returnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci revenir <a href=\'%{url}\'>en arrière</a> et de retenter plus tard.","unknown_error":"Une erreur inattendue s\'est produite"},"manifest":{"short_description":"Cozy Notes est votre application de prise de notes personnelles et collaboratives.","long_description":"Notes est un éditeur de texte en ligne destiné à :\\n\\n* Créer vos propres notes avec les fonctionnalités essentielles (gras, souligné, liens, tableaux...)\\n* Classer et retrouver vos notes avec vos autres documents, dans les répertoires de votre Drive personnel\\n* Éditer facilement vos notes depuis tous vos appareils\\n* Accéder à vos notes, même sans internet, stockées sur votre PC\\n* Pour les aficionados, utiliser les raccourcis et la saisie au format markdown\\n*  ... et même écrire à plusieurs simultanément sur la même note (à venir) ! ","screenshots":["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"]}}')},BwLP:function(e){e.exports=JSON.parse('{"fabric.editor.editMode.inviteToEditButton.title":"Inviter à éditer","fabric.editor.blockquote2":"Citation","fabric.editor.remove":"Supprimer","fabric.editor.linkPlaceholder":"Coller le lien","fabric.editor.linkAddress":"Adresse du lien","fabric.editor.layoutWide":"Élargir","fabric.editor.layoutFullWidth":"Pleine largeur","fabric.editor.layoutFixedWidth":"Retour au centre","fabric.editor.alignImageLeft":"Aligner l\'image à gauche","fabric.editor.alignImageCenter":"Centrer l\'image","fabric.editor.alignImageRight":"Aligner l\'image à droite"}')},G2JP:function(e,t,n){"use strict";var r=n("q1tI"),i=n.n(r).a.createContext(!1);t.a=i},LiWt:function(e,t,n){"use strict";n.r(t),n.d(t,"initApp",(function(){return D}));var r=n("lSNA"),i=n.n(r),a=(n("llna"),n("/8/d"),n("3FT0"),n("VxdY"),n("q1tI")),o=n.n(a),s=n("i8i4"),c=n.n(s),l=n("JRPe"),u=n("44Ds"),d=n.n(u),p=n("PRV4"),f=n("o8Rm"),h=n("Kwg8"),m=n("nnJL"),v=n("xIbs"),g=n("SH7X"),b=n.n(g),y=n("oJ5p"),w=n("buk/"),O=n("Le8U"),k=n("UmWK"),x=n("G2JP"),P=n("X3v2");function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=n("pZg0"),_=n("BwLP"),S={en:{react:n("PTt1"),atlaskit:h.a},fr:{react:n("Z6Ro"),atlaskit:j(j({},m.a),_)}},M=Object(p.a)({disableGlobal:!0}),D=function(){var e=Object(P.b)(),t=Object(P.a)(e.app.icon,n("ZAKO")),r=Object(P.a)(e.app.prefix||E.name_prefix,""),i=Object(P.a)(e.app.name,E.name),a=Object(P.a)(e.app.slug,E.slug),s=Object(P.a)(e.app.version,E.version);Object(l.d)(S.en.react),Object(l.d)(S.fr.react);var u=Object(P.a)(e.locale,"en"),d=["en","fr"].includes(u)?u:"en",p=window.location?window.location.protocol:"https:",f=Object(P.c)(),h=f||e.token,m=f||!h||""==h,v=new b.a({uri:"".concat(p,"//").concat(e.domain),token:h,appMetadata:{slug:a,version:s}});return O.Document.cozyClient||O.Document.registerClient(v),v.registerPlugin(y.RealtimePlugin),m||(window.React=o.a,window.ReactDOM=c.a,cozy.bar.init({appName:i,appNamePrefix:r,iconPath:t,lang:d,replaceTitleOnMobile:!0,cozyClient:v,isPublic:m})),{appLocale:d,client:v,isPublic:m}},N=d()(D);document.addEventListener("DOMContentLoaded",(function(){var e=N();!function(e,t,r){var i=n("pL5B").default;Object(s.render)(o.a.createElement(w.b,{lang:e,dictRequire:function(e){return n("/KVF")("./".concat(e))}},o.a.createElement(f.b,{generateClassName:M},o.a.createElement(l.c,{locale:e,messages:S[e].atlaskit},o.a.createElement(g.CozyProvider,{client:t},o.a.createElement(v.a,null,o.a.createElement(x.a.Provider,{value:r},!r&&o.a.createElement(k.a,{doctype:"io.cozy.files",documentType:"Notes"},o.a.createElement(i,{isPublic:r})),r&&o.a.createElement(i,{isPublic:r}))))))),document.querySelector("[role=application]"))}(e.appLocale,e.client,e.isPublic)}))},Q2Eh:function(e,t,n){e.exports={"note-article":"note-article--2yQdC",banner:"banner--1nSEd",title:"title--2DQ8I",titleInput:"titleInput--2ERlh"}},"R3/7":function(e,t,n){e.exports={"sharing-button":"sharing-button--nzFli"}},RMII:function(e,t,n){e.exports={empty:"empty--FqnXy",appHeader:"appHeader--2ilS0",tableSpecialRow:"tableSpecialRow--4oekp",tableCellEmpty:"tableCellEmpty--21fZ1",tableCellName:"tableCellName--2Jak9",tableCell:"tableCell--3-jDP",tableRow:"tableRow--3SicR"}},VxdY:function(e,t,n){},X3v2:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a}));n("dasq");var r=function(){var e=document.querySelector("[role=application]");return JSON.parse(e.dataset.cozy)},i=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e},a=function(){return new URLSearchParams(window.location.search).get("sharecode")}},ZAKO:function(e,t){e.exports="/img/icon.ade48547fed1e1897b253182a9038251.svg"},dojK:function(e,t,n){"use strict";var r,i,a,o,s,c,l;n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"e",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"g",(function(){return u})),function(e){e.NoFileFoundAfterInput="No File was detected during the upload procedure.",e.FileNotProcessable="Could not process the uploaded image.",e.CouldNotFindFileInCurrentNote="Could not find file in current note.",e.MissingCollabEdit="`CollabEditProvider` was `undefined` in `fetchCozyImage`. <Media> was unable to fetch the image source. The component might be unmounted.",e.CouldNotGetNoteImages="MediaNode failed to fetch included files in the current note"}(r||(r={})),function(e){e.Input="input"}(i||(i={})),function(e){e.File="file"}(a||(a={})),function(e){e.Click="click",e.Change="change"}(o||(o={})),function(e){e.Created="CREATED",e.Updated="UPDATED"}(s||(s={})),function(e){e.Files="io.cozy.files",e.NoteEvents="io.cozy.notes.events",e.Thumbnails="io.cozy.files.thumbnails"}(c||(c={})),function(e){e.Drive="drive"}(l||(l={}));var u="/preview"},nw0P:function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"kOWh","./ar/build_distance_in_words_locale/index.js":"XxX6","./ar/build_format_locale/index.js":"alis","./ar/index.js":"EDRf","./be/build_distance_in_words_locale/index.js":"LQ09","./be/build_format_locale/index.js":"kj7F","./be/index.js":"YEhR","./bg/build_distance_in_words_locale/index.js":"7K3h","./bg/build_format_locale/index.js":"RrdL","./bg/index.js":"isx8","./ca/build_distance_in_words_locale/index.js":"wqqj","./ca/build_format_locale/index.js":"qcV0","./ca/index.js":"Vwa+","./cs/build_distance_in_words_locale/index.js":"ZKDM","./cs/build_format_locale/index.js":"ipyF","./cs/index.js":"dvhP","./da/build_distance_in_words_locale/index.js":"2Mgc","./da/build_format_locale/index.js":"Gned","./da/index.js":"7ur/","./de/build_distance_in_words_locale/index.js":"5IWf","./de/build_format_locale/index.js":"THCn","./de/index.js":"bgw5","./el/build_distance_in_words_locale/index.js":"o/GB","./el/build_format_locale/index.js":"8T9h","./el/index.js":"dH0v","./en/build_distance_in_words_locale/index.js":"LZbM","./en/build_format_locale/index.js":"6DAA","./en/index.js":"Us+F","./eo/build_distance_in_words_locale/index.js":"qrnn","./eo/build_format_locale/index.js":"Bl15","./eo/index.js":"UB7v","./es/build_distance_in_words_locale/index.js":"GEfZ","./es/build_format_locale/index.js":"O+zC","./es/index.js":"/S0t","./fi/build_distance_in_words_locale/index.js":"VHtQ","./fi/build_format_locale/index.js":"Oydx","./fi/index.js":"ndVD","./fil/build_distance_in_words_locale/index.js":"uq4p","./fil/build_format_locale/index.js":"d7hw","./fil/index.js":"pNfm","./fr/build_distance_in_words_locale/index.js":"IzMR","./fr/build_format_locale/index.js":"I3Zg","./fr/index.js":"LKA2","./hr/build_distance_in_words_locale/index.js":"DPvn","./hr/build_format_locale/index.js":"puw3","./hr/index.js":"L9Jq","./hu/build_distance_in_words_locale/index.js":"w2RQ","./hu/build_format_locale/index.js":"/0iD","./hu/index.js":"Nm+E","./id/build_distance_in_words_locale/index.js":"JbvB","./id/build_format_locale/index.js":"0wlw","./id/index.js":"A6C3","./is/build_distance_in_words_locale/index.js":"qzMC","./is/build_format_locale/index.js":"S3yD","./is/index.js":"N4bE","./it/build_distance_in_words_locale/index.js":"MDEp","./it/build_format_locale/index.js":"aUJd","./it/index.js":"hmb4","./ja/build_distance_in_words_locale/index.js":"nNvt","./ja/build_format_locale/index.js":"buui","./ja/index.js":"uAXs","./ko/build_distance_in_words_locale/index.js":"oEw+","./ko/build_format_locale/index.js":"9SQf","./ko/index.js":"iW8+","./mk/build_distance_in_words_locale/index.js":"nmwZ","./mk/build_format_locale/index.js":"htxJ","./mk/index.js":"GzBU","./nb/build_distance_in_words_locale/index.js":"SL1f","./nb/build_format_locale/index.js":"CJ5F","./nb/index.js":"73vv","./nl/build_distance_in_words_locale/index.js":"Uyu0","./nl/build_format_locale/index.js":"doCD","./nl/index.js":"hCQt","./pl/build_distance_in_words_locale/index.js":"FUBD","./pl/build_format_locale/index.js":"nOYf","./pl/index.js":"B6yL","./pt/build_distance_in_words_locale/index.js":"aTPA","./pt/build_format_locale/index.js":"TTT0","./pt/index.js":"gdks","./ro/build_distance_in_words_locale/index.js":"gI+A","./ro/build_format_locale/index.js":"njjO","./ro/index.js":"r2yp","./ru/build_distance_in_words_locale/index.js":"KmPx","./ru/build_format_locale/index.js":"UUBw","./ru/index.js":"nz/o","./sk/build_distance_in_words_locale/index.js":"q2Bs","./sk/build_format_locale/index.js":"9sxn","./sk/index.js":"Wqan","./sl/build_distance_in_words_locale/index.js":"mlv2","./sl/build_format_locale/index.js":"vHkZ","./sl/index.js":"KYSo","./sr/build_distance_in_words_locale/index.js":"LlkS","./sr/build_format_locale/index.js":"RhjJ","./sr/index.js":"7mU3","./sv/build_distance_in_words_locale/index.js":"UNBN","./sv/build_format_locale/index.js":"zTNB","./sv/index.js":"hxgj","./th/build_distance_in_words_locale/index.js":"XAGa","./th/build_format_locale/index.js":"We2s","./th/index.js":"Pk+z","./tr/build_distance_in_words_locale/index.js":"aFZF","./tr/build_format_locale/index.js":"jh7A","./tr/index.js":"3ZWG","./zh_cn/build_distance_in_words_locale/index.js":"KdB7","./zh_cn/build_format_locale/index.js":"l4EP","./zh_cn/index.js":"8tMq","./zh_tw/build_distance_in_words_locale/index.js":"vyyr","./zh_tw/build_format_locale/index.js":"uYH7","./zh_tw/index.js":"QPlQ"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="nw0P"},pL5B:function(e,t,n){"use strict";n.r(t);var r=n("yXPU"),i=n.n(r),a=n("J4zp"),o=n.n(a),s=n("o0o1"),c=n.n(s),l=n("q1tI"),u=n.n(l),d=n("Ty5D"),p=n("55Ip"),f=n("SH7X"),h=n("47W4"),m=n.n(h),v=n("buk/"),g=n("67rm"),b=n("jDpt"),y=n("le8I"),w=n("V2U0"),O=n("vYzF"),k=n("1I/2"),x=n("pVnL"),P=n.n(x),C=n("X+Uv"),j=n("yDJO"),E=n("kyGY"),_=n("ufaa"),S=Object(_.a)()(Object(v.e)()((function(e){var t=e.t;return!e.breakpoints.isMobile&&u.a.createElement(E.a,null,t("Notes.List.latest_notes"))}))),M=n("7YkG"),D=n("GoJ1"),N=n("KXWi"),I=n("780l"),T=n("lSNA"),A=n.n(T),R=n("mwIZ"),L=n.n(R),F=n("AHTZ"),U=n("X3v2"),z=n("MEpN"),B=[["date",{inline:!0,group:"inline",selectable:!0,attrs:{timestamp:{default:""}},parseDOM:[{tag:'span[data-node-type="date"]'}]}],["status",{inline:!0,group:"inline",selectable:!0,attrs:{text:{default:""},color:{default:""},localId:{default:"adf1f61a-da02-4a41-a6c3-183fdcac102d"},style:{default:""}},parseDOM:[{tag:'span[data-node-type="status"]'}]}],["doc",{content:"(block)+",marks:"alignment breakout indentation link unsupportedMark unsupportedNodeAttribute"}],["paragraph",{selectable:!1,content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",selectable:!1,parseDOM:[{tag:"ul"}],marks:"unsupportedMark unsupportedNodeAttribute"}],["orderedList",{group:"block",content:"listItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph | mediaSingle | codeBlock) (paragraph | bulletList | orderedList | mediaSingle | codeBlock)*",marks:"link unsupportedMark unsupportedNodeAttribute",defining:!0,selectable:!1,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["codeBlock",{attrs:{language:{default:null},uniqueId:{default:null}},content:"text*",marks:"unsupportedMark unsupportedNodeAttribute",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"},{tag:"div[style]",preserveWhitespace:"full"},{tag:"table[style]",preserveWhitespace:"full"},{tag:"div.code-block",preserveWhitespace:"full"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList )+",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["mediaSingle",{inline:!1,group:"block",selectable:!0,atom:!0,content:"media | media ( unsupportedBlock)",attrs:{width:{default:null},layout:{default:"center"}},marks:"unsupportedMark unsupportedNodeAttribute link",parseDOM:[{tag:'div[data-node-type="mediaSingle"]'}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["media",{selectable:!0,attrs:{id:{default:""},type:{default:"file"},collection:{default:""},occurrenceKey:{default:null},alt:{default:null},width:{default:null},height:{default:null},url:{default:null},__fileName:{default:null},__fileSize:{default:null},__fileMimeType:{default:null},__displayType:{default:null},__contextId:{default:null},__external:{default:!1}},parseDOM:[{tag:'div[data-node-type="media"]'},{tag:'img[src^="data:image"]',ignore:!0},{tag:"img:not(.smart-link-icon)"}]}],["tableHeader",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"link alignment unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"th"}]}],["tableRow",{selectable:!1,content:"(tableCell | tableHeader)+",marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"row",parseDOM:[{tag:"tr"}]}],["tableCell",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"link alignment unsupportedMark unsupportedNodeAttribute",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}]],V=[["link",{excludes:"link color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"[data-block-link]"},{tag:"a[href]",context:"paragraph/|heading/|mediaSingle/"},{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{tag:"span"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}},{tag:"span",style:"vertical-align=super"},{tag:"span",style:"vertical-align=sub"}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}],["alignment",{excludes:"alignment indentation",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div.fabric-editor-block-mark"}]}],["breakout",{spanning:!1,inclusive:!1,parseDOM:[{tag:"div.fabric-editor-breakout-mark"}],attrs:{mode:{default:"wide"}}}],["indentation",{excludes:"indentation alignment",group:"indentation",attrs:{level:{}},parseDOM:[{tag:"div.fabric-editor-indentation-mark"}]}],["unsupportedMark",{attrs:{originalValue:{}}}],["unsupportedNodeAttribute",{attrs:{type:{},unsupported:{}}}]];function W(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var q={nodes:B,marks:V},K={nodes:W(B),marks:W(V)},G=(new z.Schema(K),n("pZg0")),J=n.n(G);function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){A()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Y(){var e,t=$(new URLSearchParams(window.location.search));try{for(t.s();!(e=t.n()).done;){var n=o()(e.value,2),r=n[0],i=n[1];if("returnUrl"===r)return i}}catch(a){t.e(a)}finally{t.f()}}function Z(e,t){return ee.apply(this,arguments)}function ee(){return(ee=i()(c.a.mark((function e(t,n){var r,i,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.models.note.fetchURL(t,n),i=window.location.toString(),e.t0=URL,e.next=5,r;case 5:return e.t1=e.sent,(a=new e.t0(e.t1)).searchParams.set("returnUrl",i),e.abrupt("return",a.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=i()(c.a.mark((function e(t){var n,r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").getOwnPermissions();case 2:if(n=e.sent,r=L()(n,"data.attributes.permissions")){e.next=6;break}throw"can't get self permissions";case 6:return i=Object.values(r),e.abrupt("return",i.filter((function(e){return f.models.permission.isForType(e,"io.cozy.files")})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){return ie.apply(this,arguments)}function ie(){return(ie=i()(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.query(t.find("io.cozy.files").getById(n)).then((function(e){return e&&e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t){return oe.apply(this,arguments)}function oe(){return(oe=i()(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t,n);case 2:return r=e.sent,e.abrupt("return",f.models.permission.isDocumentReadOnly({document:r,client:t,writability:["PATCH"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return ce.apply(this,arguments)}function ce(){return(ce=i()(c.a.mark((function e(t){var n,r,i,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te(t);case 2:if(!((n=e.sent.filter((function(e){return f.models.permission.isForType(e,"io.cozy.files")&&e.values&&e.values.length>0}))).length<1)){e.next=7;break}throw new Error("No individual io.cozy.files permissions in current context");case 7:(n.length>1||n[0].values.length>1)&&console.warn("There are more than one permission for a file in current context. Let's take the first one, but it may not be the one you expect");case 8:return r=n[0],i=r.values[0],a=f.models.permission.isReadOnly(r,{writability:["PATCH"]}),e.abrupt("return",{id:i,readOnly:a});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){return"/folder/".concat(e)}function ue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new URL(e.getStackClient().uri),r=e.getInstanceOptions(),i=r.subdomain,a="drive",o=null!==t?le(t):"",s=Object(F.b)({cozyUrl:n.origin,slug:a,subDomainType:i,nativePath:o});return s}function de(){var e=Object(U.b)(),t=Object(U.a)(e.app.prefix||J.a.name_prefix,""),n=Object(U.a)(e.app.name,J.a.name);return""!=t?"".concat(t," ").concat(n):n}function pe(e){return e.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:H(H({},q),{},{version:3})}}})}var fe=6e4,he=60*fe,me=24*he,ve=31*me,ge=365*me,be=[[1e4,"just_now",1e3,1],[1*fe,"secs_ago",1e3,10],[2*fe,"min_ago",fe,1],[5*fe,"mins_ago",fe,1],[20*fe,"mins_ago",fe,5],[1*he,"mins_ago",fe,10],[2*he,"hour_ago",he,1],[1*me,"hours_ago",he,1],[2*me,"day_ago",me,1],[1*ve,"days_ago",me,1],[2*ve,"month_ago",ve,1],[1*ge,"monthes_ago",ve,1],[2*ge,"year_ago",ge,1],[1/0,"years_ago",ge,1]];function ye(e){var t=e.className,n=Object(v.f)().t,r=Object(f.useClient)(),a=Object(l.useState)(!1),s=o()(a,2),d=s[0],p=s[1],h=Object(l.useCallback)(i()(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.next=3,pe(r);case 3:return t=e.sent,n=t.data,e.next=7,Z(r,n);case 7:window.location.href=e.sent;case 8:case"end":return e.stop()}}),e)}))),[r]);return u.a.createElement(N.c,{onClick:h,type:"submit",busy:d,icon:"plus",label:n("Notes.Add.add_note"),extension:"narrow",className:t})}function we(e){var t=Object(f.useClient)()||e.client;return u.a.createElement(I.a,{onClick:i()(c.a.mark((function e(){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(t);case 2:return n=e.sent,r=n.data,e.next=6,Z(t,r);case 6:window.location.href=e.sent;case 7:case"end":return e.stop()}}),e)}))),icon:"plus",className:"u-c-pointer"})}var Oe,ke=n("4BeY"),xe=n.n(ke),Pe=n("IaFt"),Ce=n.n(Pe),je=new xe.a({id:"icon_note_empty_77efa79dd615f19897a8ed6ec9097298",use:"icon_note_empty_77efa79dd615f19897a8ed6ec9097298-usage",viewBox:"0 0 171 168",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 171 168" id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298">\n    <defs>\n        <path id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298_a" d="M.02.12h36.532v20.674H.02z" />\n    </defs>\n    <g fill="none" fill-rule="evenodd">\n        <path fill="#0DCBCF" d="M48.367 47.28c3.795-4.135 9.702 2.27 5.938 6.374-8.105 8.832-11.21 22.848-5.617 33.864 6.83 13.453 25.138 8.377 36.387 4.37 5.26-1.871 7.054 6.655 1.834 8.515-15.343 5.464-37.282 8.714-45.942-8.858-7.276-14.767-3.455-32.433 7.4-44.265" />\n        <path fill="#D6FAFB" d="M59.57 16.922c.739-4.162 1.797-8.167 3.764-11.417C66.807-.21 73.009-.675 79.69.561c3.047.47 76.99 11.012 78.873 11.76 6.957 2.843 7.343 8.129 5.837 14.148-.141.971-20.067 84.443-21.43 88.854-1.852 5.978-4.906 11.375-10.609 11.973-5.714.623-75.27-18.403-78.5-19.534-3.954-1.39-5.72-3.632-6.159-6.323-.603-1.443-.376-3.088-.067-5.144.8-5.412 8.228-69.79 11.935-79.373" />\n        <path fill="#FFF" d="M65.047 19.073S64.561 3.301 79.004 5.122c14.443 1.819 89.593 13.951 89.593 13.951v9.972l-15.17 7.281-88.38-17.253z" />\n        <path fill="#ACF5F7" d="M53.622 31.458c.246-4.25.829-8.372 2.413-11.844 2.795-6.122 8.927-7.314 15.747-6.87 3.103.105 6.245.706 8.959 1.155 13.33 2.21 60.933 9.536 62.437 9.936.853.239 3.242 1.012 3.93 1.337 5.173 2.422 4.26 6.643 3.56 12.102-.023.988-10.066 86.694-10.903 91.263-1.155 6.187-3.561 11.933-9.185 13.21-5.636 1.297-77.342-9.496-80.695-10.235-4.111-.928-6.143-2.958-6.897-5.597-.781-1.368-.738-3.034-.675-5.12.157-5.506 8.735-79.333 11.309-89.337" />\n        <path fill="#79ECEE" d="M134.818 99.416c4.069-24.17 8.504-48.43 11.948-72.677.037-.293.209-1.305.35-1.515-.04-.744 2.317.264 4.506.067.068 0 .925-.114.992-.114.716-.138 1.42-.29 2.149-.552 3.554-1.285 4.98-4.27 4.938-7.584-.046-2.971-2.376-4.28-2.285-5.071.047-.427 2.619.902 2.915 1 .405.133 3.131 1.892 4.372 4.065 1.249 2.19.856 5.296.785 8.049-.244 9.277-8.008 66.518-9.51 78.49.026.153-.358 3.1-.546 4.417-.38 2.901-.772 5.807-1.182 8.707-.319 2.271-1.653 15.153-1.929 15.747-3.391 7.361-12.892 9.872-20.513 9.34-.434.025-.851-.016-1.524-.102-.844-.108-2.024.034-3.35-.235.145-2.458 5.937-30.472 7.884-42.032" />\n        <path fill="#FFF" d="M98.24 56.354c3.65-6.425 11.472-9.96 18.354-7.212a10.488 10.488 0 0 1 4.359 2.129c.117.074.22.173.33.253.099.086.2.171.29.253a10.141 10.141 0 0 1 3.012 3.703c.14.243.285.483.408.733.028.087.095.136.12.22.089.233.126.462.208.7.4 1.024.667 2.088.785 3.213.399 2.397.348 4.8-.468 7.371-1.431 4.512-6.871 6.769-11.066 7.466-3.062.503-6.549-.22-9.546-1.52-4.286-1.86-5.61-4.269-6.733-7.469-1.146-3.274-1.878-6.632-.054-9.84M57.875 49.863c1.7-3.323 4.417-5.416 7.697-6.62.072-.048.117-.104.197-.162 2.037-1.45 4.806-2 7.4-1.642 6.076.399 11.603 5.645 13.426 11.64.926 3.055.816 6.827-.747 9.66-2.345 4.249-6.24 6.338-10.86 7.305-7.715 1.625-16.183-3.686-18.103-11.22-.745-2.904-.38-6.293.99-8.961" />\n        <path fill="#FFF" d="M97.573 60.005c.542 1.111 2.285 1.832 3.325 1.161 1.116-.715 1.315-2.42.479-3.462-.451-.557-1.063-.82-1.666-.79a.296.296 0 0 0-.235-.062c-1.392.108-2.635 1.68-1.903 3.153M82.511 58.042c.543 1.11 2.287 1.83 3.325 1.159 1.12-.72 1.318-2.42.479-3.46-.453-.558-1.059-.82-1.668-.791a.295.295 0 0 0-.227-.065c-1.4.11-2.637 1.679-1.909 3.157" />\n        <path fill="#FFF" d="M83.12 55.648c.916-3.33 5.387-5.305 8.553-5.085 3.765.266 8.59 3.494 9.277 7.454.373 2.132-3.201 2.492-3.554.466-.782-4.47-8.893-6.614-10.702-2.003-.036.357-.226.713-.675 1.002-.022.023-.05.037-.07.05-1.412.921-3.292-.203-2.83-1.884" />\n        <path fill="#79ECEE" d="M130.887 48.194c1.972 3.09 7.333 4.648 10.183 2.337 3.064-2.497 3.1-7.587.281-10.373-1.511-1.495-3.399-2.072-5.16-1.798a1.058 1.058 0 0 0-.718-.108c-4.064.775-7.221 5.81-4.586 9.942M127.85 77.94c1.733 2.724 6.45 4.093 8.956 2.058 2.697-2.199 2.723-6.673.244-9.122-1.327-1.316-2.985-1.825-4.536-1.582a.938.938 0 0 0-.63-.094c-3.578.679-6.353 5.109-4.034 8.74M123.467 106.767c1.607 2.793 6.26 4.374 8.854 2.454 2.796-2.074 3.021-6.54.654-9.102-1.267-1.375-2.901-1.949-4.46-1.781a.948.948 0 0 0-.627-.127c-3.603.52-6.573 4.823-4.42 8.556" />\n        <path fill="#D6FAFB" d="M134.92 71.16l.384-.004c3.34-.056 4.832 2.564 4.435 4.87.819 3.035 6.732 4.083 9.188 4.55 3.327.638 6.204.138 7.935-1.695a5.354 5.354 0 0 0 .518-.67c.964-1.44 1.663-2.972 2.485-4.46.207-1.606.413-3.208.626-4.844 1.045.01 7.44.93 7.404 5.085-.061 7.397-4.113 11.963-9.873 13.901.007-.076.018-.156.03-.233a.106.106 0 0 0-.042.013l.012.22c-2.516.844-5.377 1.193-8.431 1.044-7.434-.364-19.518-4.398-19.253-13.56.07-2.467 2.191-4.176 4.582-4.217M155.979 103.575c.026.15-.358 3.097-.548 4.415-.379 2.903-.77 5.807-1.182 8.708-.04.298-.1.792-.173 1.41-.423.111-.846.232-1.267.325-9.933 2.216-23.748-2.264-26.83-12.978-1.387-4.823 5.737-6.845 8.28-3.535 3.25 3.006 6.375 4.279 10.726 4.987 2.315.378 9.589 1.174 10.133-1.001l.86-2.331z" />\n        <path fill="#D6FAFB" d="M155.43 107.99c.19-1.318.575-4.264.549-4.415.141-1.139.343-2.691.587-4.57 1.43-.943 3.35-1.181 4.91-.156 4.028 2.644 5.269 6.247 3.534 10.833-1.791 4.722-6.312 7.18-10.936 8.425.075-.617.134-1.11.175-1.409.412-2.901.803-5.805 1.182-8.708" />\n        <path fill="#0DCBCF" d="M97.295 86.818c.143-.42-.082-.821-.543-.907l-15.969-2.926c-.445-.086-.826.224-.826.667 0 0-.792 8.124 7.2 9.59 7.994 1.46 10.138-6.424 10.138-6.424M106.717 66.413a2.628 2.628 0 0 0 2.9-2.325c.148-1.137.803-3.051 3.438-2.757 2.873.313 2.836 2.714 2.758 3.44a2.632 2.632 0 0 0 2.32 2.906 2.635 2.635 0 0 0 2.902-2.328c.367-3.341-1.301-8.563-7.404-9.24-6.1-.67-8.868 4.061-9.233 7.399a2.623 2.623 0 0 0 2.319 2.905M65.97 60.55a2.618 2.618 0 0 0 2.898-2.323c.154-1.135.809-3.045 3.444-2.756 2.873.32 2.836 2.715 2.758 3.446a2.628 2.628 0 0 0 2.324 2.898 2.633 2.633 0 0 0 2.896-2.326c.369-3.336-1.295-8.561-7.399-9.232-6.107-.682-8.87 4.055-9.24 7.395a2.62 2.62 0 0 0 2.319 2.898M7.328 107.186s-4.037-2.086 6.805-8.374c10.108-5.864 7.278 10.253 7.278 10.253l-14.083-1.88z" />\n        <path fill="#DFFCFC" d="M77.122 128.065c-3.962-7.31-6.318-14.535-8.397-21.528-3.496-11.78-4.837-23.725-10.418-35.926-.384-.842-1.51-1.893-2.359-2.092a1247.17 1247.17 0 0 1-45.203-11.481C5.086 55.485.713 55.304.083 59.109c-.007.039-.016.076-.022.12-.14.995-.046 2.243.353 3.81.19.754.696 1.372 1.281 1.841C4.793 75.29 6.898 85.406 10.32 95.907c3.831 11.75 8.712 23.72 12.591 35.483.415 1.26 1.806 2.668 3.07 2.721.323.013.648.028.971.04 3.006 1.149 30.837 7.319 41.229 8.583 4.412.538 18.182 5.133 17.55-.856-.335-3.168-7.048-10.931-8.61-13.813" />\n        <path fill="#0DCBCF" d="M24.169 106.068c-4.748.862-9.072.078-13.23-2.376-3.782-2.232-6.633 3.978-2.878 6.194a24.375 24.375 0 0 0 16.752 2.983c4.29-.779 3.694-7.587-.644-6.801" />\n        <path fill="#0DCBCF" d="M26.43 113.925c-4.822.208-9-1.152-12.787-4.147-3.445-2.725-7.11 3.043-3.69 5.747a24.362 24.362 0 0 0 16.193 5.225c4.356-.19 4.689-7.017.284-6.825" />\n        <path fill="#0DCBCF" d="M27.7 121.497c-4.773-.725-8.608-2.867-11.746-6.535-2.856-3.338-7.566 1.615-4.73 4.929a24.372 24.372 0 0 0 14.88 8.249c4.313.653 5.952-5.982 1.595-6.643" />\n        <path fill="#D6FAFB" d="M56.82 163.387c2.634 1.707 9.394 3.19 14.841 3.785 14.866 1.625 35.651.773 44.451-2.186 8.875-2.98 9.27-7.505-13.293-9.77-19.21-1.926-41.628.772-46.423 4.818-1.286 1.083-1.211 2.293.423 3.353" />\n        <path fill="#FFF" d="M85.93 121.501l-8.872-2.495 5.144-7.99 53.966-19.197a4.453 4.453 0 0 1 5.686 2.7l.746 2.099a4.45 4.45 0 0 1-2.702 5.686L85.93 121.5z" />\n        <path fill="#0DCBCF" d="M154.388 66.712c-4.389-3.498-9.232 3.746-4.877 7.216 9.374 7.469 14.612 20.835 10.794 32.583-4.663 14.35-23.538 12.171-35.273 9.956-5.483-1.035-5.935 7.667-.492 8.695 16.003 3.021 38.184 2.835 44.015-15.867 4.9-15.715-1.61-32.577-14.167-42.583" />\n        <path fill="#0DCBCF" d="M117.57 120.966c-.858-.505-1.8-.82-2.724-.954.007-.692-.294-1.44-.896-2.045a5.36 5.36 0 0 0-1.042-.795c.604-.217 1.24-.4 1.767-.57 4.603-1.484-.888-7.006-5.49-5.523-4.248 1.372-8.193 3.504-7.248 7.418.244 1.01 1.247 2.234 2.773 2.788.09.031.177.056.268.09.235 1.784 2.018 3.698 4.6 4.72.32.126.656.225.99.326.556 1.45 2.692 2.89 4.895 2.99 5.026.234 8.746-1.607 9.6-4.766.4-1.491-1.568-3.332-3.883-3.906-1.418-.35-2.69-.218-3.61.227" />\n        <path fill="#0DCBCF" d="M116.74 108.083c-2.338-.522-12.208 2.855-5.111 5.063 1.627.505 1.248.814 2.754 1.558-.564.2-1.05.473-1.4.824-2.277.728-2.681 3.583-1.654 5.93 1.48 3.38 2.415 7.939 7.426 7.805 5.597-.148 12.373-6.007 12.023-9.417-.211-2.065-1.65-5.025-4.013-6.767-1.204-.887-7.684-4.475-10.024-4.996" />\n        <path fill="#0DCBCF" d="M118.038 108.505s-11.852-4.477-13.846-1.858c-1.799 2.363-5.817 10.49-3.131 10.95 2.683.463 10.129-2.62 10.129-2.62l6.848-6.472z" />\n        <g transform="translate(134.244 38.595)">\n            <mask id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298_b" fill="#fff">\n                <use xlink:href="#icon_note_empty_77efa79dd615f19897a8ed6ec9097298_a" />\n            </mask>\n            <path fill="#D6FAFB" d="M9.325 7.036c.397 5.93 8.7 6.329 13.777 4.795.42-.158.845-.317 1.23-.505a9.225 9.225 0 0 0 1.389-.872c.082-.06.995-.824 1.133-.954 1.086-1.008 2.065-2.238 2.415-3.433.248-2.072.485-4.087.695-5.947a8.54 8.54 0 0 1 2.63 1.137C34 2.191 34.869 3.2 35.499 4.768c.088.213.125.438.17.665.332.608.553 1.271.557 1.963 1.55 5.622-2.602 9.814-8.58 11.908.032-.244.058-.477.09-.717-.01.004-.02.011-.029.015-.018.233-.03.458-.061.702C17.12 22.994.906 20.164.03 7.036c-.365-5.393 8.932-5.393 9.294 0" mask="url(#icon_note_empty_77efa79dd615f19897a8ed6ec9097298_b)" />\n        </g>\n        <path fill="#ACF5F7" d="M67.018 83.907a4.967 4.967 0 1 1-9.935 0 4.966 4.966 0 0 1 4.967-4.967 4.967 4.967 0 0 1 4.968 4.967M73.57 105.824a4.967 4.967 0 1 1-9.935 0 4.966 4.966 0 0 1 4.966-4.966 4.967 4.967 0 0 1 4.969 4.966M80.564 124.544a4.967 4.967 0 0 1-4.968 4.966 4.966 4.966 0 0 1-4.967-4.966 4.967 4.967 0 1 1 9.935 0" />\n    </g>\n</symbol>'}),Ee=(Ce.a.add(je),je),_e=n("Le8U"),Se={_type:"io.cozy.apps",_id:"io.cozy.apps/notes"},Me=function(e){var t=Object(l.useState)(ue(e)),n=o()(t,2),r=n[0],a=n[1];return Object(l.useEffect)((function(){(function(){var t=i()(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,_e.CozyFolder.getReferencedFolders(Se);case 3:n=t.sent,r=ue(e,n[0]._id),a(r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),a(ue(e));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),{notesFolder:r}},De=n("sCMN"),Ne=n("dojK"),Ie=Object(v.e)()(Object(f.withClient)((function(e){var t=e.t,n=e.client,r=Me(n).notesFolder;return u.a.createElement("div",{className:"empty"},u.a.createElement(D.a,{id:"empty",icon:Ee,title:t("Notes.Empty.welcome"),text:u.a.createElement(De.a,{href:r,slug:Ne.h.Drive},(function(e){var n=e.href,r=e.onClick;return u.a.createElement("span",{className:"u-mb-half"},t("Notes.Empty.after_created")," ",u.a.createElement("a",{href:n,onClick:r},"Cozy Drive"),".")}))},u.a.createElement(ye,{className:"u-mt-1"})))}))),Te=n("FFOw"),Ae=n("y6ex"),Re=n("lEaz"),Le=n("UxX4"),Fe=new xe.a({id:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d",use:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d">\n<style type="text/css">\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st0{fill-rule:evenodd;clip-rule:evenodd;fill:#ACF5F7;}\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st1{fill-rule:evenodd;clip-rule:evenodd;fill:#0DCBCF;}\n</style>\n<g transform="translate(2)">\n\t<path class="st0" d="M0,2c0-1.1,0.9-2,2-2h22c1.1,0,2,0.9,2,2v28c0,1.1-0.9,2-2,2H2c-1.1,0-2-0.9-2-2V2z" />\n\t<path class="st1" d="M6,8h14v2H6V8z M6,12h8v2H6V12z M6,16h14v2H6V16z M6,20h10v2H6V20z" />\n</g>\n<g transform="translate(0 4)">\n\t<path class="st1" d="M1.5,0h2C4.3,0,5,0.7,5,1.5l0,0C5,2.3,4.3,3,3.5,3h-2C0.7,3,0,2.3,0,1.5l0,0C0,0.7,0.7,0,1.5,0z" />\n\t<path class="st1" d="M1.5,7h2C4.3,7,5,7.7,5,8.5l0,0C5,9.3,4.3,10,3.5,10h-2C0.7,10,0,9.3,0,8.5l0,0C0,7.7,0.7,7,1.5,7z" />\n\t<path class="st1" d="M1.5,14h2C4.3,14,5,14.7,5,15.5l0,0C5,16.3,4.3,17,3.5,17h-2C0.7,17,0,16.3,0,15.5l0,0C0,14.7,0.7,14,1.5,14z" />\n\t<path class="st1" d="M1.5,21h2C4.3,21,5,21.7,5,22.5l0,0C5,23.3,4.3,24,3.5,24h-2C0.7,24,0,23.3,0,22.5l0,0C0,21.7,0.7,21,1.5,21z" />\n</g>\n<g>\n\t<path class="st1" d="M31.4,18.4l-2.8-2.8c0.8-0.8,2-0.8,2.8,0S32.2,17.6,31.4,18.4z" />\n\t<path class="st1" d="M30.7,19.1L20.8,29l-2.5,0.9c-0.5,0.2-1.1-0.1-1.3-0.6c-0.1-0.2-0.1-0.5,0-0.7l0.9-2.5l9.9-9.9L30.7,19.1z" />\n</g>\n</symbol>'}),Ue=(Ce.a.add(Fe),Fe),ze=n("RMII"),Be=n.n(ze),Ve=function(e){var t=e.hideOn,n=e.showOn,r=e.children,i=Object(k.b)(),a=t&&i[t],o=n&&i[n],s=u.a.createElement(u.a.Fragment,null,r);return t?a?null:s:n?o?s:null:s};!function(e){e.ExtraLarge="isExtraLarge",e.Large="isLarge",e.Medium="isMedium",e.Small="isSmall",e.Tiny="isTiny",e.Desktop="isDesktop",e.Tablet="isTablet",e.Mobile="isMobile"}(Oe||(Oe={}));var We=n("UP3J"),qe=function(e){return null!==e&&"string"!=typeof e&&e},Ke=function(e){return e.stopPropagation()},Ge=function(e){var t=e.drivePath,n=e.path,r=e.target;return u.a.createElement(De.a,{href:t,slug:Ne.h.Drive},(function(e){var t=e.href;return u.a.createElement(We.a,P()({href:t,onClick:Ke},r&&"_blank"===r?{target:"_blank",rel:"noreferrer noopener"}:{target:r}),function(e){var t;return(null===(t=/(.+)(\/.+)$/.exec(e))||void 0===t?void 0:t[1])||e}(n))}))},Je=Object(v.e)()(Object(f.withClient)((function(e){var t=e.note,n=e.f,r=e.t,a=e.client,s=_e.CozyFile.splitFilename(t),d=s.filename,p=s.extension,f=Object(l.useState)(!1),h=o()(f,2),m=h[0],v=h[1],b=Object(l.useCallback)((function(e){v(!0),e.stopPropagation()}),[v]),y=Object(l.useCallback)((function(){return v(!1)}),[v]),w=Object(l.useCallback)(i()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.destroy(t);case 3:v(!1),g.a.info(r("Notes.Delete.deleted")),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),g.a.error(r("Notes.Delete.failed"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[a,t,r,v]),O=Object(l.useMemo)((function(){return ue(a,t.dir_id)}),[a,t]),k=u.a.createRef(),x=function(){var e=i()(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(a,t);case 2:n=e.sent,window.location.href=n;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.a.createElement(u.a.Fragment,null,u.a.createElement(M.f,{className:"u-c-pointer ".concat(Be.a.tableRow),role:"button",tabIndex:"0",onKeyDown:function(e){"Enter"===e.key&&x()},onClick:x},u.a.createElement(M.c,{className:"".concat(Be.a.tableCellName," u-flex u-flex-items-center u-fz-medium")},u.a.createElement(Ae.a,{icon:Ue,size:32,className:"u-mr-1 u-flex-shrink-0"}),u.a.createElement("div",{className:"u-flex-grow-1"},u.a.createElement("span",{className:"u-charcoalGrey u-ellipsis"},d),u.a.createElement(Ve,{hideOn:Oe.Mobile},u.a.createElement("span",{className:"u-ellipsis"},p)),u.a.createElement(Ve,{showOn:Oe.Mobile},u.a.createElement(Ge,{drivePath:O,path:t.path,target:"_blank"})))),u.a.createElement(Ve,{hideOn:Oe.Mobile},u.a.createElement(M.c,{className:Be.a.tableCell},r("Notes.List.at",{date:n(t.updated_at,"DD MMMM"),time:n(t.updated_at,"HH:mm")})),u.a.createElement(M.c,{className:"".concat(Be.a.tableCell," u-flex-shrink-0")},u.a.createElement(Ge,{drivePath:O,path:t.path,target:"_blank"})),u.a.createElement(M.c,{className:Be.a.tableCell},u.a.createElement(Te.a,{docId:t._id,size:24}))),u.a.createElement(M.c,{className:Be.a.tableCell},u.a.createElement("span",{ref:k},u.a.createElement(Re.a,{onClick:b},u.a.createElement(Ae.a,{icon:"dots"}))))),m&&u.a.createElement(Le.b,{onClose:y,anchorElRef:k,popperOptions:{strategy:"fixed"}},u.a.createElement(Le.a,{onClick:w,left:u.a.createElement(Ae.a,{icon:"trash"})},r("Notes.Delete.delete_note"))))}))),Qe=function(){return u.a.createElement(M.f,{className:Be.a.tableSpecialRow},u.a.createElement(M.c,{className:Be.a.tableCellEmpty},u.a.createElement(Ie,null)))},He=function(){return u.a.createElement(M.f,{className:Be.a.tableSpecialRow},u.a.createElement(M.c,{className:"".concat(Be.a.tableCellEmpty," u-ta-center")},u.a.createElement(w.a,{size:"xxlarge"})))},$e=Object(v.e)()((function(e){var t=e.t,n=e.notes,r=e.fetchStatus;return u.a.createElement(M.a,{className:Be.a.table},u.a.createElement(M.d,null,u.a.createElement(M.f,null,u.a.createElement(M.e,{className:Be.a.tableCellName},t("Notes.List.name")),u.a.createElement(Ve,{hideOn:Oe.Mobile},u.a.createElement(M.e,{className:Be.a.tableCell},t("Notes.List.updated_at")),u.a.createElement(M.e,{className:"".concat(Be.a.tableCell," u-flex-shrink-0")},t("Notes.List.location")),u.a.createElement(M.e,{className:Be.a.tableCell},t("Notes.List.sharings"))),u.a.createElement(M.e,{className:Be.a.tableCell}))),u.a.createElement(M.b,null,"loading"===r?u.a.createElement(He,null):0===n.length?u.a.createElement(Qe,null):n.map((function(e){return u.a.createElement(Je,{note:e,key:e._id})}))))})),Xe=function(e,t){return"loaded"===e&&t.length>0},Ye=function(){var e=cozy.bar.BarRight,t=Object(v.f)(),n=Object(f.useClient)();return u.a.createElement(f.Query,{query:function(){return Object(f.Q)("io.cozy.notes")}},(function(r){var i=r.data,a=r.fetchStatus;return u.a.createElement(u.a.Fragment,null,u.a.createElement(C.a,null,u.a.createElement(Ve,{hideOn:Oe.Mobile},u.a.createElement("div",{className:"".concat(Be.a.appHeader," u-flex u-flex-justify-between u-flex-items-center u-mt-1")},u.a.createElement(S,null),Xe(a,i)&&u.a.createElement(ye,null))),u.a.createElement($e,{notes:i,fetchStatus:a})),Xe(a,i)&&u.a.createElement(Ve,{showOn:Oe.Mobile},u.a.createElement(e,null,u.a.createElement(j.a,P()({store:n.store,client:n},t),u.a.createElement(we,null)))))}))},Ze=n("17x9"),et=n.n(Ze),tt=n("95Bo"),nt=n("59M3"),rt=n("t9Ym"),it=n("jWvl"),at=n("KXVJ"),ot=n("B9Y0"),st={allowBreakout:!0,allowTextColor:!0,allowTextAlignment:!0,allowIndentation:!0,allowTables:{allowColumnSorting:!0,allowColumnResizing:!0,allowMergeCells:!0,allowNumberColumn:!0,allowBackgroundColor:!0,allowHeaderRow:!0,allowHeaderColumn:!0,permittedLayouts:"all",stickToolbarToBottom:!0},allowPanel:!0,allowStatus:!0,allowRule:!0,allowDate:!0},ct=function(e){return u.a.createElement("header",{className:"page-header-menu "+(e.className||"")},u.a.createElement("div",{className:"page-header-menu--left"},e.left),e.children,u.a.createElement("div",{className:"page-header-menu--right"},e.right))},lt=n("Q2Eh"),ut=n.n(lt);var dt=function(e,t,n){return Promise.resolve((function(r,a){var o=document.createElement(Ne.b.Input);o.setAttribute("accept","image/*"),o.type=Ne.e.File,o.dispatchEvent(new MouseEvent(Ne.d.Click)),o.addEventListener(Ne.d.Change,(function(){var r,s=new window.FileReader,l=null===(r=o.files)||void 0===r?void 0:r[0];if(!l)throw Error(Ne.c.NoFileFoundAfterInput);s.readAsArrayBuffer(l),s.onloadend=i()(c.a.mark((function r(){var i,o,u;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=qe(s.result)){r.next=3;break}throw Error(Ne.c.FileNotProcessable);case 3:return r.prev=3,n(!0),r.next=7,e.serviceClient.postImage(l.name,e.config.noteId,i,l.type);case 7:o=r.sent,u=o.data.id,a({src:u}),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(3),g.a.error(t(void 0!==r.t0.status?"Error.".concat(r.t0.status):"Error.unknown_error"),{duration:4e3});case 15:return r.prev=15,n(!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[3,12,15,18]])})))}))}))};var pt=function(){};var ft=function(e){var t=e.defaultValue,n=e.onTitleChange,r=e.onTitleBlur,i=e.defaultTitle,a=e.title,s=e.collabProvider,c=e.leftComponent,d=e.rightComponent,p=e.onContentChange,f=e.readOnly,h=e.bannerRef,m=Object(v.f)().t,g=Object(l.useRef)(null),b=Object(l.useCallback)((function(e){n&&n(e)}),[n]);Object(l.useMemo)((function(){return s&&s.setReadOnly(!!f)}),[f,s]);var y=Object(l.useMemo)((function(){return s&&{useNativePlugin:!0,provider:Promise.resolve(s),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:s.serviceClient.getSessionId()}}),[s]);Object(l.useEffect)((function(){var e;(e=g.current)&&(e.style.height="".concat(e.scrollHeight,"px"))}),[a]),Object(at.a)(g.current,"blur",r);var O=Object(l.useState)(!1),k=o()(O,2),x=k[0],C=k[1];return u.a.createElement("article",{className:ut.a["note-article"]},x&&u.a.createElement(ot.a,null,u.a.createElement(w.a,{size:"xxlarge",middle:!0})),u.a.createElement("style",null,"#coz-bar ","{ display: none }"),u.a.createElement(ct,{left:c,className:"note-header-menu--editing",right:d}),u.a.createElement("section",{className:"note-editor-container"},u.a.createElement(nt.a,P()({},st,{disabled:!s&&f,collabEdit:y,onChange:p||pt,defaultValue:t,appearance:"full-page",placeholder:m("Notes.EditorView.main_placeholder"),shouldFocus:!f,legacyImageUploadProvider:dt(s,m,C),primaryToolbarComponents:e.primaryToolbarComponents,contentComponents:u.a.createElement(rt.a,{render:function(){return u.a.createElement(u.a.Fragment,null,u.a.createElement("aside",{ref:h,className:ut.a.banner}),u.a.createElement(E.a,{tag:"h1",className:ut.a.title},u.a.createElement(it.a,{ref:g,rows:"1",readOnly:!!f,fullwidth:!0,value:a,onChange:f?pt:b,placeholder:i,className:ut.a.titleInput})))}})}))))},ht=n("SOfb"),mt=n("9jN0"),vt=n("DA+R");var gt=function(e){var t=e.cozyClient,n=e.file,r=Object(l.useState)(void 0),a=o()(r,2),s=a[0],u=a[1];return Object(l.useEffect)((function(){function e(){return(e=i()(c.a.mark((function e(n){var r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.models.file.normalize(n),e.prev=1,e.next=4,t.query(t.get("io.cozy.files",r.attributes.dir_id));case 4:i=e.sent,u(f.models.file.ensureFilePath(r,i.data)),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.warn("Request failed when try to fetch the parent ".concat(r.attributes.dir_id," of io.cozy.files ").concat(r.id)),u(null);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}!function(t){e.apply(this,arguments)}(n)}),[t,n,n.attributes.dir_id]),s&&s.id==n.id?s:void 0},bt=n("R3/7"),yt=n.n(bt);function wt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(n),!0).forEach((function(t){A()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kt(e){var t=Object(f.useClient)(),n=gt({cozyClient:t,file:e.file}),r=Object(l.useState)(!1),i=o()(r,2),a=i[0],s=i[1],c=Object(l.useCallback)((function(){return s(!a)}),[a]),d=Object(l.useCallback)((function(){return s(!1)}),[]);if(!n)return null;var p=n.id;return u.a.createElement(u.a.Fragment,null,u.a.createElement(mt.a,{theme:"primary",docId:p,onClick:c,extension:"narrow",className:yt.a["sharing-button"]}),a&&u.a.createElement(vt.a,{document:Ot(Ot({},n),{},{name:e.title}),documentType:"Files",onClose:d,sharingDesc:e.title}))}var xt=function(e){var t=e.doc,n=e.isPublic,r=e.isReadOnly,i=e.title,a=Object(v.f)().t;return n?r?u.a.createElement(ht.a,{title:a("Notes.Editor.read_only")},u.a.createElement(Ae.a,{icon:"lock",color:"var(--primaryTextColor)"})):null:u.a.createElement(kt,{file:t.file,title:i})};xt.propTypes={doc:et.a.object.isRequired,isPublic:et.a.bool.isRequired,isReadOnly:et.a.bool.isRequired};var Pt=xt;var Ct=function(){return u.a.createElement("div",{className:"u-mv-3"},u.a.createElement(w.a,{size:"xxlarge",middle:!0}))};var jt=Object(v.e)()((function(e){var t=e.t,n=e.returnUrl;return u.a.createElement(D.a,{icon:"cross-small",title:t("Error.loading_error_title"),text:u.a.createElement("p",{className:"u-mb-half",dangerouslySetInnerHTML:{__html:n?t("Error.loading_error_text_returnUrl",{url:n}):t("Error.loading_error_text_noReturnUrl")}})})})),Et=n("h+bj"),_t=n("Jl/m"),St=n("84gJ"),Mt=n.n(St),Dt=n("i8i4"),Nt=n.n(Dt),It=n("tRbT"),Tt=n("tNlo"),At=n("H2TA"),Rt=n("yWSb"),Lt=n.n(Rt),Ft=Object(At.a)({tooltipPlacementBottom:{margin:"12px 24px"},tooltipPlacementTop:{margin:"12px 24px"}},{name:"MuiTooltip"})(ht.a);function Ut(e){return u.a.createElement(Ft,{title:e.content,open:e.open||void 0,key:e.open?"open":"auto"},e.children)}function zt(e){var t=e.bannerRef&&e.bannerRef.current;return t?Nt.a.createPortal(u.a.createElement("div",{className:Lt.a.banner},e.content),t):null}function Bt(e){var t=Object(v.f)().t,n=Object(k.b)().isMobile,r=u.a.createElement(It.a,{direction:"row",container:!0,wrap:"nowrap",spacing:1,className:Lt.a.grid},u.a.createElement(It.a,{item:!0},u.a.createElement(Tt.a.Round,{className:Lt.a.chip},u.a.createElement(Ae.a,{icon:"offline",color:"var(--black)"}))),u.a.createElement(It.a,{item:!0},t("Notes.OfflineIndicator.message"))),i=n?zt:Ut;return u.a.createElement(i,{open:e.open,content:r,bannerRef:e.bannerRef},e.children)}var Vt=n("DzJC"),Wt=n.n(Vt);var qt=function(e){var t=Object(v.f)().t,n=Object(k.b)().isMobile,r=new Date,i=e.collabProvider,a=r-(i.getLastSaveOrSync()||r),s=i.isDirty(),c=r-i.getDirtySince();!function(e){var t=Object(l.useState)(null),n=o()(t,2)[1],r=Object(l.useCallback)(Wt()((function(){return n(new Date)}),200),[n]);Object(l.useEffect)((function(){return e.on("collab-state-change",r),function(){return e.off("collab-state-change",r)}}),[e,r])}(i);var d,p=function(e){var t=e.isOutOfSync,n=new Date,r=Object(_t.a)()||t,i=Object(l.useMemo)((function(){return new Date}),[r]);return{isDisconnected:r,disconnectedAge:r?n-i:0}}({isOutOfSync:function(e){var t=e.isDirty,n=e.dirtyAge;return t&&n&&n>3e4}({isDirty:s,dirtyAge:c})}),f=p.isDisconnected,h=p.disconnectedAge,m=function(e){var t=e.disconnectedAge,n=e.isDisconnected&&t<5e3,r=5e3-t;return Object(Et.a)(n&&r),n}({isDisconnected:f,disconnectedAge:h}),g=function(e,t){var n=(t||be).find((function(t){return e<t[0]})),r=o()(n,4),i=r[1],a=r[2],s=r[3];return{key:i,unit:a,coef:s,time:Math.floor(e/a/s)*s,interval:a*s}}(f?h:s?c:a),b=g.key,y=g.time,w=g.interval;Object(Et.a)(w),d=s?f?"saving_impossible.".concat(b):c>5e3?"still_saving":"saving":f?"out_of_sync.".concat(b):"saved.default";var O=t("Notes.SavingIndicator.".concat(d),{time:y}),x=u.a.createElement(E.b,{className:Mt.a["saving-indicator"]},O);return f?u.a.createElement(Bt,{open:m,bannerRef:e.bannerRef},x):n?null:x},Kt=n("lwsE"),Gt=n.n(Kt),Jt=n("W8MJ"),Qt=n.n(Jt),Ht=n("G2JP"),$t=function(){function e(){Gt()(this,e)}return Qt()(e,[{key:"preventDefault",value:function(){this.prevented=!0}}]),e}();function Xt(e,t,n){var r=function(){var e=new $t;n&&n(e),e.prevented||(document.location=t)};return function(t){t.preventDefault(),e(r)}}function Yt(e){var t=e.returnUrl,n=e.file,r=e.requestToLeave,i=Object(l.useContext)(Ht.a);if(t){var a=le(f.models.file.getParentFolderId(n));return u.a.createElement(De.a,{slug:Ne.h.Drive,href:t,nativePath:a},(function(e){var t=e.onClick,n=e.href;return u.a.createElement(N.b,{icon:"previous",onClick:Xt(r,n,t),href:n,className:"sto-app-back",subtle:!0})}))}if(i)return null;return u.a.createElement(N.a,{icon:"previous",href:"#/",onClick:Xt(r,"#/"),className:"sto-app-back",subtle:!0})}var Zt=function(e){var t=e.serviceClient,n=e.noteId,r=e.readOnly,a=Object(l.useState)(n),s=o()(a,2),u=s[0],d=s[1],p=Object(l.useState)(!0),f=o()(p,2),h=f[0],m=f[1],v=Object(l.useState)(void 0),g=o()(v,2),b=g[0],y=g[1],w=Object(l.useState)(void 0),O=o()(w,2),k=O[0],x=O[1];return Object(l.useEffect)((function(){function e(){return(e=i()(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h||m(!0),e.next=4,t.getDoc(u);case 4:if(n=e.sent,r||3===n.schemaVersion){e.next=9;break}return e.next=8,t.updateSchema(u,q);case 8:n=e.sent;case 9:x(n.title||""),y(n),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(0),x(!1),y(!1),console.warn("Could not load note ".concat(u));case 18:m(!1);case 19:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}u!==n?(m(!0),x(void 0),y(void 0),d(n)):t&&(b&&b.file.id===u||function(){e.apply(this,arguments)}())}),[n,u,d,m,t,y,x]),u===n?{loading:h,title:k,doc:b,setTitle:x}:{loading:!0,title:void 0,doc:void 0,setTitle:x}};function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(Object(n),!0).forEach((function(t){A()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nn=function(){function e(t){var n=this;Gt()(this,e),A()(this,"postImage",function(){var e=i()(c.a.mark((function e(t,r,i,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.stackClient.fetchJSON("POST",n.path(r,"images?Name=".concat(t)),i,{headers:{"Content-Type":a}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());var r=t.userId,a=t.cozyClient,o=t.schema,s=t.realtime,l=new Date,u=l.getTime()+"."+l.getMilliseconds()+"."+Math.random();this.sessionId=r+":"+u,this.userId=this.getUserId(r),this.cozyClient=a,this.stackClient=a.getStackClient(),this.schema=o,this.schemaVersion=3,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=s||a.plugins.realtime,this.resetCallbacks()}var t,n,r,a,o,s,l,u,d,p,f,h,m;return Qt()(e,[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return tn({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return tn({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(m=i()(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||q}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"updateSchema",value:(h=i()(c.a.mark((function e(t,n){var r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",this.path(t,"schema"),{data:{type:"io.cozy.notes.documents",attributes:{schema:tn(tn({},n),{},{version:3})}}});case 2:return r=e.sent,i=this.formatDoc(r),this.schemaVersion=i.schemaVersion,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"sync",value:(f=i()(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",this.path(t,"sync"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"setTitle",value:(p=i()(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype||e.type;if("file"===n&&(n="io.cozy.files"),this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not managed",n,t,this.callbacks)}},{key:"join",value:(d=i()(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.realtime.subscribe(null,"io.cozy.notes.events",t,this.onRealtimeEvent)]);case 2:this.realtime.subscribe("UPDATED","io.cozy.files",t,this.onRealtimeEvent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"onStepsCreated",value:(u=i()(c.a.mark((function e(t,n){var r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(l=i()(c.a.mark((function e(t,n){var r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"onSchemaUpdated",value:(s=i()(c.a.mark((function e(t,n){var r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.files",t,(function(e){if(e.metadata.schema.version!==r.schemaVersion)return n(e)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"onTitleUpdated",value:(o=i()(c.a.mark((function e(t,n){var r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,(function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDoc",value:(a=i()(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,r=this.formatDoc(n),this.schemaVersion=r.schemaVersion,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"formatDoc",value:function(e){return{doc:e.data.attributes.metadata.content,version:e.data.attributes.metadata.version,title:e.data.attributes.metadata.title,updatedAt:new Date(e.data.attributes.updated_at),file:e.data,schemaVersion:e.data.attributes.metadata.schema.version}}},{key:"pushSteps",value:(r=i()(c.a.mark((function e(t,n,r){var i,a,o=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={headers:{"if-match":n}},a={data:r.map((function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}}))},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),a,i);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSteps",value:(n=i()(c.a.mark((function e(t,n){var r,i,a,o,s,l,u,d,p,f,h=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return i=r.data.map((function(e){return h.server2client(e.attributes)})),a=r.data[r.data.length-1].attributes.version,e.abrupt("return",{version:a,steps:i});case 11:e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(0),o=e.t0.response,s=e.t0.reason&&e.t0.reason.data,l=s&&s.attributes&&s.attributes.metadata,u=l&&l.content,d=l&&l.version,412!=o.status||!u||!d){e.next=27;break}return f={_id:t,_type:"io.cozy.notes.events",doctype:p="io.cozy.notes.documents",title:l.title},this.callbacks[p]&&this.callbacks[p][t]&&this.callbacks[p][t](f),e.abrupt("return",{doc:u,version:d});case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pushTelepointer",value:(t=i()(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();var rn=function(e){var t=e.userId,n=e.userName,r=e.cozyClient;return Object(l.useMemo)((function(){return new nn({userId:t,userName:n,cozyClient:r})}),[r,t,n])},an=n("RIqP"),on=n.n(an),sn=n("cjKa"),cn=n("RsOk"),ln=n("bfWj"),un=n("mgfL"),dn=n.n(un),pn=n("BCfO"),fn=n.n(pn),hn=n("oON/"),mn=n.n(hn),vn=n("D1y2"),gn=n.n(vn);function bn(e,t){var n=fn()("debug.".concat(e));Object(l.useEffect)((function(){n&&yn(e,t)}),[n,e,t])}function yn(e,t){gn()(window,"cozy.debug.".concat(e),t)}gn()(window,"cozy.debug.showSwitcher",(function(){return dn()("switcher",!0)})),gn()(window,"cozy.debug.notes.debugCollab",function(){var e=i()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return dn()("debug.client",!0),dn()("debug.notes.service",!0),dn()("debug.notes.collabProvider",!0),dn()("debug.notes.channel",!0),dn()("debug.notes.noteId",!0),dn()("debug.notes.doc",!0),dn()("debug.notes.file",!0),dn()("debug.notes.returnUrl",!0),dn()("debug.notes.dirtyRef",!0),dn()("debug.notes.lastPatchError",!0),e.next=12,new Promise((function(e){window.setTimeout(i()(c.a.mark((function t(){var n,r,a,o,s,l,u,d,p,f,h,m,v,g,b,y,w,O,k,x,P,C,j,E,_,S;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=L()(window,"cozy.debug.notes.collabProvider"),r=L()(window,"cozy.debug.notes.channel"),(a={date:(new Date).toISOString()}).noteId=L()(window,"cozy.debug.notes.noteId"),a.initialVersion=L()(window,"cozy.debug.notes.initialVersion"),a.returnUrl=L()(window,"cozy.debug.notes.returnUrl"),o=n&&n.getState(),s=n&&o&&Object(cn.b)(o),l=o&&Object(cn.d)(o)||{steps:[]},u=l.steps,a.state={version:s,steps:u,length:u&&u.length},d=r&&r.backoff,p=r&&r.failures,f=r&&r.isDirty(),h=r&&r.isSending,m=r&&r.hasQueuedSteps(),v=r&&r.queuedStep,g=v&&v.state,b=g&&Object(cn.b)(g),y=v&&v.localSteps&&v.localSteps.steps,a.queue={backoff:d,failures:p,isDirty:f,isSending:h,hasQueue:m,version:b,steps:y,length:y&&y.length},w=n.isDirty(),O=n.getLastRemoteSync(),k=n.getLastLocalSave(),a.collabState={dirtySince:w,lastRemoteSync:O,lastLocalSave:k},x=n&&n.serviceClient,P=x&&x.realtime,C=P&&P.websocket,j=P&&P.retryManager,a.realtime={hasRealtime:!!P,started:P&&P.isStarted,hasWebsocket:P&&P.hasWebSocket(),isOpen:P&&P.isWebSocketOpen(),readyState:C&&C.readyState,bufferedAmount:C&&C.bufferedAmount,url:C&&C.url,retries:j&&j.retries,wait:j&&j.wait},E=L()(window,"cozy.debug.client"),a.client={token:E.stackClient.token,credentials:E.stackClient.getCredentials(),authorization:E.stackClient.getAuthorizationHeader(),uri:E.uri},(_=L()(window,"cozy.debug.notes.lastPatchError"))||!f){t.next=43;break}case 33:if(!r.isSending){t.next=38;break}return t.next=36,new Promise((function(e){return window.setTimeout(e,50)}));case 36:t.next=33;break;case 38:return r.resetBackoff(),r.processQueue(),t.next=42,Promise.race([new Promise((function(e){return window.setTimeout(e,2e3)})),new Promise((function(e){(function(){var t=i()(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=L()(window,"cozy.debug.notes.lastPatchError");case 1:if(n){t.next=7;break}return t.next=4,new Promise((function(e){return window.setTimeout(e,50)}));case 4:n=L()(window,"cozy.debug.notes.lastPatchError"),t.next=1;break;case 7:_=n,e();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}))]);case 42:r.isDirty()&&(r.backoff=d,r.failures=p);case 43:S=_&&_.message;try{S=JSON.parse(_.message)}catch(M){}a.lastPatchError={name:_&&_.name,status:_&&_.status,message:S},e(a);case 47:case"end":return t.stop()}}),t)}))),250)}));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());var wn=function(){function e(t,n){Gt()(this,e),this.config=t,this.service=n,this.eventEmitter=new sn.EventEmitter2,this.resetBackoff(),this.initializeStepsQueue(),this.isSending=!1}var t,n,r,a,o,s;return Qt()(e,[{key:"resetBackoff",value:function(){this.backoff=0,this.failures=0}},{key:"increaseBackoff",value:function(){this.failures=this.failures+1,this.failures%4==0&&this.emit("needcatchup",{failures:this.failures}),this.backoff=Math.max(Math.min(2*this.backoff,3e5),128)}},{key:"afterBackoff",value:function(){var e=this;return new Promise((function(t){e.backoff<128?t():window.setTimeout(t,e.backoff)}))}},{key:"initializeStepsQueue",value:function(){this.queuedStep=void 0}},{key:"isDirty",value:function(){return this.hasQueuedSteps()||this.isSending}},{key:"ensureEmptyQueue",value:(s=i()(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.isDirty()?t.on("emptyQueue",(function t(){this.off("emptyQueue",t),e()})):e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"enqueueSteps",value:function(e){var t=e.getState,n=e.state,r=e.localSteps;this.queuedStep={getState:t,state:n,localSteps:r}}},{key:"dequeueSteps",value:function(){var e=this.queuedStep,t=e.getState,n=e.state||t(),r=e.localSteps||Object(cn.d)(n)||{steps:[]};return this.queuedStep=void 0,{getState:t,state:n,localSteps:r}}},{key:"hasQueuedSteps",value:function(){return!!this.queuedStep}},{key:"rebaseStepsInQueue",value:function(){this.queuedStep&&(this.queuedStep={getState:this.queuedStep.getState})}},{key:"sendSteps",value:(o=i()(c.a.mark((function e(t,n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit("enqueueSteps"),this.enqueueSteps({getState:t,state:n,localSteps:r}),e.next=4,this.processQueue();case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"processQueue",value:(a=i()(c.a.mark((function e(){var t,n,r,i,a,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSending){e.next=2;break}return e.abrupt("return");case 2:if(this.hasQueuedSteps()){e.next=5;break}return this.emit("emptyQueue"),e.abrupt("return");case 5:return this.isSending=!0,e.next=8,this.afterBackoff();case 8:if(t=this.dequeueSteps(),n=t.getState,r=t.state,i=t.localSteps.steps,void 0!==(a=Object(cn.b)(r))){e.next=12;break}return e.abrupt("return");case 12:if(0!==i.length){e.next=14;break}return e.abrupt("return");case 14:return e.prev=14,o=this.config.noteId,e.next=18,this.service.pushSteps(o,a,i);case 18:s=e.sent,this.rebaseStepsInQueue(),this.resetBackoff(),this.emit("successfulPatch"),this.isSending=!1,s&&s.steps&&s.steps.length>0&&this.emit("data",s),e.next=32;break;case 26:e.prev=26,e.t0=e.catch(14),dn()("notes.lastPatchError")&&yn("notes.lastPatchError",e.t0),this.hasQueuedSteps()?this.rebaseStepsInQueue():this.enqueueSteps({getState:n}),this.increaseBackoff(),this.isSending=!1;case 32:return e.next=34,this.processQueue();case 34:case"end":return e.stop()}}),e,this,[[14,26]])}))),function(){return a.apply(this,arguments)})},{key:"connect",value:(r=i()(c.a.mark((function e(t){var n,r,i,a,o=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.version,r=t.doc,i=t.updatedAt,a=this.config.noteId,this.service.join(a),this.service.onStepsCreated(a,(function(e){o.emit("data",{version:e.version,steps:[e]})})),this.service.onTelepointerUpdated(a,(function(e){o.emit("telepointer",e)})),this.service.onSchemaUpdated(a,(function(){o.emit("schemaupdated")})),this.emit("connected",{version:n,doc:r,updatedAt:i});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSteps",value:(n=i()(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.getSteps(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sendTelepointer",value:(t=i()(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.pushTelepointer(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}}]),e}(),On=n("sEfC"),kn=n.n(On);function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(n),!0).forEach((function(t){A()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Cn=new ln.a,jn=Cn.encode.bind(Cn);Cn.encode=function(e){var t=jn(e);return 0===t.content.length&&0!=e.content.length?{content:[{type:"paragraph",content:[]}],type:"doc"}:t};var En=function(){function e(t,n){var r=this;Gt()(this,e),A()(this,"processRemoteData",(function(e){var t=e.version,n=e.steps;if(n&&n.length){var i=n.map((function(e){return e.sessionId||r.serviceClient.getUserId(e.sessionId)}));r.emit("data",{json:n,version:t,userIds:i})}else console.warn("Collab.Provider: processRemoteData no steps ? ",n,e)})),A()(this,"onReceiveData",(function(e){r.queueData(e),r.processQueue()})),A()(this,"onReceiveTelepointer",(function(e){var t=e.sessionId,n=r.serviceClient.getUserId(t);if(n!==r.config.userId){var i=r.participants.get(n);i&&i.lastActive>e.timestamp||(r.updateParticipant(t,e.timestamp),r.emit("telepointer",e))}})),A()(this,"onReceiveSchemaUpdated",(function(){window.location.reload(!0)})),this.config=Pn({},t),this.config.sessionId=n.getSessionId(),this.config.userId=n.getUserId(),this.cancelLocalChanges=kn()(this.cancelLocalChanges.bind(this),100),this.setReadOnly(!!this.config.readOnly),this.serviceClient=n,this.channel=t.channel||new wn(this.config,n),this.eventEmitter=new sn.EventEmitter2,this.queue=[],this.getState=function(){},this.participants=new Map,this.pauseQueue=!1,this.initialVersion=t.version,this.initialDate=t.updatedAt||new Date,this.pauseQueue=!1}var t;return Qt()(e,[{key:"initialize",value:function(e){var t=this;this.getState=e,this.channel.on("connected",(function(e){var n=e.doc,r=e.version,i=e.updatedAt,a=t.config.sessionId;t.emit("init",{sid:a,doc:n,version:r}),t.emit("connected",{sid:a}),t.listenStateEvents({lastRemoteSync:i})})),this.channel.on("data",this.onReceiveData),this.channel.on("telepointer",this.onReceiveTelepointer),this.channel.on("schemaupdated",this.onReceiveSchemaUpdated),this.channel.on("needcatchup",(function(){return t.catchup()}));var n=e(),r=Cn.encode(n.doc),i=void 0!==this.initialVersion?this.initialVersion:r.version,a=Pn(Pn({},r),{},{version:i});return this.channel.connect({version:i,doc:a,updatedAt:this.initialDate}),this}},{key:"send",value:function(e,t,n){e.steps&&e.steps.length&&(this.isReadOnly()?this.cancelLocalChanges():this.channel.sendSteps(this.getState,n))}},{key:"sendMessage",value:function(e){if(e&&!this.isReadOnly())switch(e.type){case"telepointer":this.channel.sendTelepointer(Pn(Pn({},e),{},{timestamp:(new Date).getTime()}))}}},{key:"queueData",value:function(e){var t=[].concat(on()(this.queue),[e]).sort((function(e,t){var n=e.version-e.steps.length,r=t.version-t.steps.length;return n>r?1:n<r||e.version>t.version?-1:e.version<t.version?1:0}));this.queue=t}},{key:"catchup",value:(t=i()(c.a.mark((function e(){var t,n,r,i,a,o,s,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseQueue=!0,t=Object(cn.b)(this.getState()),e.prev=2,e.next=5,this.channel.getSteps(t);case 5:n=e.sent,r=n.doc,i=n.version,a=n.steps,r?(o=this.config.sessionId,s=Object(cn.d)(this.getState())||{},l=s.steps,u=void 0===l?[]:l,this.emit("init",{sid:o,doc:r,version:i}),u.length&&!this.isReadOnly()&&this.emit("local-steps",{steps:u})):a.length>0&&this.onReceiveData({steps:a,version:i},!0),this.queueTimeout=void 0,this.pauseQueue=!1,this.processQueue(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),this.pauseQueue=!1,this.programCatchup();case 19:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(){return t.apply(this,arguments)})},{key:"programCatchup",value:function(){var e=this;this.queueTimeout||(this.queueTimeout=window.setTimeout((function(){e.catchup()}),1e3))}},{key:"cancelCatchup",value:function(){this.queueTimeout&&(window.clearTimeout(this.queueTimeout),this.queueTimeout=void 0)}},{key:"processQueue",value:function(){if(this.queue.length>0&&!this.pauseQueue)for(var e=Object(cn.b)(this.getState());this.queue.length>0;){var t=this.queue[0],n=t.version,r=t.steps.length+e;if(n==r)this.cancelCatchup(),this.queue.shift(),this.processRemoteData(t),e=n;else if(n<=r&&this.queue.shift(),n>r){this.programCatchup();break}}}},{key:"updateParticipant",value:function(e,t){var n=this,r=this.serviceClient.getUserId(e),i=function(e){var t=e.userId,n=e.sessionId;return{userId:n,sessionId:n||t,name:t,avatar:null,email:null}}({userId:r,sessionId:e});this.participants.set(r,Pn(Pn({name:"",email:"",avatar:"",sessionId:e,userId:r},i),{},{lastActive:t}));var a=[this.participants.get(r)],o=(new Date).getTime(),s=Array.from(this.participants.values()).filter((function(e){return(o-e.lastActive)/1e3>300}));s.forEach((function(e){return n.participants.delete(e.userId)})),this.emit("presence",{joined:a,left:s})}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"unsubscribeAll",value:function(e){this.eventEmitter.removeAllListeners(e)}},{key:"isDirty",value:function(){return!!this.dirtySince}},{key:"getDirtySince",value:function(){return this.dirtySince}},{key:"getLastLocalSave",value:function(){return this.lastLocalSave}},{key:"getLastRemoteSync",value:function(){return this.lastRemoteSync}},{key:"getLastSaveOrSync",value:function(){return this.lastLocalSave>this.lastRemoteSync?this.lastLocalSave:this.lastRemoteSync}},{key:"onLocalSave",value:function(){this.lastLocalSave=new Date,this.emit("collab-state-change")}},{key:"onRemoteSync",value:function(){this.lastRemoteSync=new Date,this.emit("collab-state-change")}},{key:"onChannelEmptyQueue",value:function(){this.dirtySince=void 0,this.emit("collab-state-change")}},{key:"onChannelEnqueue",value:function(){this.dirtySince||(this.dirtySince=new Date,this.emit("collab-state-change"))}},{key:"listenStateEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lastRemoteSync;this.channel.on("emptyQueue",this.onChannelEmptyQueue.bind(this)),this.channel.on("enqueueSteps",this.onChannelEnqueue.bind(this)),this.channel.on("successfulPatch",this.onLocalSave.bind(this)),this.on("data",this.onRemoteSync.bind(this)),this.on("init",this.onRemoteSync.bind(this)),t&&(this.lastRemoteSync=t)}},{key:"isReadOnly",value:function(){return this.readOnly}},{key:"setReadOnly",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.readOnly=!!e,this.readOnly&&this.cancelLocalChanges()}},{key:"cancelLocalChanges",value:function(){var e=this.getState&&this.getState();if(e){var t=L()(e,"collab$.unconfirmed[0].origin.docs[0]"),n=L()(e,"collab$.version"),r=this.config.sessionId;if(t&&n&&r){var i=t.toJSON();this.emit("init",{doc:i,version:n,sid:r})}}}}]),e}();var _n=function(e){var t=e.doc,n=e.noteId,r=e.serviceClient;return Object(l.useMemo)((function(){var e=t&&t.version,i=t&&t.updatedAt;if(r&&void 0!==t)return new En({version:e,noteId:n,updatedAt:i},r)}),[n,t,r])};var Sn=function(e){var t=e.noteId,n=e.title,r=e.setTitle,i=e.serviceClient,a=Object(l.useCallback)(i?function(e){var a=e.target.value.replace(/[\r\t\n\xa0]+/g," ");n!=a&&(r(a),i.setTitle(t,a))}:function(){},[t,n,r,i]);Object(l.useEffect)((function(){i&&i.onTitleUpdated(t,(function(e){n!=e&&r(e)}))}),[n,r,i,t]);var o=Object(l.useMemo)(de,[]);return Object(l.useEffect)((function(){document.title=n&&""!=n?"".concat(n," - ").concat(o):o}),[o,n]),{onLocalTitleChange:a}};var Mn=function(e){var t=e.doc,n=e.collabProvider,r=t&&t.file.id,a=n&&n.serviceClient,o=n&&n.channel;return{forceSync:Object(l.useCallback)(function(){var e=i()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&o&&a)){e.next=5;break}return e.next=3,o.ensureEmptyQueue();case 3:return e.next=5,a.sync(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),[t,o,a,r]),emergencySync:Object(l.useCallback)((function(){r&&a&&a.sync(r)}),[r,a])}};var Dn=function(e){var t=e.returnUrl,n=e.cozyClient,r=e.doc,i=Object(l.useContext)(Ht.a);return Object(l.useMemo)((function(){return void 0!==t?t:r?(e=n,a=r.file,ue(e,f.models.file.getParentFolderId(a))):i?void 0:"/";var e,a}),[t,r,i,n])};var Nn=function(e){var t=e.userName,n=e.cozyClient,r=Object(l.useContext)(Ht.a),i=Object(l.useMemo)((function(){return t||((e=new URLSearchParams(window.location.search)).has("username")?e.get("username"):null)||(r?"?":new URL(n.getStackClient().uri).hostname+Math.floor(100*Math.random()));var e}),[n,t,r]);return{userId:i,userName:i}},In=n("5ViJ");function Tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function An(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tn(Object(n),!0).forEach((function(t){A()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rn(e){var t=Object(f.useClient)(),n=e.noteId,r=e.readOnly,i=Object(v.f)().t,a=Object(l.useRef)(),s=Object(l.useContext)(Ht.a),c=Nn({userName:e.userName,cozyClient:t}),d=c.userName,p=c.userId,h=rn({userId:p,userName:d,cozyClient:t}),m=Zt({serviceClient:h,noteId:n,readOnly:r}),g=m.loading,b=m.title,y=m.doc,w=m.setTitle,O=Dn({returnUrl:e.returnUrl,cozyClient:t,doc:y}),k=_n({noteId:n,serviceClient:h,doc:y}),x=Sn({noteId:n,title:b,setTitle:w,serviceClient:h}).onLocalTitleChange,P=Mn({doc:y,collabProvider:k}),C=P.forceSync,j=P.emergencySync;Object(l.useEffect)((function(){return C}),[n,y,C]);var E,_,S,M,D,N=Object(l.useCallback)((function(){return k.isDirty()}),[k]),I=Object(In.a)({activate:N,onLeave:j,title:i("Notes.Editor.exit_confirmation_title"),message:i("Notes.Editor.exit_confirmation_message"),leaveLabel:i("Notes.Editor.exit_confirmation_leave"),cancelLabel:i("Notes.Editor.exit_confirmation_cancel")}),T=I.exitConfirmationModal,A=I.requestToLeave,R=(E=window.location.pathname,_=Object(l.useState)(!1),S=o()(_,2),M=S[0],D=S[1],Object(l.useEffect)((function(){D(Ne.g===E&&!!Object(U.c)())}),[E]),M);return bn("client",t),bn("notes.service",h),bn("notes.collabProvider",k),bn("notes.channel",k&&k.channel),bn("notes.noteId",n),bn("notes.doc",y&&An(An({},y.doc),{},{version:y.version})),bn("notes.file",y&&y.file),bn("notes.returnUrl",O),g?u.a.createElement(Ct,null):y?u.a.createElement(u.a.Fragment,null,u.a.createElement(ft,{bannerRef:a,readOnly:r,onTitleChange:x,onTitleBlur:j,collabProvider:k,defaultTitle:i("Notes.Editor.title_placeholder"),defaultValue:An(An({},y.doc),{},{version:y.version}),title:b&&b.length>0?b:void 0,leftComponent:u.a.createElement(Yt,{returnUrl:O,file:y.file,requestToLeave:A}),rightComponent:u.a.createElement(Pt,{doc:y,isPublic:s,isReadOnly:r,title:b}),primaryToolbarComponents:R?u.a.createElement(tt.a,null):null}),u.a.createElement(qt,{collabProvider:k,bannerRef:a}),T):u.a.createElement(jt,{returnUrl:O})}Rn.propTypes={noteId:et.a.string.isRequired,readOnly:et.a.bool.isRequired,userName:et.a.string,returnUrl:et.a.string};var Ln=Object(v.e)()((function(e){var t=e.t;return u.a.createElement(D.a,{icon:"unlink",title:t("Error.unshared_title"),text:t("Error.unshared_text")})})),Fn=n("pZg0"),Un=Object(d.f)((function(e){var t=Y();return u.a.createElement(Rn,{noteId:e.match.params.id,returnUrl:t,readOnly:!1})})),zn=function(){return u.a.createElement(d.c,null,u.a.createElement(d.a,{path:"/n/:id",component:Un}),u.a.createElement(d.a,{path:"/",component:Ye}))},Bn=function(){var e=Object(f.useClient)(),t=Object(l.useState)(null),n=o()(t,2),r=n[0],a=n[1],s=Object(l.useState)(!1),d=o()(s,2),p=d[0],h=d[1],m=Object(l.useMemo)((function(){return Y()}),[]);return Object(l.useEffect)((function(){(function(){var t=i()(c.a.mark((function t(){var n,r,i,o,s,l;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=new URLSearchParams(window.location.search)).has("id")){t.next=11;break}return r=n.get("id"),t.next=6,ae(e,r);case 6:i=t.sent,h(i),a(r),t.next=18;break;case 11:return t.next=13,se(e);case 13:o=t.sent,s=o.id,l=o.readOnly,h(l),a(s);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),a(!1);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),r?u.a.createElement(Rn,{readOnly:p,noteId:r,returnUrl:m||!1}):null!==r?u.a.createElement(Ln,null):u.a.createElement(w.a,{size:"xxlarge",middle:!0})};t.default=function(e){var t=e.isPublic,n=Object(f.useClient)(),r=k.b.isMobile,i=m()().ClientErrors,a=Object(v.f)().t,o=r?Object(U.a)(n.getInstanceOptions().app.name,Fn.name):"",s=cozy.bar.BarCenter,c=(fn()("switcher"),mn.a);return u.a.createElement(k.a,null,u.a.createElement(p.a,null,u.a.createElement(b.b,{monoColumn:!0},!t&&r&&u.a.createElement(s,null,u.a.createElement(O.a,null,o)),u.a.createElement(b.c,null,u.a.createElement(b.a,null,t?u.a.createElement(Bn,null):u.a.createElement(zn,null))),u.a.createElement(y.a,null),u.a.createElement(g.a,{t:a}),u.a.createElement(c,null))),u.a.createElement(i,null))}},pZg0:function(e,t){e.exports={name:"Notes",name_prefix:"Cozy",slug:"notes",icon:"icon.svg",categories:["cozy"],version:"1.18.0",licence:"AGPL-3.0",editor:"Cozy",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"Cozy Cloud",url:"https://cozy.io"},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"],langs:["en","fr"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0},"/preview":{folder:"/",index:"index.html",public:!0}},permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},sharings:{description:"Required to have access to the sharings in realtime",type:"io.cozy.sharings",verbs:["GET"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]}}}},"u/g/":function(e,t,n){"use strict";var r=n("q1tI"),i=n.n(r),a=n("VPdw"),o=n("qo2B"),s=n("ymI0"),c=n("yXPU"),l=n.n(c),u=n("lwsE"),d=n.n(u),p=n("W8MJ"),f=n.n(p),h=n("lSNA"),m=n.n(h),v=n("o0o1"),g=n.n(v),b=n("i8i4"),y=n.n(b),w=n("UxO+"),O=n("CsC6"),k=n("V2qZ"),x=n("NGmG"),P=n("9lTW"),C=n.n(P),j=n("mG1W"),E=n("MEpN"),_=n("E6jh"),S=n("qXKI"),M=n("uCUl"),D=n("k9uR"),N=n("avnJ"),I=n("ABBN"),T=n("8Uts"),A=(n("Q4kT"),n("Vlyn"),function(e){return!!e&&(e.indexOf("image/")>-1||e.indexOf("video/")>-1)}),R=n("4Wbe"),L=n("W4PY"),F=n("YDJT"),U=function(e){return H(e)||G(e)||V(e)||W(e)},z=function(e){var t=e.selection.node;return t&&t.type!==e.schema.nodes.media&&t.isBlock},B=function(e){var t=e.selection.node;return t&&t.type===e.schema.nodes.mediaSingle},V=function(e){if(Object(R.a)(e))return J(e,e.selection.$from)},W=function(e){if(e.selection instanceof L.a){var t=e.selection.$from,n=e.schema.nodes.mediaGroup;return q(t,n)||K(t,n)}},q=function(e,t){if(e.nodeBefore&&e.nodeBefore.type===t)return e.pos-e.nodeBefore.nodeSize+1},K=function(e,t){if(e.nodeAfter&&e.nodeAfter.type===t)return e.pos+1},G=function(e){if(Object(R.c)(e))return Q(e,e.selection.$to)},J=function(e,t){var n,r;if(z(e)?(n=t.pos,r=t.nodeBefore):(n=Object(R.f)(t)-1,r=e.doc.resolve(n).nodeBefore),r&&r.type===e.schema.nodes.mediaGroup)return n-r.nodeSize+1},Q=function(e,t){var n,r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(z(e)?(n=t.pos,r=t.nodeAfter):(n=Object(R.e)(t),r=e.doc.nodeAt(n)),r&&r.type===e.schema.nodes.mediaGroup)return i?n+1:n+r.nodeSize-1},H=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.selection.$from;if((t=t||r).parent.type===e.schema.nodes.mediaGroup)return n?Object(R.f)(t):Object(R.e)(t)-1};var $=function(e,t,n){var r=t.attrs.id,i=e.state,a=i.tr,o=i.selection,s=i.doc,c=n();a.deleteRange(c,c+t.nodeSize),Object(D.r)(r)&&a.setMeta("addToHistory",!1);var l=s.resolve(c),u=l.nodeBefore,d=l.parent,p=l.index()===d.childCount-1;if(o.from===c&&!p&&!Object(R.b)(i)&&u&&"media"===u.type.name){var f=Object(j.findPositionOfNodeBefore)(a.selection);f&&a.setSelection(w.NodeSelection.create(a.doc,f))}e.dispatch(a)},X=function(e){return e.length>1&&"_"===e[0]&&"_"===e[1]},Y=function(e,t){Object.keys(t.attrs).filter(X).forEach((function(n){var r=n.substring(2),i=e[r];void 0!==i&&(t.attrs[n]=i)}))};var Z=function(e){if(!B(e))return null;var t=e.tr,n=t.selection.from+1,r=t.doc.nodeAt(n);return r&&r.type===e.schema.nodes.media?r:null},ee=n("9J0+"),te=n("ctWQ"),ne=n("oSw/"),re=n("3Pol");var ie=function(e,t){return{action:ee.a.INSERTED,actionSubject:ee.b.DOCUMENT,actionSubjectId:ee.c.MEDIA,attributes:{inputMethod:e,fileExtension:t,type:ee.c.MEDIA_SINGLE},eventType:ee.d.TRACK}};function ae(e){return Object(R.a)(e)&&!Object(D.d)(e.selection,e.doc,N.g)}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var i=n.tr,a=n.schema.nodes.paragraph,o=t.inputMethod,s=t.fileExtension,c=0;return ae(n)&&(e.push(a.create()),c=1),i.replaceSelection(new E.Slice(E.Fragment.from(e),0,c)),o&&Object(te.a)(n,i,ie(o,s)),r&&r(i),!0}}var se=function(e,t){return!!e.nodes.mediaSingle&&A(t)},ce=function(e,t,n){return function(r){var i=r.id,a=r.dimensions,o=r.contextId,s=r.scaleFactor,c=void 0===s?1:s,l=a||{height:void 0,width:void 0},u=l.width,d=l.height,p=e.nodes,f=p.media,h=p.mediaSingle,m=f.create({id:i,type:"file",collection:t,contextId:o,width:u&&Math.round(u/c),height:d&&Math.round(d/c)}),v=n?{layout:"align-start"}:{};return Y(r,m),h.createChecked(v,m)}};var le,ue,de,pe=function(e){var t=e.origWidth,n=e.origHeight,r=e.layout,i=e.pctWidth,a=e.containerWidth,o=e.resizedPctWidth,s=a.width,c=a.lineLength,l=fe(a,i,t,n),u=fe(a,o,t,n);if("wide"===r){if(c){var d=Math.ceil(c*M.Z);return d>s?c:d}}else{if("full-width"===r)return s-M.d;if(l)return _.e.indexOf(r)>-1?u?o<50?u:l:Math.max(l,t):u||l;if("center"===r)return u||Math.min(t,c||s);if(r&&-1!==_.e.indexOf(r)){var p=Math.ceil((c||s)/2);return t<=p?t:p}}return t},fe=function(e,t,n,r){return t&&n&&r&&Math.ceil(Object(S.d)(t/100,e.lineLength||e.width))},he=n("VkAN"),me=n.n(he),ve=n("vOnD"),ge=n("gxo2"),be=n("73wN"),ye=n("dtZH"),we=n.n(ye),Oe=n("5CwK"),ke=n("PJYZ"),xe=n.n(ke),Pe=n("7W2i"),Ce=n.n(Pe),je=n("a1gu"),Ee=n.n(je),_e=n("Nsbk"),Se=n.n(_e),Me=n("Y5+h"),De=n("4cwp"),Ne=n("b0xO"),Ie=n("SdAV"),Te=n("JeIq"),Ae=new w.PluginKey("mediaPlugin"),Re=ve.default.figure(le||(le=me()(["\n  margin: 0;\n"])));Re.displayName="FigureWrapper";var Le=ve.default.div(ue||(ue=me()(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n"]))),Fe=ve.default.div(de||(de=me()(["\n  width: 100%;\n  position: relative;\n  padding-bottom: ","%;\n"])),(function(e){return e.dimensions.height/e.dimensions.width*100})),Ue=function(e){var t=e.dimensions,n=e.children,r=e.onContextMenu;return i.a.createElement(Fe,{dimensions:t,onContextMenuCapture:r},i.a.createElement(Le,null,n))},ze=n("dojK"),Be=n("SH7X");function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var We,qe,Ke=function(e){Ce()(r,e);var t,n=Ve(r);function r(e){var t;d()(this,r),t=n.call(this,e),m()(xe()(t),"mediaPluginState",void 0),m()(xe()(t),"state",{imageUrl:"",imageError:"",imageLoading:!0}),m()(xe()(t),"realtimeSubscription",void 0),m()(xe()(t),"setViewMediaClientConfig",l()(g.a.mark((function e(){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.mediaProvider;case 2:(n=e.sent)&&(r=n.viewMediaClientConfig,t.setState({viewMediaClientConfig:r}));case 4:case"end":return e.stop()}}),e)})))),m()(xe()(t),"selectMediaSingleFromCard",(function(e){var n=e.event;t.selectMediaSingle(n)})),m()(xe()(t),"selectMediaSingle",(function(e){e.stopPropagation();var n=t.props.getPos(),r=t.props.view.state;if(e.shiftKey){if(r.selection instanceof Ie.a)return;Object(Te.g)(t.props.view,r.selection.from<n?r.selection.from:n-1,r.selection.to>n?r.selection.to:n+2)}else Object(Te.f)(t.props.view,n-1)})),m()(xe()(t),"fetchCozyImage",l()(g.a.mark((function e(){var n,r,i,a,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({imageError:""}),t.state.collabEditProvider){e.next=3;break}throw Error(ze.c.MissingCollabEdit);case 3:return n=t.state.collabEditProvider,r=n.serviceClient,i=n.config.noteId,e.prev=4,e.next=7,r.cozyClient.query(Object(Be.Q)(ze.a.Files).getById(i));case 7:if(a=e.sent){e.next=10;break}throw Error(ze.c.CouldNotGetNoteImages);case 10:if(o=a.included.find((function(e){return e.id===t.props.node.attrs.url}))){e.next=13;break}throw Error(ze.c.CouldNotFindFileInCurrentNote);case 13:!o.attributes.willBeResized&&t.setState({imageUrl:"".concat(r.stackClient.uri).concat(o.links.self),imageLoading:!1}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),t.setState({imageError:e.t0.message});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})))),m()(xe()(t),"subscribeToImageUpdate",(function(){var e;return null===(e=t.state.collabEditProvider)||void 0===e?void 0:e.serviceClient.realtime.subscribe(ze.f.Updated,ze.a.NoteEvents,t.state.collabEditProvider.config.noteId,(function(e){var n=e.image_id;t.props.node.attrs.url.includes(n)&&t.setState({imageLoading:!0},t.fetchCozyImage)}))})),m()(xe()(t),"handleNewNode",(function(e){var n=e.node;t.mediaPluginState.handleMediaNodeMount(n,(function(){return t.props.getPos()}))}));var i=t.props.view;return t.mediaPluginState=Ae.getState(i.state),t}return f()(r,[{key:"shouldComponentUpdate",value:function(e,t){var n=!this.state.viewMediaClientConfig&&t.viewMediaClientConfig;return!(this.state.imageUrl===t.imageUrl&&this.state.imageError===t.imageError&&this.props.selected===e.selected&&this.props.uploadComplete===e.uploadComplete&&this.props.node.attrs.id===e.node.attrs.id&&this.props.node.attrs.collection===e.node.attrs.collection&&this.props.maxDimensions.height===e.maxDimensions.height&&this.props.maxDimensions.width===e.maxDimensions.width&&this.props.contextIdentifierProvider===e.contextIdentifierProvider&&this.props.isLoading===e.isLoading&&this.props.mediaProvider===e.mediaProvider&&!n)}},{key:"componentDidMount",value:(t=l()(g.a.mark((function e(){var t,n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleNewNode(this.props),t=this.props,n=t.contextIdentifierProvider,r=t.collabEditProvider,e.t0=this,e.next=5,n;case 5:return e.t1=e.sent,e.next=8,r;case 8:return e.t2=e.sent,e.t3={contextIdentifierProvider:e.t1,collabEditProvider:e.t2},e.t0.setState.call(e.t0,e.t3),this.realtimeSubscription=this.subscribeToImageUpdate(),e.next=14,this.fetchCozyImage();case 14:return e.next=16,this.setViewMediaClientConfig();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e,t=this.props.node;null===(e=this.realtimeSubscription)||void 0===e||e.unsubscribe(),this.mediaPluginState.handleMediaNodeUnmount(t)}},{key:"componentDidUpdate",value:function(e){e.node.attrs.id!==this.props.node.attrs.id&&(this.mediaPluginState.handleMediaNodeUnmount(e.node),this.handleNewNode(this.props)),this.mediaPluginState.updateElement(),this.setViewMediaClientConfig()}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.selected,r=e.uploadComplete,a=e.originalDimensions,o=e.isLoading,s=e.maxDimensions,c=e.mediaOptions,l=this.state,u=l.viewMediaClientConfig,d=l.contextIdentifierProvider,p=t.attrs,f=p.id,h=p.type,m=p.collection,v=p.url,g=p.alt;if(this.state.imageLoading||!this.state.imageUrl||this.state.imageError||o||"external"!==h&&(!u||"boolean"==typeof r&&!r))return i.a.createElement(Ue,{dimensions:a},i.a.createElement(De.a,null));var b=d&&d.objectId,y="external"===h?{dataURI:this.state.imageUrl,name:v,mediaItemType:"external-image"}:{id:f,mediaItemType:"file",collectionName:m},w=u||{authProvider:function(){return{}}};return i.a.createElement(Ue,{dimensions:a,onContextMenu:this.selectMediaSingle},i.a.createElement(Ne.a,{mediaClientConfig:w,resizeMode:"stretchy-fit",dimensions:s,originalDimensions:a,identifier:y,selectable:!0,selected:n,disableOverlay:!0,onClick:this.selectMediaSingleFromCard,useInlinePlayer:c&&c.allowLazyLoading,isLazy:c&&c.allowLazyLoading,featureFlags:c&&c.featureFlags,contextId:b,alt:g}))}}]),r}(r.Component),Ge=Object(Me.a)(Ke),Je=ve.default.div(We||(We=me()(["\n  color: ",";\n  background: ",";\n  border-radius: ","px;\n  margin: 5px 3px 25px;\n  width: ","px;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])),Object(Oe.J)(be.B400,.4)||be.B400,Object(Oe.J)(be.B300,.6)||be.B300,Object(ge.c)(),156,125),Qe=ve.default.div(qe||(qe=me()(["\n  background: ",";\n  border-radius: ","px;\n  margin: 2px 0;\n  width: 100%;\n  height: 2px;\n"])),be.B200,Object(ge.c)()),He=function(e){var t=e.type;return"single"===(void 0===t?"group":t)?i.a.createElement(Qe,null):i.a.createElement(Je,null,i.a.createElement(we.a,{label:"Document",size:"medium"}))},$e=n("JLRh"),Xe=function(e,t){var n="";return 1===e.length?n=e[0].fileMimeType||"unknown":e.length>1&&(n="multiple"),{action:ee.a.INSERTED,actionSubject:ee.b.DOCUMENT,actionSubjectId:ee.c.MEDIA,attributes:{type:ee.c.MEDIA_GROUP,inputMethod:t,fileExtension:n},eventType:ee.d.TRACK}};var Ye=function(e,t,n,r){var i=e.state,a=e.dispatch,o=i.tr,s=i.schema,c=s.nodes,l=c.media,u=c.paragraph;if(l&&t.length){var d=Ze(t,n,l),p=tt(i),f=o.doc.resolve(p).parent,h=o.doc.nodeAt(p),m=!function(e){var t=e.schema,n=e.selection.$anchor.node();return n&&n.type===t.nodes.mediaGroup}(i)&&Object($e.e)(i,E.Fragment.from(i.schema.nodes.mediaGroup.createChecked({},d))),v=function(e,t){var n=e.schema.nodes.media,r=t&&t.type===n;return(Object(D.j)(e)||Object(D.n)(e)||Object(D.m)(e)||Object(R.d)(e)&&(!V(e)||z(e)))&&!r}(i,h),g=f.type===s.nodes.mediaGroup?d:[s.nodes.mediaGroup.createChecked({},d)];if(m){g=v?g.concat(u.create()):g;var b=nt(i);return b?p<=b.start?o.deleteRange(b.start,b.end).insert(p,g):o.insert(p,g).deleteRange(b.start,b.end):o.insert(p,g),Object(te.a)(i,o,Xe(t,r)),a(o),void it(e)}v&&f.type!==s.nodes.mediaGroup&&g.push(u.create()),Object(te.a)(i,o,Xe(t,r)),a(Object(j.safeInsert)(E.Fragment.fromArray(g),p)(o))}},Ze=function(e,t,n){return e.map((function(e){var r=e.id,i=n.create({id:r,type:"file",collection:t});return Y(e,i),i}))},et=function(e){var t=e.schema.nodes,n=t.mediaGroup,r=t.listItem;if(Object(j.hasParentNode)((function(e){return e.type===r}))(e.selection)){var i=function(e){var t=e.schema.nodes,n=t.bulletList,r=t.orderedList;return Object(N.b)((function(e){return e.type===n||e.type===r}))(e.selection.$from)}(e);if(i){var a=i.pos+i.node.nodeSize,o=e.doc.nodeAt(a);return o&&o.type===n?a+1:a}}},tt=function(e){var t=e.selection,n=t.$from,r=t.$to,i=et(e);if(i)return i;var a=U(e);return a&&(!z(e)||n.pos<a&&r.pos<a)?a:z(e)?r.pos:Object(R.c)(e)?r.pos+1:Object(R.a)(e)?n.pos-1:r.pos},nt=function(e){var t=e.selection,n=t.$from,r=t.$to;if(!H(e))return!function(e){return e.selection.$from.parent.type===e.schema.nodes.paragraph&&Object(R.a)(e)&&Object(R.c)(e)}(e)||U(e)?rt(n.pos,r.pos):rt(Object(R.f)(n)-1,Object(R.e)(r))},rt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return{start:e,end:t}},it=function(e){var t=e.state,n=t.doc,r=U(t);if(r){var i=n.resolve(r),a=Object(R.e)(i);a+1>=n.nodeSize-1?Object(Te.f)(e,r):Object(Te.g)(e,a+1)}},at=n("00zI");function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var st=function(e,t){return e.mediaNodes.reduce((function(e,n){return e||(n.node.attrs.id===t?n:e)}),null)},ct=function(e,t,n){return n?st(e,t):e.mediaGroupNodes[t]},lt=function(e,t){return e.mediaOptions&&e.mediaOptions.allowMarkingUploadsAsIncomplete&&"boolean"==typeof e.mobileUploadComplete[t]?e.mobileUploadComplete[t]:void 0},ut=function(e,t,n){return function(r,i){var a,o=Ae.getState(r);if(n)a=function(e,t){return e.mediaNodes.filter((function(e){return e.node.attrs.id===t}))}(o,e);else{var s=ct(o,e,n);a=s?[s]:[]}var c=r.schema.nodes.media;if(0===(a=a.filter((function(e){var t;try{t=r.doc.nodeAt(e.getPos())}catch(n){return!1}return t&&t.type===c}))).length)return!1;if(i){var l=r.tr;a.forEach((function(e){var n=e.getPos;return l.step(new at.a(n(),t))})),l.setMeta("addToHistory",!1),i(l)}return!0}},dt=function(e,t,n){return function(r,i){var a=Ae.getState(r),o=ct(a,e,n);return!!o&&(i&&i(r.tr.step(new at.a(o.getPos(),t)).setMeta("addToHistory",!1)),!0)}},pt=function(e,t){return function(n,r){return!!r&&(r(n.tr.step(new at.a(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"file",url:null},t))).setMeta("addToHistory",!1)),!0)}},ft=n("0q37"),ht=function(){function e(t,n,r){var i=this,a=(arguments.length>3&&void 0!==arguments[3]||ft.d,arguments.length>4?arguments[4]:void 0);d()(this,e),m()(this,"picker",void 0),m()(this,"onDragListeners",[]),m()(this,"errorReporter",void 0),m()(this,"pickerType",void 0),m()(this,"onStartListeners",[]),m()(this,"eventListeners",{}),m()(this,"analyticsName",void 0),m()(this,"erroredFiles",void 0),m()(this,"handleUploadPreviewUpdate",(function(e){var t=e.file,n=e.preview,r=i.erroredFiles.has(t.id),a=Object(ft.e)(n)?n:{dimensions:void 0,scaleFactor:void 0},o=a.dimensions,s=a.scaleFactor,c={id:t.id,fileName:t.name,fileSize:t.size,fileMimeType:t.type,dimensions:o,scaleFactor:s,status:r?"error":void 0};i.eventListeners[t.id]=[],i.onStartListeners.forEach((function(e){return e(c,(function(e){return i.subscribeStateChanged(t,e)}),i.analyticsName||i.pickerType)}))})),m()(this,"subscribeStateChanged",(function(e,t){var n=i.eventListeners[e.id];n&&n.push(t)})),m()(this,"handleUploadError",(function(e){var t=e.error,n=e.fileId,r=i.eventListeners[n];i.erroredFiles.add(n),r&&(r.forEach((function(e){return e({id:n,status:"error",error:t&&{description:t.description,name:t.name}})})),delete i.eventListeners[n])})),m()(this,"handleMobileUploadEnd",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&n.forEach((function(e){return e({id:t.id,status:"mobile-upload-end",fileMimeType:t.type,collection:t.collectionName,publicId:t.publicId})}))})),m()(this,"handleReady",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&(n.forEach((function(e){return e({id:t.id,status:"ready"})})),delete i.eventListeners[t.id])})),this.pickerType=t,this.errorReporter=n.errorReporter,this.analyticsName=a,this.erroredFiles=new Set}var t;return f()(e,[{key:"init",value:(t=l()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("customMediaPicker"!==this.pickerType){e.next=4;break}t=this.picker=this.pickerConfig,e.next=8;break;case 4:if("popup"!==this.pickerType){e.next=8;break}return e.next=7,this.mediaPickerFactoryClass(this.config.mediaClientConfig,this.pickerConfig);case 7:t=this.picker=e.sent;case 8:if(t){e.next=10;break}return e.abrupt("return",this);case 10:return t.on("upload-preview-update",this.handleUploadPreviewUpdate),t.on("upload-end",this.handleReady),t.on("upload-error",this.handleUploadError),t.on("mobile-upload-end",this.handleMobileUploadEnd),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"type",get:function(){return this.pickerType}},{key:"mediaPicker",get:function(){return this.picker}},{key:"destroy",value:function(){var e=this.picker;if(e){e.removeAllListeners("upload-preview-update"),e.removeAllListeners("upload-end"),e.removeAllListeners("upload-error"),this.onStartListeners=[],this.onDragListeners=[];try{"popup"===this.pickerType&&e.teardown()}catch(t){this.errorReporter.captureException(t)}}}},{key:"setUploadParams",value:function(e){this.picker&&this.picker.setUploadParams(e)}},{key:"onClose",value:function(e){var t=this.picker;if("popup"===this.pickerType){var n=t;return n.on("closed",e),function(){return n.off("closed",e)}}return function(){}}},{key:"show",value:function(){if("popup"===this.pickerType)try{this.picker.show()}catch(e){this.errorReporter.captureException(e)}}},{key:"hide",value:function(){"popup"===this.pickerType&&this.picker.hide()}},{key:"onNewMedia",value:function(e){this.onStartListeners.push(e)}},{key:"onDrag",value:function(e){this.onDragListeners.push(e)}}]),e}();function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gt=["ready","error","cancelled"],bt=function(){function e(t,n,r,i,a){var o=this;d()(this,e),m()(this,"allowsUploads",!1),m()(this,"mediaClientConfig",void 0),m()(this,"uploadMediaClientConfig",void 0),m()(this,"ignoreLinks",!1),m()(this,"waitForMediaUpload",!0),m()(this,"allUploadsFinished",!0),m()(this,"showDropzone",!1),m()(this,"element",void 0),m()(this,"layout","center"),m()(this,"mediaNodes",[]),m()(this,"mediaGroupNodes",{}),m()(this,"mobileUploadComplete",{}),m()(this,"options",void 0),m()(this,"mediaProvider",void 0),m()(this,"pendingTask",Promise.resolve(null)),m()(this,"view",void 0),m()(this,"destroyed",!1),m()(this,"contextIdentifierProvider",void 0),m()(this,"errorReporter",void 0),m()(this,"popupPicker",void 0),m()(this,"customPicker",void 0),m()(this,"removeOnCloseListener",(function(){})),m()(this,"openMediaPickerBrowser",void 0),m()(this,"onPopupToogleCallback",(function(){})),m()(this,"reactContext",void 0),m()(this,"pickers",[]),m()(this,"pickerPromises",[]),m()(this,"editingMediaSinglePos",void 0),m()(this,"showEditingDialog",void 0),m()(this,"mediaOptions",void 0),m()(this,"dispatch",void 0),m()(this,"onContextIdentifierProvider",function(){var e=l()(g.a.mark((function e(t,n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n;case 3:o.contextIdentifierProvider=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m()(this,"setMediaProvider",function(){var e=l()(g.a.mark((function e(t){var n,r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Ae,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 5:return e.prev=5,e.next=8,t;case 8:o.mediaProvider=e.sent,o.mediaProvider.viewMediaClientConfig||(n=o.mediaProvider.viewMediaClientConfig)&&(o.mediaProvider.viewMediaClientConfig=n),C()(o.mediaProvider.viewMediaClientConfig,"MediaProvider promise did not resolve to a valid instance of MediaProvider - ".concat(o.mediaProvider)),e.next=21;break;case 13:return e.prev=13,e.t0=e.catch(5),r=new Error("Media functionality disabled due to rejected provider: ".concat(e.t0.message)),o.errorReporter.captureException(r),o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Ae,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 21:if(o.mediaClientConfig=o.mediaProvider.viewMediaClientConfig,o.allowsUploads=!!o.mediaProvider.uploadMediaClientConfig,i=o.view,a=o.allowsUploads,!o.destroyed&&i.dom.parentNode&&i.dispatch(i.state.tr.setMeta(Ae,{allowsUploads:a})),!o.allowsUploads){e.next=35;break}if(o.uploadMediaClientConfig=o.mediaProvider.uploadMediaClientConfig,!o.mediaProvider.uploadParams||!o.uploadMediaClientConfig){e.next=32;break}return e.next=30,o.initPickers(o.mediaProvider.uploadParams,ht,o.reactContext);case 30:e.next=33;break;case 32:o.destroyPickers();case 33:e.next=36;break;case 35:o.destroyPickers();case 36:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),m()(this,"getMediaOptions",(function(){return o.options})),m()(this,"hasUserAuthProvider",(function(){return!!o.uploadMediaClientConfig&&!!o.uploadMediaClientConfig.userAuthProvider})),m()(this,"insertFile",(function(e,t,n){var r=vt(vt({},e),{},{contextId:o.contextIdentifierProvider?o.contextIdentifierProvider.objectId:void 0}),i=o.collectionFromProvider();if(void 0!==i){o.mediaOptions&&o.mediaOptions.allowMarkingUploadsAsIncomplete&&(o.mobileUploadComplete[r.id]=!1),"error"!==e.status&&o.updateAndDispatch({allUploadsFinished:!1}),se(o.view.state.schema,r.fileMimeType)?function(e,t,n,r,i){if(void 0===r)return!1;var a,o=e.state,s=e.dispatch,c=o.selection.$from.node(-1),l=ce(o.schema,r,i)(t),u=c&&c.type.validContent(E.Fragment.from(l));if(t.fileName){var d=t.fileName.lastIndexOf(".");a=d>=0?t.fileName.substring(d+1):void 0}if(u)oe([l],{fileExtension:a,inputMethod:n})(o,s);else{var p=null;if(Object(re.b)(e.state).newInsertionBehaviour&&(p=Object(ne.b)(l,o.selection.from)(o.tr)),!p){var f=ae(e.state)?E.Fragment.fromArray([l,o.schema.nodes.paragraph.create()]):l;p=Object(j.safeInsert)(f,void 0,!0)(o.tr)}n&&(p=Object(te.a)(o,p,ie(n,a))),s(p)}}(o.view,r,o.getInputMethod(n),i,o.mediaOptions&&o.mediaOptions.alignLeftOnInsert):Ye(o.view,[r],i,o.getInputMethod(n)),t(o.handleMediaState);var a=function(e){return e.status&&-1!==gt.indexOf(e.status)};a(r)||(o.addPendingTask(new Promise((function(e){t((function(t){a(t)&&e(t)}))}))),o.pendingTask.then((function(){o.updateAndDispatch({allUploadsFinished:!0})})));var s=o.view;s.hasFocus()||s.focus()}})),m()(this,"addPendingTask",(function(e){var t=o.pendingTask,n=function(){return t};o.pendingTask=e.then(n,n)})),m()(this,"splitMediaGroup",(function(){return e=o.view,(t=e.state.selection)instanceof w.NodeSelection&&t.node.type===e.state.schema.nodes.media&&(Object(I.e)(e.state,e.dispatch),t.$to.nodeAfter?(Object(I.g)(e.state,e.dispatch),Object(T.e)(!1)(e.state,e.dispatch)):Object(T.c)(e.state,e.dispatch),!0);var e,t})),m()(this,"onPopupPickerClose",(function(){o.onPopupToogleCallback(!1)})),m()(this,"shouldUseMediaPickerPopup",(function(){return!o.mediaOptions||o.mediaOptions&&void 0===o.mediaOptions.useMediaPickerPopup?o.hasUserAuthProvider():!!o.mediaOptions.useMediaPickerPopup})),m()(this,"showMediaPicker",(function(){if(o.openMediaPickerBrowser&&!o.shouldUseMediaPickerPopup())return o.openMediaPickerBrowser();o.popupPicker&&(o.popupPicker.show(),o.onPopupToogleCallback(!0))})),m()(this,"setBrowseFn",(function(e){o.openMediaPickerBrowser=e})),m()(this,"onPopupToggle",(function(e){o.onPopupToogleCallback=e})),m()(this,"waitForPendingTasks",(function(e,t){if(t&&o.pendingTask===t)return t;var n,r=o.pendingTask.then((function(){return o.waitForPendingTasks(void 0,o.pendingTask)}));if(!e)return r;var i=new Promise((function(t,r){n=window.setTimeout((function(){return r(new Error("Media operations did not finish in ".concat(e," ms")))}),e)}));return Promise.race([i,r.then((function(e){return clearTimeout(n),e}))])})),m()(this,"handleMediaNodeRemoval",(function(e,t){var n=e;n||(n=o.view.state.doc.nodeAt(t())),$(o.view,n,t)})),m()(this,"handleMediaNodeMount",(function(e,t){o.mediaNodes.unshift({node:e,getPos:t})})),m()(this,"handleMediaNodeUnmount",(function(e){o.mediaNodes=o.mediaNodes.filter((function(t){var n=t.node;return e!==n}))})),m()(this,"findMediaNode",(function(e){return st(o,e)})),m()(this,"destroyAllPickers",(function(e){e.forEach((function(e){return e.destroy()})),o.pickers.splice(0,o.pickers.length)})),m()(this,"destroyPickers",(function(){var e=o.pickers,t=o.pickerPromises;t.length===e.length?o.destroyAllPickers(o.pickers):Promise.all(t).then((function(e){return o.destroyAllPickers(e)})),o.popupPicker=void 0,o.customPicker=void 0})),m()(this,"getInputMethod",(function(e){switch(e){case"popup":return ee.e.PICKER_CLOUD;case"clipboard":return ee.e.CLIPBOARD;case"dropzone":return ee.e.DRAG_AND_DROP}})),m()(this,"updateMediaNodeAttrs",(function(e,t,n){var r=o.view;if(r)return dt(e,t,n)(r.state,r.dispatch)})),m()(this,"handleMediaState",(function(e){switch(e.status){case"error":var t=o.options.uploadErrorHandler;t&&t(e);break;case"mobile-upload-end":var n={id:e.publicId||e.id};"string"==typeof e.collection&&(n.collection=e.collection),o.updateMediaNodeAttrs(e.id,n,se(o.view.state.schema,e.fileMimeType)),o.mobileUploadComplete[n.id]=!0,delete o.mediaGroupNodes[e.id]}})),m()(this,"isMobileUploadCompleted",(function(e){return lt(o,e)})),m()(this,"removeNodeById",(function(e){var t=e.id,n=ct(o,t,A(e.fileMimeType));n&&$(o.view,n.node,n.getPos)})),m()(this,"removeSelectedMediaContainer",(function(){var e=o.view,t=o.selectedMediaContainerNode();if(!t)return!1;var n=e.state.selection.from;return $(e,t.firstChild,(function(){return n+1})),!0})),m()(this,"selectedMediaContainerNode",(function(){var e=o.view.state,t=e.selection,n=e.schema;if(t instanceof w.NodeSelection&&(t.node.type===n.nodes.mediaSingle||t.node.type===n.nodes.mediaGroup))return t.node})),m()(this,"handleDrag",(function(e){var t="enter"===e;if(o.showDropzone!==t){o.showDropzone=t;var n=o.view;(0,n.dispatch)(n.state.tr)}})),this.reactContext=r,this.options=n,this.mediaOptions=i,this.dispatch=a,this.waitForMediaUpload=void 0===n.waitForMediaUpload||n.waitForMediaUpload;var s=t.schema.nodes;C()(s.media&&(s.mediaGroup||s.mediaSingle),"Editor: unable to init media plugin - media or mediaGroup/mediaSingle node absent in schema"),n.providerFactory.subscribe("mediaProvider",(function(e,t){return o.setMediaProvider(t)})),n.providerFactory.subscribe("contextIdentifierProvider",this.onContextIdentifierProvider),this.errorReporter=n.errorReporter||new x.a}var t;return f()(e,[{key:"updateElement",value:function(){var e,t=this.selectedMediaContainerNode(),n=this.view.state.schema.nodes.mediaSingle;t&&t.type===n&&(e=this.getDomElement(this.view.domAtPos.bind(this.view))),this.element!==e&&(this.element=e)}},{key:"getDomElement",value:function(e){var t=this.view.state,n=t.selection,r=t.schema;if(n instanceof w.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=Object(j.findDomRefAtPos)(n.from,e);if(i)return i.childNodes.length?i.querySelector(".wrapper")||i:i.parentNode}}},{key:"setView",value:function(e){this.view=e}},{key:"destroy",value:function(){if(!this.destroyed){this.destroyed=!0;var e=this.mediaNodes;e.splice(0,e.length),this.removeOnCloseListener(),this.destroyPickers()}}},{key:"initPickers",value:(t=l()(g.a.mark((function e(t,n,r){var i,a,o,s,c,l,u,d=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed&&this.uploadMediaClientConfig){e.next=2;break}return e.abrupt("return");case 2:if(i=this.errorReporter,a=this.pickers,o=this.pickerPromises,a.length){e.next=26;break}if(s={mediaClientConfig:this.uploadMediaClientConfig,errorReporter:i},c={uploadParams:t,proxyReactContext:r(),useForgePlugins:this.mediaOptions&&this.mediaOptions.useForgePlugins||!1,featureFlags:this.mediaOptions&&this.mediaOptions.featureFlags},!this.options.customMediaPicker){e.next=16;break}return l=new n("customMediaPicker",s,this.options.customMediaPicker).init(),o.push(l),e.t0=a,e.next=12,l;case 12:e.t1=this.customPicker=e.sent,e.t0.push.call(e.t0,e.t1),e.next=25;break;case 16:if(!this.shouldUseMediaPickerPopup()){e.next=25;break}return u=new n("popup",s,c).init(),o.push(u),e.t2=a,e.next=22,u;case 22:e.t3=this.popupPicker=e.sent,e.t2.push.call(e.t2,e.t3),this.removeOnCloseListener=this.popupPicker.onClose(this.onPopupPickerClose);case 25:a.forEach((function(e){e.onNewMedia(d.insertFile)}));case 26:a.forEach((function(e){return e.setUploadParams(t)}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"collectionFromProvider",value:function(){return this.mediaProvider&&this.mediaProvider.uploadParams&&this.mediaProvider.uploadParams.collection}},{key:"updateAndDispatch",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=n,i=e[r];void 0!==i&&(t[r]=i)})),this.dispatch&&this.dispatch(Ae,vt({},this))}}]),e}(),yt=function(e){return Ae.getState(e)},wt=function(e,t,n,r,a){var o=function(e){var t=document.createElement("div");return e?y.a.render(i.a.createElement(He,{type:"single"}),t):y.a.render(i.a.createElement(He),t),t}(a&&a.allowDropzoneDropLine);return new w.Plugin({state:{init:function(e,i){return new bt(i,t,n,a,r)},apply:function(e,t){"number"==typeof t.editingMediaSinglePos&&(t.editingMediaSinglePos=e.mapping.map(t.editingMediaSinglePos));var n=e.getMeta(Ae);if(n){var r=n.allowsUploads;t.updateAndDispatch({allowsUploads:void 0===r?t.allowsUploads:r})}return t}},filterTransaction:function(e,t){return!(e.selectionSet&&Object(j.isNodeSelection)(e.selection)&&e.selection.node.type===t.schema.nodes.media&&e.selection.$anchor.parent.type===t.schema.nodes.mediaSingle)},key:Ae,view:function(e){var t=yt(e.state);return t.setView(e),t.updateElement(),{update:function(){t.updateElement()}}},props:{decorations:function(e){if(yt(e).showDropzone){var t=e.schema,n=e.selection.$anchor;if(e.selection instanceof w.NodeSelection){if(e.selection.node.type===t.nodes.mediaSingle){var r=k.a.node(e.selection.from,e.selection.to,{class:"richMedia-selected"});return k.b.create(e.doc,[r])}}else{var i=n.pos;if(n.parent.type!==t.nodes.paragraph&&n.parent.type!==t.nodes.codeBlock&&(i=Object(O.h)(e.doc,i,t.nodes.mediaGroup)),null!=i){var a=[k.a.widget(i,o,{key:"drop-placeholder"})];return k.b.create(e.doc,a)}}}},nodeViews:t.nodeViews,handleTextInput:function(e){return yt(e.state).splitMediaGroup(),!1}}})},Ot=n("g09J");function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pt=new w.PluginKey("mediaEditorPlugin"),Ct=Object(Ot.a)(Pt,(function(e,t){switch(t.type){case"open":return xt(xt({},e),{},{editor:{identifier:t.identifier,pos:t.pos}});case"close":case"upload":return xt(xt({},e),{},{editor:void 0});case"setMediaClientConfig":return xt(xt({},e),{},{mediaClientConfig:t.mediaClientConfig});default:return e}}),{mapping:function(e,t){return t.editor?xt(xt({},t),{},{editor:xt(xt({},t.editor),{},{pos:e.mapping.map(t.editor.pos)})}):t}}),jt=Ct.createPluginState,Et=Ct.createCommand,_t=Ct.getPluginState;function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dt=function(){return Et({type:"close"})},Nt=function(e,t){return Et({type:"upload",newIdentifier:e},(function(n,r){var i=_t(r).editor;if(!i)return n;var a=n.mapping.map(i.pos),o=n.doc.nodeAt(a),s=r.schema.nodes.media;if(!o||o.type!==s)return n;var c=Mt(Mt({},o.attrs),{},{id:e.id,collection:e.collectionName||o.attrs.collection,occurrenceKey:e.occurrenceKey,width:t.width,height:t.height});return n.setNodeMarkup(a,void 0,c)}))},It=function(e){return function(t){var n=function(){var e=l()(g.a.mark((function e(n,r){var i,a,o,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mediaProvider"===n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r;case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,i.uploadMediaClientConfig;case 9:if(e.t0=e.sent,e.t0){e.next=14;break}return e.next=13,i.viewMediaClientConfig;case 13:e.t0=e.sent;case 14:a=e.t0,o=t.dispatch,s=t.state,Et({type:"setMediaClientConfig",mediaClientConfig:a})(s,o,t);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return e.subscribe("mediaProvider",n),{destroy:function(){e.unsubscribe("mediaProvider",n)}}}},Tt=function(e){var t=e.dispatch,n=e.providerFactory;return new w.Plugin({state:jt(t,{}),key:Pt,view:It(n)})};function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Lt=n("f5LB"),Ft=new w.PluginKey("mediaAltTextPlugin"),Ut=Object(Ot.a)(Ft,(function(e,t){switch(t.type){case"updateAltText":return Rt({},e);case"openMediaAltTextMenu":return Rt(Rt({},e),{},{isAltTextEditorOpen:!0});case"closeMediaAltTextMenu":return Rt(Rt({},e),{},{isAltTextEditorOpen:!1});default:return e}}),{onSelectionChanged:function(e,t){return e.getMeta(Lt.a)?t:{isAltTextEditorOpen:!1}}}),zt=Ut.createPluginState,Bt=Ut.createCommand,Vt=Ut.getPluginState,Wt=function(e){var t=e.dispatch;e.providerFactory;return new w.Plugin({state:zt(t,{isAltTextEditorOpen:!1}),key:Ft,view:function(){return{update:function(e,t){var n=Vt(e.state),r=Vt(t);n&&r&&r.isAltTextEditorOpen&&!n.isAltTextEditorOpen&&!e.hasFocus()&&e.focus()}}}})},qt=n("fwbU"),Kt=n("jWH/");function Gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qt,Ht,$t,Xt=Bt((function(e){return!!B(e)&&{type:"closeMediaAltTextMenu"}})),Yt=(Qt=ee.a.OPENED,Ht=function(e){return!!B(e)&&{type:"openMediaAltTextMenu"}},$t=function(e){return e.setMeta("scrollIntoView",!1)},Object(te.d)({action:Qt,actionSubject:ee.b.MEDIA,actionSubjectId:ee.c.ALT_TEXT,eventType:ee.d.TRACK})(Bt(Ht,$t)));function Zt(e,t){var n=e.$from,r=n.index(n.depth-1),i=n.node(n.depth-1);return i?i.maybeChild(r+t):null}function en(e){return function(t,n){var r=t.selection.$from,i=t.schema.nodes.paragraph,a=Zt(t.selection,-2);if(!a)return!1;var o=Zt(t.selection,-1),s=r.pos-o.nodeSize-a.nodeSize,c=t.tr;if(function(t){var n=!1;try{n=e(t)}catch(r){}return n}(a))c=c.replace(s-1,s+a.nodeSize);else if(Object(D.q)(t.selection)?c.replace(r.pos,r.pos+r.parent.nodeSize-1):c.replace(r.pos-1,r.pos+r.parent.nodeSize-1),a.type===i){var l=s+a.nodeSize-2;Object(j.safeInsert)(r.parent.content,l)(c)}else{var u=s+a.nodeSize-1;Object(j.safeInsert)(r.parent.copy(r.parent.content),u)(c)}return n&&n(c),!0}}var tn,nn=function(e){var t=Object(D.l)(e);return function(e,n){var r=e.selection,i=e.schema,a=r.$from;if(!function(e){return!!e.empty&&e.$from.parentOffset<=0}(e.selection))return!1;if(!function(e,t){return e.$from.parent.type===t}(e.selection,i.nodes.paragraph))return!1;return!!function(e,t,n){var r=Zt(e,n);return!!r&&r.type===t}(e.selection,i.nodes.mediaSingle,-1)&&("wrap-right"===Zt(e.selection,-1).attrs.layout?en(t)(e,n):(n&&Object(I.f)(e,(function(r){t(a.parent)&&!Object(R.d)(e)&&r.replace(a.pos-1,a.pos+a.parent.nodeSize-1),n(r)})),!0))}};function rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rn(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.showToolbar="MEDIA_SHOW_TOOLBAR",e.hideToolbar="MEDIA_HIDE_TOOLBAR",e.setUrl="MEDIA_SET_LINK_TO",e.unlink="MEDIA_LINKING_UNLINK"}(tn||(tn={}));function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?on(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var cn=new w.PluginKey("mediaLinking"),ln={visible:!1,editable:!1,mediaPos:null,link:""};var un=Object(Ot.a)(cn,(function(e,t){switch(t.type){case tn.showToolbar:return an(an({},e),{},{visible:!0});case tn.setUrl:return an(an({},e),{},{editable:!0,link:t.payload});case tn.hideToolbar:return an(an({},e),{},{visible:!1});case tn.unlink:return an(an({},e),{},{link:"",visible:!1,editable:!1})}return e}),{mapping:function(e,t){return t&&null!==t.mediaPos?sn(sn({},t),{},{mediaPos:e.mapping.map(t.mediaPos)}):t},onSelectionChanged:function(e){if(!(e.selection instanceof w.NodeSelection))return ln;var t=e.selection.$from.pos+1,n=e.doc.nodeAt(t);if(!n||"media"!==n.type.name)return ln;var r=n.marks.find((function(e){return"link"===e.type.name}));return sn(sn({},ln),{},r?{mediaPos:t,editable:!0,link:r.attrs.href}:{mediaPos:t})}}),dn=un.createCommand,pn=un.getPluginState,fn=n("SH5O"),hn=function(e){var t=e.doc,n=e.selection,r=e.schema;if(t&&n&&n instanceof w.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=t.nodeAt(n.$anchor.pos+1);if(i&&i.type===r.nodes.media)return i}},mn=n("OnqS"),vn=function(){var e=l()(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("external"!==t.attrs.type){e.next=2;break}return e.abrupt("return","external");case 2:if(t.attrs.id){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(mn.a)(n).file.getCurrentState(t.attrs.id,{collectionName:t.attrs.collection});case 7:if(!(r=e.sent)||"error"===r.status){e.next=10;break}return e.abrupt("return",r.mediaType);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}();function gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yn=dn((function(e){var t=pn(e);if(t&&null!==t.mediaPos&&e.doc.nodeAt(t.mediaPos))return{type:tn.showToolbar};return!1})),wn=function(e,t,n){if(t&&n){var r=hn(e);if(!r)return!1;var i=yt(e).mediaClientConfig;if(!i)return!1;vn(r,i).then((function(e){"external"!==e&&"image"!==e||hn(n.state)!==r||t(n.state.tr.setMeta(cn,{type:tn.showToolbar}))}))}return!0},On=dn({type:tn.hideToolbar}),kn=function(e,t,n){On(e,t,n),n&&n.focus()};function xn(e,t,n){var r=n.forceRemove,i=void 0!==r&&r,a=n.url,o=pn(t);if(!o||null===o.mediaPos)return e;var s=t.doc.resolve(o.mediaPos),c=t.doc.nodeAt(s.pos);if(!c)return e;var l=t.schema.marks.link,u=t.schema.nodes.media;return Object(T.f)(l,(function(e,t){if(t&&t.type===u){if(i)return!1;var n=Object(fn.g)(a);if(!e||e.href!==n)return""!==n.trim()&&bn(bn({},e),{},{href:n})}}),[u])(s.pos,s.pos+c.nodeSize,e,t),e}var Pn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Object(te.a)(t,e,{action:n,eventType:ee.d.TRACK,actionSubject:ee.b.MEDIA,actionSubjectId:ee.c.LINK,attributes:r})},Cn=dn({type:tn.unlink},(function(e,t){var n=xn(e,t,{forceRemove:!0});return Pn(n,t,ee.a.DELETED)})),jn=function(e,t){var n=function(e){var t=e.schema.marks.link,n=pn(e);if(n&&null!==n.mediaPos){var r=e.doc.resolve(n.mediaPos),i=e.doc.nodeAt(r.pos);if(i)if(t.isInSet(i.marks))return i.marks.find((function(e){return e.type===t})).attrs.href}}(t);return n?e!==n?ee.a.EDITED:void 0:ee.a.ADDED},En=function(e,t){return dn({type:tn.setUrl,payload:Object(fn.g)(e)},(function(n,r){var i=jn(e,r);if(!i)return n;try{var a=xn(n,r,{url:e});return Pn(n,r,i,i===ee.a.ADDED?{inputMethod:t}:void 0),a}catch(o){throw Pn(n,r,ee.a.ERRORED,{action:i}),o}}))};var _n=function(e){return Ae.getState(e).ignoreLinks=!0,!1},Sn=function(e){return Ae.getState(e).splitMediaGroup()},Mn=function(){var e={};return Kt.bindKeymapWithCommand(Kt.undo.common,_n,e),Kt.bindKeymapWithCommand(Kt.enter.common,Sn,e),Kt.bindKeymapWithCommand(Kt.insertNewLine.common,Sn,e),Object(qt.b)(e)},Dn=n("8R/O"),Nn=n.n(Dn),In=n("eo7v"),Tn=n("Zzit"),An=function(e){var t=e.editorView,n=e.eventDispatcher,r=e.pluginKey,a=e.isDisabled,o=e.isReducedSpacing;return i.a.createElement(Tn.a,{editorView:t,eventDispatcher:n,plugins:{mediaPlugin:r},render:function(e){var t,n=e.mediaPlugin;return n.allowsUploads?i.a.createElement(In.a,{onClick:(t=n,function(){return t.showMediaPicker(),!0}),disabled:a,title:"Files & images",spacing:o?"none":"default",iconBefore:i.a.createElement(Nn.a,{label:"Files & images"})}):null}})},Rn=n("Oqvs"),Ln=n("8m3F"),Fn=n.n(Ln),Un=n("8mfK"),zn=n("idzD"),Bn=n("gEh3"),Vn=n("Fu+u"),Wn=n("xk4V"),qn=n.n(Wn),Kn=function(){function e(t){var n=this;d()(this,e),m()(this,"props",void 0),m()(this,"updateContextId",l()(g.a.mark((function e(){var t,r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.getAttrs())&&"file"===t.type){e.next=3;break}return e.abrupt("return");case 3:return r=t.id,e.next=6,n.getObjectId();case 6:i=e.sent,ut(r,{__contextId:i},n.props.isMediaSingle)(n.props.view.state,n.props.view.dispatch);case 8:case"end":return e.stop()}}),e)})))),m()(this,"hasFileAttributesDefined",(function(){var e=n.getAttrs();return e&&"file"===e.type&&e.__fileName&&e.__fileMimeType&&e.__fileSize&&e.__contextId})),m()(this,"updateFileAttrs",l()(g.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(m.length>0&&void 0!==m[0])||m[0],r=n.getAttrs(),e.next=4,n.props.mediaProvider;case 4:if((i=e.sent)&&i.uploadParams&&r&&"file"===r.type&&!n.hasFileAttributesDefined()){e.next=7;break}return e.abrupt("return");case 7:return a=i.viewMediaClientConfig,o=Object(mn.a)(a),s={collectionName:r.collection},e.prev=10,e.next=13,o.file.getCurrentState(r.id,s);case 13:if("error"!==(c=e.sent).status){e.next=16;break}return e.abrupt("return");case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(10),e.abrupt("return");case 21:if(e.t1=n.getNodeContextId(),e.t1){e.next=26;break}return e.next=25,n.getObjectId();case 25:e.t1=e.sent;case 26:l=e.t1,d=(u=c).name,p=u.mimeType,f=u.size,Gn(r,h={__fileName:d,__fileMimeType:p,__fileSize:f,__contextId:l})&&ut(r.id,h,t)(n.props.view.state,n.props.view.dispatch);case 31:case"end":return e.stop()}}),e,null,[[10,18]])})))),m()(this,"getAttrs",(function(){var e=n.props.node.attrs;if(e)return e})),m()(this,"getObjectId",l()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.contextIdentifierProvider;case 2:return t=e.sent,e.abrupt("return",t&&t.objectId);case 4:case"end":return e.stop()}}),e)})))),m()(this,"uploadExternalMedia",function(){var e=l()(g.a.mark((function e(t){var r,i,a,o,s,c,l,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.node,e.next=3,n.props.mediaProvider;case 3:if(i=e.sent,!r||!i){e.next=21;break}if((a=i.uploadMediaClientConfig)&&r.attrs.url){e.next=8;break}return e.abrupt("return");case 8:return o=Object(mn.a)(a),s=i.uploadParams&&i.uploadParams.collection,e.prev=10,e.next=13,o.file.uploadExternal(r.attrs.url,s);case 13:c=e.sent,l=c.uploadableFileUpfrontIds,u=c.dimensions,pt(t()+1,{id:l.id,collection:s,height:u.height,width:u.width,occurrenceKey:l.occurrenceKey})(n.props.view.state,n.props.view.dispatch),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),n.props.dispatchAnalyticsEvent&&n.props.dispatchAnalyticsEvent({action:ee.a.UPLOAD_EXTERNAL_FAIL,actionSubject:ee.b.EDITOR,eventType:ee.d.OPERATIONAL});case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()),m()(this,"getNodeContextId",(function(){var e=n.getAttrs();if(e&&"file"===e.type)return e.__contextId})),m()(this,"updateDimensions",(function(e){ut(e.id,{height:e.height,width:e.width},!0)(n.props.view.state,n.props.view.dispatch)})),m()(this,"hasDifferentContextId",l()(g.a.mark((function e(){var t,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getNodeContextId(),e.next=3,n.getObjectId();case 3:if(r=e.sent,!t||!r||t===r){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))),m()(this,"isNodeFromDifferentCollection",l()(g.a.mark((function e(){var t,r,i,a,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if((t=e.sent)&&t.uploadParams){e.next=5;break}return e.abrupt("return",!1);case 5:if(r=t.uploadParams.collection,(i=n.getAttrs())&&"file"===i.type){e.next=9;break}return e.abrupt("return",!1);case 9:if(a=i.collection,o=i.__contextId,e.t0=o,e.t0){e.next=15;break}return e.next=14,n.getObjectId();case 14:e.t0=e.sent;case 15:if(!e.t0||r===a){e.next=18;break}return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})))),m()(this,"copyNodeFromBlobUrl",function(){var e=l()(g.a.mark((function e(t){var r,i,a,o,s,c,l,u,d,p,f,h,m,v,b,y,w,O,k;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.getAttrs())&&"external"===r.type){e.next=3;break}return e.abrupt("return");case 3:if(i=r.url,a=Object(F.b)(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,n.props.mediaProvider;case 9:if((o=e.sent)&&o.uploadParams){e.next=12;break}return e.abrupt("return");case 12:if(s=o.uploadParams.collection,c=a.contextId,l=a.id,u=a.collection,d=a.height,p=a.width,f=a.mimeType,h=a.name,m=a.size,(v=o.uploadMediaClientConfig)&&v.getAuthFromContext){e.next=17;break}return e.abrupt("return");case 17:return b=Object(mn.a)(v),e.next=20,v.getAuthFromContext(c);case 20:return y=e.sent,w={id:l,collection:u,authProvider:function(){return Promise.resolve(y)}},O={collection:s,authProvider:v.authProvider,occurrenceKey:qn()()},e.next=25,b.file.copyFile(w,O);case 25:k=e.sent,pt(t()+1,{id:k.id,collection:s,height:d,width:p,__fileName:h,__fileMimeType:f,__fileSize:m})(n.props.view.state,n.props.view.dispatch);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m()(this,"copyNode",l()(g.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m,v,b;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if(t=e.sent,r=n.props,i=r.isMediaSingle,a=r.view,o=n.getAttrs(),t&&t.uploadParams&&o&&"file"===o.type){e.next=7;break}return e.abrupt("return");case 7:if(s=n.getNodeContextId(),!((c=t.uploadMediaClientConfig)&&c.getAuthFromContext&&s)){e.next=25;break}return l=Object(mn.a)(c),e.next=13,c.getAuthFromContext(s);case 13:return u=e.sent,e.next=16,n.getObjectId();case 16:return d=e.sent,p=o.id,f=o.collection,h={id:p,collection:f,authProvider:function(){return Promise.resolve(u)}},m=t.uploadParams.collection,v={collection:m,authProvider:c.authProvider,occurrenceKey:qn()()},e.next=23,l.file.copyFile(h,v);case 23:b=e.sent,dt(h.id,{id:b.id,collection:m,__contextId:d},i)(a.state,a.dispatch);case 25:case"end":return e.stop()}}),e)})))),this.props=t}var t,n;return f()(e,[{key:"isMediaBlobUrl",value:function(){var e=this.getAttrs();return!(!e||"external"!==e.type||!Object(F.c)(e.url))}},{key:"getRemoteDimensions",value:(n=l()(g.a.mark((function e(){var t,n,r,i,a,o,s,c,l,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mediaProvider;case 2:if(t=e.sent,n=this.props.mediaOptions,r=this.getAttrs(),t&&r){e.next=7;break}return e.abrupt("return",!1);case 7:if(i=r.height,a=r.width,"external"!==r.type&&r.id){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=r.id,s=r.collection,!i||!a){e.next=13;break}return e.abrupt("return",!1);case 13:if(!n||n.allowRemoteDimensionsFetch){e.next=15;break}return e.abrupt("return",{id:o,height:_.a,width:_.b});case 15:return c=t.viewMediaClientConfig,l=Object(mn.a)(c),e.next=19,l.getImageMetadata(o,{collection:s});case 19:if((u=e.sent)&&u.original){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",{id:o,height:u.original.height||_.a,width:u.original.width||_.b});case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleExternalMedia",value:(t=l()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMediaBlobUrl()){e.next=12;break}return e.prev=1,e.next=4,this.copyNodeFromBlobUrl(t);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.uploadExternalMedia(t);case 10:e.next=14;break;case 12:return e.next=14,this.uploadExternalMedia(t);case 14:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Gn=function(e,t){return e.__fileName!==t.__fileName||e.__fileMimeType!==t.__fileMimeType||e.__fileSize!==t.__fileSize||e.__contextId!==t.__contextId};function Jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var Qn=function(e){return Object($e.c)(e.anchorPos,e.headPos,e.getPos(),e.node.nodeSize)},Hn=function(e){Ce()(n,e);var t=Jn(n);function n(e){var r;return d()(this,n),r=t.call(this,e),m()(xe()(r),"mediaPluginState",void 0),m()(xe()(r),"mediaNodes",void 0),m()(xe()(r),"state",{viewMediaClientConfig:void 0}),m()(xe()(r),"updateNodeAttrs",(function(e){var t=e.view,n=e.mediaProvider,i=e.contextIdentifierProvider;r.mediaNodes.forEach((function(e){new Kn({view:t,mediaProvider:n,contextIdentifierProvider:i,node:e,isMediaSingle:!1}).updateFileAttrs(!1)}))})),m()(xe()(r),"setMediaItems",(function(e){var t=e.node;r.mediaNodes=[],t.forEach((function(t,n){r.mediaPluginState.mediaGroupNodes[t.attrs.id]={node:t,getPos:function(){return e.getPos()+n+1}},r.mediaNodes.push(t)}))})),m()(xe()(r),"getIdentifier",(function(e){return"external"===e.attrs.type?{mediaItemType:"external-image",dataURI:e.attrs.url}:{id:e.attrs.id,mediaItemType:"file",collectionName:e.attrs.collection}})),m()(xe()(r),"isNodeSelected",(function(e){var t=Qn(r.props);return t===$e.a.selectedInRange||t===$e.a.selectedInside&&r.props.anchorPos===e})),m()(xe()(r),"renderChildNodes",(function(){var e=r.state.viewMediaClientConfig,t=r.props,n=t.getPos,a=t.allowLazyLoading,o=t.disabled,s=t.mediaOptions,c=r.mediaNodes.map((function(e,t){var s=function(){return n()+t+1};return{identifier:r.getIdentifier(e),isLazy:a,selected:r.isNodeSelected(s()),onClick:function(){Object(Te.f)(r.props.view,s())},actions:[{handler:o?function(){}:r.mediaPluginState.handleMediaNodeRemoval.bind(null,void 0,s),icon:i.a.createElement(Fn.a,{label:"delete"})}]}}));return i.a.createElement(Un.a,{items:c,mediaClientConfig:e,featureFlags:s.featureFlags})})),r.mediaNodes=[],r.mediaPluginState=Ae.getState(e.view.state),r.setMediaItems(e),r.state={viewMediaClientConfig:void 0},r}return f()(n,[{key:"componentDidMount",value:function(){var e=this;this.updateMediaClientConfig(),this.mediaNodes.forEach(function(){var t=l()(g.a.mark((function t(n){var r,i,a,o,s;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("external"!==n.attrs.type){t.next=2;break}return t.abrupt("return");case 2:if(r=e.props,i=r.view,a=r.mediaProvider,o=r.contextIdentifierProvider,s=new Kn({view:i,mediaProvider:a,contextIdentifierProvider:o,node:n,isMediaSingle:!1}),s.getNodeContextId()){t.next=8;break}return t.next=8,s.updateContextId();case 8:return t.next=10,s.hasDifferentContextId();case 10:if(!t.sent){t.next=14;break}return t.next=14,s.copyNode();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateMediaClientConfig(),this.setMediaItems(e),!1!==e.isCopyPasteEnabled&&this.updateNodeAttrs(e)}},{key:"shouldComponentUpdate",value:function(e){return t=this.props,n=e,Qn(t)!==Qn(n)||Qn(n)===$e.a.selectedInside&&t.anchorPos!==n.anchorPos||this.props.node!==e.node||this.state.viewMediaClientConfig!==this.mediaPluginState.mediaClientConfig;var t,n}},{key:"updateMediaClientConfig",value:function(){var e=this.state.viewMediaClientConfig,t=this.mediaPluginState.mediaClientConfig;!e&&t&&this.setState({viewMediaClientConfig:t})}},{key:"render",value:function(){return this.renderChildNodes()}}]),n}(i.a.Component);m()(Hn,"displayName","MediaGroup");var $n,Xn=function(e){Ce()(n,e);var t=Jn(n);function n(){return d()(this,n),t.apply(this,arguments)}return f()(n,[{key:"render",value:function(e,t){var n=this,r=e.providerFactory,a=e.mediaOptions,o=this.getPos;return i.a.createElement(Rn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:r,renderNode:function(e){var r=e.mediaProvider,s=e.contextIdentifierProvider;return i.a.createElement(Tn.a,{editorView:n.view,plugins:{reactNodeViewState:Bn.b,editorDisabledPlugin:Vn.b},render:function(e){var c=e.editorDisabledPlugin;return r?i.a.createElement(Hn,{node:n.node,getPos:o,view:n.view,forwardRef:t,disabled:(c||{}).editorDisabled,allowLazyLoading:a.allowLazyLoading,mediaProvider:r,contextIdentifierProvider:s,isCopyPasteEnabled:a.isCopyPasteEnabled,anchorPos:n.view.state.selection.$anchor.pos,headPos:n.view.state.selection.$head.pos,mediaOptions:a}):null}})}})}}]),n}(zn.a),Yn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Xn(i,a,o,e,t,{providerFactory:n,mediaOptions:r}).init()}},Zn=n("iWIM"),er=n.n(Zn),tr=n("pVnL"),nr=n.n(tr),rr=n("YPIr"),ir=n("TwjQ"),ar=n("S9L0"),or=ve.default.div($n||($n=me()(["\n  img {\n    width: 100%;\n  }\n\n  & > div {\n    ",";\n    position: relative;\n    clear: both;\n  }\n"])),ar.a);or.displayName="ResizerWrapper";var sr=n("N/j8"),cr=n("27vU"),lr=n("vExi"),ur=[250,384,576,768];function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var pr=function(e){Ce()(a,e);var t,n,r=dr(a);function a(){var e;d()(this,a);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),m()(xe()(e),"state",{offsetLeft:fr(e.insideInlineLike,e.insideLayout,e.props.view.dom,void 0),isVideoFile:!0}),m()(xe()(e),"calcNewSize",(function(t,n){var r=e.props,i=r.layout,a=r.view.state,o=100*Object(S.b)(t,e.props.lineLength);e.setState({resizedPctWidth:o});var s=Object(j.hasParentNodeOfType)(a.schema.nodes.table)(a.selection)?i:e.calcUnwrappedLayout(o,t);return o<=100?(!e.wrappedLayout||n&&100===o||(s=i),{width:o,layout:s}):{width:e.props.pctWidth||null,layout:s}})),m()(xe()(e),"calcUnwrappedLayout",(function(e,t){return e<=100?"center":t<=M.V?"wide":"full-width"})),m()(xe()(e),"calcColumnLeftOffset",(function(){var t=e.state.offsetLeft;return e.insideInlineLike?Object(S.a)(t,e.props.lineLength,e.props.gridSize):0})),m()(xe()(e),"wrapper",void 0),m()(xe()(e),"calcPxWidth",(function(t){var n=e.props,r=n.width,i=n.height,a=n.layout,o=n.pctWidth,s=n.lineLength,c=n.containerWidth,l=n.fullWidthMode,u=n.getPos,d=n.view.state,p=e.state.resizedPctWidth,f="function"==typeof u?u():void 0;return pe({origWidth:r,origHeight:i,pctWidth:o,state:d,containerWidth:{width:c,lineLength:s},isFullWidthModeEnabled:l,layout:t||a,pos:f,resizedPctWidth:p})})),m()(xe()(e),"highlights",(function(t,n){var r=Object(cr.c)(t,n),i=e.props.view.state.schema.nodes,a=i.layoutColumn,o=i.table,s=i.expand,c=i.nestedExpand;if(e.$pos&&Object(j.findParentNodeOfTypeClosestToPos)(e.$pos,[a,o,s,c].filter(Boolean)))return[];if(r>M.V)return["full-width"];var l=e.props,u=l.layout,d=l.lineLength,p=l.gridSize,f=Object(S.a)(r,d,p),h=Math.round(f),m=[];return"wrap-left"===u||"align-start"===u?m.push(0,h):"wrap-right"===u||"align-end"===u?m.push(p,p-h):e.insideInlineLike?m.push(Math.round(f+e.calcColumnLeftOffset())):m.push(Math.floor((p-h)/2),Math.ceil((p+h)/2)),m})),m()(xe()(e),"saveWrapper",(function(t){return e.wrapper=t})),e}return f()(a,[{key:"componentDidUpdate",value:function(){var e=fr(this.insideInlineLike,this.insideLayout,this.props.view.dom,this.wrapper);return e!==this.state.offsetLeft&&e>=0&&this.setState({offsetLeft:e}),!0}},{key:"wrappedLayout",get:function(){return _.e.indexOf(this.props.layout)>-1}},{key:"componentDidMount",value:(n=l()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.viewMediaClientConfig)){e.next=4;break}return e.next=4,this.checkVideoFile(t);case 4:this.props.pctWidth&&this.setState({resizedPctWidth:this.props.pctWidth});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.viewMediaClientConfig!==e.viewMediaClientConfig&&this.checkVideoFile(e.viewMediaClientConfig),this.props.layout!==e.layout&&this.checkLayout(this.props.layout,e.layout)}},{key:"checkVideoFile",value:(t=l()(g.a.mark((function e(t){var n,r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.$pos)&&t){e.next=3;break}return e.abrupt("return");case 3:if((r=this.props.view.state.doc.nodeAt(n.pos+1))&&r.attrs.id){e.next=6;break}return e.abrupt("return");case 6:return i=Object(mn.a)(t),e.prev=7,e.next=10,i.file.getCurrentState(r.attrs.id,{collectionName:r.attrs.collection});case 10:(a=e.sent)&&"error"!==a.status&&"image"===a.mediaType&&this.setState({isVideoFile:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),this.setState({isVideoFile:!1});case 17:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return t.apply(this,arguments)})},{key:"checkLayout",value:function(e,t){var n=this.state.resizedPctWidth;if(_.e.indexOf(e)>-1&&"center"===t&&n){var r=this.calcUnwrappedLayout(n,this.calcPxWidth(t));this.props.updateSize(n,r)}}},{key:"$pos",get:function(){if("function"!=typeof this.props.getPos)return null;var e=this.props.getPos();return Number.isNaN(e)||"number"!=typeof e?null:this.props.view.state.doc.resolve(e)}},{key:"gridWidth",get:function(){var e=this.props.gridSize;return this.wrappedLayout||this.insideInlineLike?e:e/2}},{key:"insideInlineLike",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.listItem;return!!Object(j.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"insideLayout",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.layoutColumn;return!!Object(j.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,r=t.height,a=t.layout,o=t.pctWidth,s=t.containerWidth,c=t.fullWidthMode,l=t.selected,u=t.view.state,d=t.children,p=this.calcPxWidth(),f=r/n*p,h=p,m={};cr.a.forEach((function(t){var n="left"===t?"right":"left";m[t]=["full-width","wide","center"].concat("wrap-".concat(n)).concat("align-".concat(cr.b[n])).indexOf(a)>-1,"left"===t&&e.insideInlineLike&&(m[t]=!1)}));this.$pos,M.V,this.props.allowBreakoutSnapPoints,this.props.containerWidth,this.props.gridSize,this.gridWidth,this.insideInlineLike,this.insideLayout,this.state.isVideoFile,this.props.lineLength,this.state.offsetLeft,this.wrappedLayout;return i.a.createElement(or,{ratio:(f/h*100).toFixed(3),layout:a,isResized:!!o,containerWidth:s||n,innerRef:this.saveWrapper,fullWidthMode:c},i.a.createElement(sr.a,nr()({},this.props,{width:h,height:f,selected:l,enable:m,calcNewSize:this.calcNewSize,snapPoints:ur,scaleFactor:this.wrappedLayout||this.insideInlineLike?1:2,highlights:this.highlights,handleResizeStart:function(){var e=Object(lr.c)(u);return!e||!e.dragging},nodeType:"media",dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),d))}}]),a}(i.a.Component);function fr(e,t,n,r){var i=0;r&&e&&!t&&(i=r.getBoundingClientRect().left-n.getBoundingClientRect().left);return i}var hr=n("jUYI"),mr=n("5LYD"),vr={allowResizing:!0,allowAdvancedToolBarOptions:!0,allowResizingInTables:!1,allowAnnotation:!0,UNSAFE_allowImageCaptions:!0},gr=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","false")}))},br=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","")}))},yr=function(){return document.querySelector(".ua-firefox")};function wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wr(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var xr=function(e){Ce()(r,e);var t,n=kr(r);function r(){var e;d()(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i)),m()(xe()(e),"state",{width:void 0,height:void 0,viewMediaClientConfig:void 0,isCopying:!1}),m()(xe()(e),"createMediaNodeUpdater",(function(t){var n=e.props.node.firstChild;return new Kn(Or(Or({},t),{},{isMediaSingle:!0,node:n||e.props.node,dispatchAnalyticsEvent:e.props.dispatchAnalyticsEvent}))})),m()(xe()(e),"setViewMediaClientConfig",function(){var t=l()(g.a.mark((function t(n){var r,i;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.mediaProvider;case 2:(r=t.sent)&&(i=r.viewMediaClientConfig,e.setState({viewMediaClientConfig:i}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),m()(xe()(e),"updateMediaNodeAttributes",function(){var t=l()(g.a.mark((function t(n){var r,i,a,o,s,c;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.createMediaNodeUpdater(n),i=e.props.mediaPluginState.addPendingTask,a=e.props.node.firstChild){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.getRemoteDimensions();case 7:if((o=t.sent)&&r.updateDimensions(o),"external"!==a.attrs.type||!a.attrs.__external){t.next=15;break}return s=r.handleExternalMedia(e.props.getPos),i(s),t.next=14,s;case 14:return t.abrupt("return");case 15:if(r.getNodeContextId()){t.next=19;break}return t.next=19,r.updateContextId();case 19:return t.next=21,r.hasDifferentContextId();case 21:if(!t.sent){t.next=34;break}return e.setState({isCopying:!0}),t.prev=24,c=r.copyNode(),i(c),t.next=29,c;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(24),e.setState({isCopying:!1});case 34:case"end":return t.stop()}}),t,null,[[24,31]])})));return function(e){return t.apply(this,arguments)}}()),m()(xe()(e),"selectMediaSingle",(function(t){var n=t.event;n.stopPropagation();var r=e.props.getPos(),i=e.props.view.state;if(n.shiftKey){if(i.selection instanceof Ie.a)return;Object(Te.g)(e.props.view,i.selection.from<r?i.selection.from:r,i.selection.to>r?i.selection.to:r+3)}else Object(Te.f)(e.props.view,r)})),m()(xe()(e),"updateSize",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch,o=e.props.getPos();if(void 0!==o){var s=i.tr.setNodeMarkup(o,void 0,Or(Or({},e.props.node.attrs),{},{layout:n,width:t}));return s.setMeta("scrollIntoView",!1),a(s)}})),m()(xe()(e),"forwardInnerRef",(function(t){e.props.forwardRef(t)})),m()(xe()(e),"getLineLength",(function(e,t){if(Object(mr.c)(e,t)){var n=e.state.doc.resolve(t),r=e.nodeDOM(n.pos);if(n.nodeAfter&&mr.b.indexOf(n.nodeAfter.attrs.layout)>-1&&r&&r.parentElement)return r.parentElement.offsetWidth;if(r instanceof HTMLElement)return r.offsetWidth}return null})),e}return f()(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.mediaProvider!==this.props.mediaProvider&&this.setViewMediaClientConfig(e),!1!==e.isCopyPasteEnabled&&this.createMediaNodeUpdater(e).updateFileAttrs()}},{key:"componentDidMount",value:(t=l()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.contextIdentifierProvider,e.next=3,Promise.all([this.setViewMediaClientConfig(this.props),this.updateMediaNodeAttributes(this.props)]);case 3:return e.t0=this,e.next=6,t;case 6:e.t1=e.sent,e.t2={contextIdentifierProvider:e.t1},e.t0.setState.call(e.t0,e.t2),null!=(n=yr())&&n.addEventListener("dragstart",gr),null==n||n.addEventListener("dragend",br);case 10:case"end":return e.stop()}var n}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e;null!=(e=yr())&&e.removeEventListener("dragstart",gr),null==e||e.removeEventListener("dragend",br)}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.getPos,r=e.node,a=e.mediaOptions,o=e.fullWidthMode,s=e.view.state,c=e.view,l=r.attrs,u=l.layout,d=l.width,p=r.firstChild.attrs,f=p.width,h=p.height;f&&h||(f=250,h=187.5);var m={layout:u,width:f,height:h,containerWidth:this.props.width,lineLength:this.props.lineLength||768,pctWidth:d||250/768*100,fullWidthMode:o},v=i.a.createElement(Re,{innerRef:this.forwardInnerRef}),g=!!this.props.mediaOptions.allowResizing;if(!this.props.mediaOptions.allowResizingInTables){var b=n();if(b){var y=s.doc.resolve(b),w=s.schema.nodes.table,O=!!Object(j.findParentNodeOfTypeClosestToPos)(y,[w]);g=g&&!O}}var k=this.getLineLength(c,n())||m.lineLength;return g?i.a.createElement(pr,nr()({},m,{lineLength:k,view:this.props.view,getPos:n,updateSize:this.updateSize,displayGrid:Object(hr.a)(this.props.eventDispatcher),gridSize:12,viewMediaClientConfig:this.state.viewMediaClientConfig,allowBreakoutSnapPoints:a&&a.allowBreakoutSnapPoints,selected:t(),dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),v):i.a.createElement(_.c,m,v)}}]),r}(r.Component);m()(xr,"defaultProps",{mediaOptions:{}}),m()(xr,"displayName","MediaSingleNode");var Pr=function(e){Ce()(n,e);var t=kr(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),m()(xe()(e),"lastOffsetLeft",0),m()(xe()(e),"forceViewUpdate",!1),m()(xe()(e),"selectionType",null),m()(xe()(e),"checkAndUpdateSelectionType",(function(){var t=e.getPos,n=e.view.state.selection,r=Object($e.c)(n.$anchor.pos,n.$head.pos,t(),e.node.nodeSize);return e.selectionType=r,r})),m()(xe()(e),"isNodeSelected",(function(){return e.checkAndUpdateSelectionType(),null!==e.selectionType})),e}return f()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return rr.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"getContentDOM",value:function(){return{dom:document.createElement("div")}}},{key:"viewShouldUpdate",value:function(e){return this.forceViewUpdate?(this.forceViewUpdate=!1,!0):this.node.attrs!==e.attrs||(this.selectionType!==this.checkAndUpdateSelectionType()||er()(Se()(n.prototype),"viewShouldUpdate",this).call(this,e))}},{key:"getNodeMediaId",value:function(e){if(e.firstChild)return e.firstChild.attrs.id}},{key:"update",value:function(e,t,r){var i=this;return r||(r=function(e,t){return i.getNodeMediaId(e)===i.getNodeMediaId(t)}),er()(Se()(n.prototype),"update",this).call(this,e,t,r)}},{key:"render",value:function(e,t){var n=this,r=this.reactComponentProps,a=r.eventDispatcher,o=r.fullWidthMode,s=r.providerFactory,c=r.mediaOptions,l=r.dispatchAnalyticsEvent,u=this.getPos;return i.a.createElement(Rn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:s,renderNode:function(e){var r=e.mediaProvider,s=e.contextIdentifierProvider;return i.a.createElement(Tn.a,{editorView:n.view,plugins:{width:ir.b,mediaPluginState:Ae},render:function(e){var d=e.width,p=e.mediaPluginState;return i.a.createElement(xr,{width:d.width,lineLength:d.lineLength,node:n.node,getPos:u,mediaProvider:r,contextIdentifierProvider:s,mediaOptions:Or(Or({},c),vr),view:n.view,fullWidthMode:o,selected:n.isNodeSelected,eventDispatcher:a,mediaPluginState:p,dispatchAnalyticsEvent:l,forwardRef:t})}})}})}},{key:"ignoreMutation",value:function(){if(this.dom){var e=this.dom.offsetLeft;e!==this.lastOffsetLeft&&(this.lastOffsetLeft=e,this.forceViewUpdate=!0,this.update(this.node,[],(function(){return!0})))}return!0}}]),n}(zn.a),Cr=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(a,o,s){return new Pr(a,o,s,e,t,{eventDispatcher:t,fullWidthMode:i.fullWidthEnabled,providerFactory:n,mediaOptions:i,dispatchAnalyticsEvent:r,isCopyPasteEnabled:i.isCopyPasteEnabled}).init()}},jr=n("RIqP"),Er=n.n(jr),_r=n("Fn6O"),Sr=n.n(_r),Mr=n("f9tS"),Dr=n("j964"),Nr=n("lTRq"),Ir=n.n(Nr),Tr=n("6FpG"),Ar=n("E9jt"),Rr=n("JRPe"),Lr=Object(Rr.e)({annotate:{id:"fabric.editor.annotate",defaultMessage:"Annotate",description:"Annotate an image by drawing arrows, adding text, or scribbles."}});function Fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var Ur,zr,Br=function(e,t){var n=Ae.getState(e);if(!n)return!1;var r=e.schema.nodes.mediaSingle,i=n.selectedMediaContainerNode();if(!i||i.type!==r)return!1;var a,o=i.firstChild.attrs,s=o.id,c=o.collection,l=o.occurrenceKey;return Object(te.d)({action:ee.a.CLICKED,actionSubject:ee.b.MEDIA,actionSubjectId:ee.c.ANNOTATE_BUTTON,eventType:ee.d.UI})((a=e.selection.from+1,Et({type:"open",identifier:{id:s,collectionName:c,mediaItemType:"file",occurrenceKey:l},pos:a})))(e,t)},Vr=function(e){Ce()(a,e);var t,n,r=Fr(a);function a(){var e;d()(this,a);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),m()(xe()(e),"state",{isImage:!1}),m()(xe()(e),"onClickAnnotation",(function(){var t=e.props.view;t&&Br(t.state,t.dispatch)})),e}return f()(a,[{key:"componentDidMount",value:(n=l()(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkIsImage();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkIsImage",value:(t=l()(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(mn.a)(this.props.viewMediaClientConfig),this.props.id){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.file.getCurrentState(this.props.id,{collectionName:this.props.collection});case 6:(n=e.sent)&&"error"!==n.status&&"image"===n.mediaType&&this.setState({isImage:!0}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){var t=this;e.id!==this.props.id&&this.setState({isImage:!1},(function(){t.checkIsImage()}))}},{key:"render",value:function(){if(!this.state.isImage)return null;var e=this.props.intl.formatMessage(Lr.annotate);return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ar.a,null),i.a.createElement(Tr.a,{title:e,icon:i.a.createElement(Ir.a,{label:e}),onClick:this.onClickAnnotation}))}}]),a}(i.a.Component),Wr=function(e,t){return function(n,r){var a=e.selectedMediaContainerNode();return a&&e.mediaClientConfig?i.a.createElement(Vr,{key:r,viewMediaClientConfig:e.mediaClientConfig,id:a.firstChild.attrs.id,collection:a.firstChild.attrs.collection,view:n,intl:t}):null}},qr=n("oMky"),Kr=n.n(qr),Gr=n("VAOK"),Jr=n.n(Gr),Qr=n("GwG2"),Hr=n("q86w"),$r=n("YVJ+"),Xr=n("WRQz");function Yr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var Zr=Object(Rr.e)({backLink:{id:"fabric.editor.backLink",defaultMessage:"Go back",description:"Go back from media linking toolbar to main toolbar"}}),ei=ve.default.section(Ur||(Ur=me()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 4px 0 32px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),be.R400),ti=ve.default.span(zr||(zr=me()(["\n  padding: 4px 8px 4px 0px;\n"]))),ni=function(e){Ce()(n,e);var t=Yr(n);function n(){var e;d()(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),m()(xe()(e),"state",{validationErrors:[]}),m()(xe()(e),"handleSubmit",(function(t){var n=t.url,r=t.inputMethod;e.props.onSubmit(n,{inputMethod:r})})),m()(xe()(e),"handleOnBack",(function(t){var n=t.url,r=t.inputMethod,i=e.props.onBack;i&&i(n,{inputMethod:r})})),m()(xe()(e),"handleCancel",(function(){var t=e.props.onCancel;t&&t()})),m()(xe()(e),"handleUnlink",(function(){var t=e.props.onUnlink;t&&t()})),m()(xe()(e),"handleOnBlur",(function(t){e.props.onBlur(t.url)})),m()(xe()(e),"renderContainer",(function(t){var n,r=t.activityProvider,a=t.inputProps,o=a.onChange,s=a.onKeyDown,c=a.onSubmit,l=a.value,u=t.currentInputMethod,d=t.renderRecentList,p=e.props,f=p.intl.formatMessage,h=p.displayUrl,m=f(Zr.backLink),v=f(Mr.b.unlink),g=e.state.validationErrors.map((function(e,t){return i.a.createElement(Xr.a,{key:t},e)}));return i.a.createElement("div",{className:"recent-list"},i.a.createElement(Hr.a,{provider:!!r},i.a.createElement(Hr.e,null,i.a.createElement(ti,null,i.a.createElement(Tr.a,{title:m,icon:i.a.createElement(Kr.a,{label:m}),onClick:function(){return e.handleOnBack({url:l,inputMethod:u})}})),i.a.createElement(Qr.a,{testId:"media-link-input",placeholder:(n=!!r,f(n?Mr.b.placeholder:Mr.b.linkPlaceholder)),autoFocus:!0,onCancel:e.handleCancel,defaultValue:l,onSubmit:function(t){var n=e.getValidationErrors(t,u);e.setState({validationErrors:n}),n.length||c()},onChange:function(t){e.setState({validationErrors:[]}),o(t)},onKeyDown:s}),Object(fn.g)(h)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Ar.a,null),i.a.createElement(Tr.a,{title:v,icon:i.a.createElement(Jr.a,{label:v}),onClick:e.handleUnlink}))),!!g.length&&i.a.createElement(ei,null,g),d()))})),e}return f()(n,[{key:"getValidationErrors",value:function(e,t){var n=this.props.intl.formatMessage;return t===ee.e.TYPEAHEAD?[]:e?Object(fn.g)(e)?[]:[n(Mr.b.invalidLink)]:[n(Mr.b.emptyLink)]}},{key:"render",value:function(){var e=this.props,t=e.providerFactory,n=e.displayUrl;return i.a.createElement($r.a,{defaultUrl:Object(fn.g)(n),providerFactory:t,onSubmit:this.handleSubmit,onBlur:this.handleOnBlur,render:this.renderContainer})}}]),n}(i.a.PureComponent);function ri(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ri(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ri(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ai(e){var t=pn(e);if(!t||null===t.mediaPos)return!1;var n=e.schema,r=n.nodes.media,i=n.marks.link,a=e.doc.nodeAt(t.mediaPos);if(!a||a.type!==r)return!1;var o=e.doc.resolve(t.mediaPos).parent;return o&&o.type.allowsMarkType(i)}var oi,si,ci,li,ui,di,pi=function(e,t,n,r,a){var o=t.link,s=t.visible,c=t.editable,l=t.mediaPos;if(s&&null!==l&&n.doc.nodeAt(l))return ii(ii({},e),{},{height:Hr.c,width:Hr.d,forcePlacement:!0,items:[{type:"custom",render:function(e,t){return e&&a?i.a.createElement(ni,{key:t,displayUrl:o,providerFactory:a,intl:r,editing:c,onUnlink:function(){return Cn(e.state,e.dispatch,e)},onBack:function(t,n){t.trim()&&n.inputMethod&&En(t,n.inputMethod)(e.state,e.dispatch,e),kn(e.state,e.dispatch,e)},onCancel:function(){return kn(e.state,e.dispatch,e)},onSubmit:function(t,n){En(t,n.inputMethod)(e.state,e.dispatch,e),kn(e.state,e.dispatch,e)},onBlur:function(){kn(e.state,e.dispatch,e)}}):null}}]})},fi=n("zQFu"),hi=Object(Rr.e)({altText:{id:"fabric.editor.addAltText",defaultMessage:"Alt text",description:"Add an alt text for this image"},editAltText:{id:"fabric.editor.editAltText",defaultMessage:"Edit alt text",description:"Edit an alt text for this image"},back:{id:"fabric.editor.closeAltTextEdit",defaultMessage:"Back",description:"Back to toolbar"},clear:{id:"fabric.editor.clearAltTextEdit",defaultMessage:"Clear alt text",description:"Clear alt text"},placeholder:{id:"fabric.editor.placeholderAltText",defaultMessage:"Describe this image with alt text",description:"Describe this image with alt text"},supportText:{id:"fabric.editor.supportAltText",defaultMessage:"Alt text is useful for people using screen readers because of visual limitations.",description:"Alt text is useful for people using screen readers because of visual limitations."},validationMessage:{id:"fabric.editor.alttext.validation",defaultMessage:"Please remove any special characters in alt text.",description:"Please remove any special characters in alt text. "}}),mi=n("SEpd"),vi=n.n(mi),gi=n("DbPK"),bi=n("qo7T");function yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var wi=Hr.d,Oi=ve.default.p(oi||(oi=me()(["\n  color: ",";\n  font-size: 12px;\n  padding: 12px 40px;\n  line-height: 20px;\n  border-top: 1px solid ",";\n  margin: 0;\n"])),be.N100,be.N30),ki=ve.default.div(si||(si=me()(["\n  width: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  line-height: 2;\n"])),wi),xi=ve.default.section(ci||(ci=me()(["\n  display: flex;\n  line-height: 0;\n  padding: 5px 0;\n  align-items: center;\n"]))),Pi=ve.default.section(li||(li=me()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 12px 0 40px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),be.R400),Ci=ve.default.div(ui||(ui=me()(["\n  display: flex;\n  padding: 4px 8px;\n"]))),ji=ve.default.span(di||(di=me()(["\n  color: ",";\n"])),be.N80),Ei=function(e){Ce()(n,e);var t=yi(n);function n(e){var r;d()(this,n),r=t.call(this,e),m()(xe()(r),"fireCustomAnalytics",void 0),m()(xe()(r),"state",{showClearTextButton:Boolean(r.props.value),validationErrors:r.props.value?r.getValidationErrors(r.props.value):[],lastValue:r.props.value}),m()(xe()(r),"prevValue",void 0),m()(xe()(r),"closeMediaAltTextMenu",(function(){var e=r.props.view;Xt(e.state,e.dispatch)})),m()(xe()(r),"dispatchCancelEvent",(function(e){var t=r.props.view;t.someProp("handleKeyDown",(function(n){return n(t,e)}))})),m()(xe()(r),"updateAltText",(function(e){var t=r.props.view;!function(e){return Bt((function(e){return!!B(e)&&{type:"updateAltText"}}),(function(t,n){var r=Z(n),i=t.selection.from+1;return r&&(t.setMeta("scrollIntoView",!1),t.setNodeMarkup(i,void 0,Jt(Jt({},r.attrs),{},{alt:e}))),t}))}(0===e.length?null:e)(t.state,t.dispatch)})),m()(xe()(r),"handleOnChange",(function(e){var t=r.getValidationErrors(e);r.setState({showClearTextButton:Boolean(e),validationErrors:t,lastValue:e},(function(){t&&t.length||r.updateAltText(e)}))})),m()(xe()(r),"handleOnBlur",(function(){var e=r.props.value,t=(r.state.lastValue||e||"").trim();r.handleOnChange(t)})),m()(xe()(r),"handleClearText",(function(){r.handleOnChange("")}));var i=e.createAnalyticsEvent;return r.fireCustomAnalytics=Object(bi.a)(i),r}return f()(n,[{key:"componentDidMount",value:function(){this.prevValue=this.props.value}},{key:"componentWillUnmount",value:function(){this.fireAnalytics(ee.a.CLOSED),!this.prevValue&&this.props.value&&this.fireAnalytics(ee.a.ADDED),this.prevValue&&!this.props.value&&this.fireAnalytics(ee.a.CLEARED),this.prevValue&&this.prevValue!==this.props.value&&this.fireAnalytics(ee.a.EDITED)}},{key:"getValidationErrors",value:function(e){var t=this.props.altTextValidator;return e&&"function"==typeof t&&t(e)||[]}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=this.state.showClearTextButton,n=e(hi.back),r=i.a.createElement(Kt.ToolTipContent,{description:n,keymap:Kt.escape,shortcutOverride:"Esc"}),a=(this.state.validationErrors||[]).map((function(e,t){return i.a.createElement(Xr.a,{key:t},e)}));return i.a.createElement(ki,null,i.a.createElement(xi,null,i.a.createElement(Ci,null,i.a.createElement(Tr.a,{title:e(hi.back),icon:i.a.createElement(Kr.a,{label:e(hi.back)}),tooltipContent:r,onClick:this.closeMediaAltTextMenu})),i.a.createElement(Qr.a,{testId:"alt-text-input",placeholder:e(hi.placeholder),defaultValue:this.state.lastValue,onCancel:this.dispatchCancelEvent,onChange:this.handleOnChange,onBlur:this.handleOnBlur,onSubmit:this.closeMediaAltTextMenu,maxLength:510,autoFocus:!0}),t&&i.a.createElement(Ci,null,i.a.createElement(Tr.a,{testId:"alt-text-clear-button",title:e(hi.clear),icon:i.a.createElement(ji,null,i.a.createElement(vi.a,{label:e(hi.clear)})),tooltipContent:e(hi.clear),onClick:this.handleClearText}))),!!a.length&&i.a.createElement(Pi,null,a),i.a.createElement(Oi,null,e(hi.supportText)))}},{key:"fireAnalytics",value:function(e){this.props.createAnalyticsEvent&&this.fireCustomAnalytics&&this.fireCustomAnalytics({payload:{action:e,actionSubject:ee.b.MEDIA,actionSubjectId:ee.c.ALT_TEXT,eventType:ee.d.TRACK}})}}]),n}(i.a.Component),_i=Object(gi.a)()(Object(Rr.f)(Ei)),Si={FLOATING_TOOLBAR_COMPONENT:"".concat("pm-alt-text","-alt-text-floating-toolbar")};function Mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mi(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ni,Ii=function(e,t){var n=Z(t),r=n&&n.attrs.alt?hi.editAltText:hi.altText,a=e.formatMessage(r);return{title:a,type:"button",onClick:Yt,showTitle:!0,testId:"alt-text-edit-button",tooltipContent:i.a.createElement(Kt.ToolTipContent,{description:a,keymap:Kt.addAltText})}},Ti=function(e){return{type:"custom",render:function(t,n){if(!t)return null;var r=Z(t.state);return r?i.a.createElement(_i,{view:t,key:n,value:r.attrs.alt,altTextValidator:e&&e.altTextValidator}):null}}},Ai=function(e,t){return Di(Di({},e),{},{width:wi,className:Si.FLOATING_TOOLBAR_COMPONENT,items:[Ti(t)]})},Ri=n("J4zp"),Li=n.n(Ri),Fi=n("01nc"),Ui=n.n(Fi),zi=n("WhJf"),Bi=n.n(zi),Vi=n("K3FS"),Wi=n("fR7n"),qi=ve.default.div(Ni||(Ni=me()(["\n  display: flex;\n  align-items: center;\n  margin-right: 4px;\n"]))),Ki=function(e){var t=e.editorState,n=e.mediaLinkingState,a=e.intl,o=e.showSeparatorLeft,s=e.onAddLink,c=e.onEditLink,l=e.onOpenLink,u=Object(r.useState)(!1),d=Li()(u,2),p=d[0],f=d[1];if(Object(r.useEffect)((function(){var e;f(!1);var n=hn(t);if(n){var r=null===(e=Ae.getState(t))||void 0===e?void 0:e.mediaClientConfig;r&&vn(n,r).then((function(e){"external"!==e&&"image"!==e||f(!0)}))}}),[t]),!p)return null;if(n&&n.editable){var h=Object(Vi.a)(n.link),m=a.formatMessage(Mr.b.editLink),v=a.formatMessage(h?Wi.a.openLink:Mr.b.unableToOpenLink);return i.a.createElement(i.a.Fragment,null,o&&i.a.createElement(qi,null,i.a.createElement(Ar.a,null)),i.a.createElement(qi,null,i.a.createElement(Tr.a,{onClick:c,title:m,tooltipContent:i.a.createElement(Kt.ToolTipContent,{description:m,keymap:Kt.addLink})},m)),i.a.createElement(qi,null,i.a.createElement(Ar.a,null)),i.a.createElement(Tr.a,{target:"_blank",href:h?n.link:void 0,disabled:!h,onClick:l,title:v,icon:i.a.createElement(Bi.a,{label:v}),className:"hyperlink-open-link"}))}var g=a.formatMessage(Mr.b.addLink);return i.a.createElement(i.a.Fragment,null,o&&i.a.createElement(qi,null,i.a.createElement(Ar.a,null)),i.a.createElement(Tr.a,{testId:"add-link-button",onClick:s,title:g,tooltipContent:i.a.createElement(Kt.ToolTipContent,{description:g,keymap:Kt.addLink}),icon:i.a.createElement(Ui.a,{label:g})}))};function Gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ji(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qi=function(e,t){return t&&t(Object(j.removeSelectedNode)(e.tr)),!0},Hi=n("DCMf"),$i=n("cFgX");function Xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var Yi=function(e){Ce()(n,e);var t=Xi(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),m()(xe()(e),"onUploadStart",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch;Nt(t,n)(i,a)})),m()(xe()(e),"onClose",(function(){var t=e.props.view,n=t.state,r=t.dispatch;Dt()(n,r)})),e}return f()(n,[{key:"render",value:function(){var e=this.props.mediaEditorState,t=e.editor,n=e.mediaClientConfig;if(!t||!n)return null;var r=t.identifier;return i.a.createElement($i.a,{identifier:r,mediaClientConfig:n,onUploadStart:this.onUploadStart,onClose:this.onClose})}}]),n}(i.a.PureComponent);function Zi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}m()(Yi,"displayName","MediaEditor");var ea={on:function(){},removeAllListeners:function(){},emit:function(){},destroy:function(){},setUploadParams:function(){}},ta=function(e){Ce()(n,e);var t=Zi(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),m()(xe()(e),"state",{}),m()(xe()(e),"handleMediaProvider",function(){var t=l()(g.a.mark((function t(n,r){var i,a,o,s,c,l,u,d;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.props,a=i.mediaState,o=i.analyticsName,t.next=3,r;case 3:if((s=t.sent)&&s.uploadParams){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,s.uploadMediaClientConfig;case 8:if(t.t0=t.sent,t.t0){t.next=13;break}return t.next=12,s.viewMediaClientConfig;case 12:t.t0=t.sent;case 13:if(c=t.t0){t.next=16;break}return t.abrupt("return");case 16:return l={mediaClientConfig:c,errorReporter:a.options.errorReporter||new x.a,featureFlags:a.mediaOptions&&a.mediaOptions.featureFlags},t.next=19,new ht("customMediaPicker",l,ea,ft.d,o).init();case 19:(u=t.sent).onNewMedia(a.insertFile),u.setUploadParams(s.uploadParams),d={uploadParams:s.uploadParams},e.setState({pickerFacadeInstance:u,config:d,mediaClientConfig:c});case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),e}return f()(n,[{key:"componentDidMount",value:function(){this.props.mediaState.options.providerFactory.subscribe("mediaProvider",this.handleMediaProvider)}},{key:"componentWillUnmount",value:function(){this.props.mediaState.options.providerFactory.unsubscribe("mediaProvider",this.handleMediaProvider)}},{key:"render",value:function(){var e=this.state,t=e.mediaClientConfig,n=e.config,r=e.pickerFacadeInstance;return t&&n&&r?this.props.children({mediaClientConfig:t,config:n,pickerFacadeInstance:r}):null}}]),n}(i.a.Component),na=function(e){var t=e.mediaState,n=e.featureFlags;return i.a.createElement(ta,{mediaState:t,analyticsName:"clipboard"},(function(e){var t=e.mediaClientConfig,r=e.config,a=e.pickerFacadeInstance;return i.a.createElement(ft.b,{mediaClientConfig:t,config:r,onError:a.handleUploadError,onPreviewUpdate:a.handleUploadPreviewUpdate,onEnd:a.handleReady,featureFlags:n})}))};function ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ia(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ra(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ra(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var aa=function(e){var t=e.mediaState,n=e.isActive,r=e.featureFlags;return i.a.createElement(ta,{mediaState:t,analyticsName:"dropzone"},(function(e){var a=e.mediaClientConfig,o=e.config,s=e.pickerFacadeInstance,c=t.options.customDropzoneContainer,l=t.handleDrag,u=ia(ia({},o),{},{container:c});return n?i.a.createElement(ft.c,{mediaClientConfig:a,config:u,onError:s.handleUploadError,onPreviewUpdate:s.handleUploadPreviewUpdate,onEnd:s.handleReady,onDragEnter:function(){return l("enter")},onDragLeave:function(){return l("leave")},featureFlags:r}):null}))},oa=function(e){var t=e.mediaState,n=e.isOpen,r=e.onBrowseFn,a=e.featureFlags;return i.a.createElement(ta,{mediaState:t,analyticsName:"browser"},(function(e){var t=e.mediaClientConfig,o=e.config,s=e.pickerFacadeInstance;return i.a.createElement(ft.a,{onBrowseFn:r,isOpen:n,config:o,mediaClientConfig:t,onEnd:s.handleReady,onError:s.handleUploadError,onPreviewUpdate:s.handleUploadPreviewUpdate,featureFlags:a})}))};function sa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var ca=function(e){Ce()(n,e);var t=sa(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),m()(xe()(e),"state",{isPopupOpened:!1}),m()(xe()(e),"onBrowseFn",(function(t){var n=e.props.mediaState;n&&n.setBrowseFn(t)})),e}return f()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.mediaState.onPopupToggle((function(t){e.setState({isPopupOpened:t})}))}},{key:"render",value:function(){var e=this.props.mediaState,t=this.state.isPopupOpened,n=e.mediaOptions&&e.mediaOptions.featureFlags;return i.a.createElement(i.a.Fragment,null,i.a.createElement(na,{mediaState:e,featureFlags:n}),i.a.createElement(aa,{mediaState:e,isActive:!t,featureFlags:n}),!e.shouldUseMediaPickerPopup()&&i.a.createElement(oa,{onBrowseFn:this.onBrowseFn,mediaState:e,featureFlags:n}))}}]),n}(i.a.Component);m()(ca,"displayName","MediaPickerComponents");var la=n("jPV8");function ua(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function da(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ua(Object(n),!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ua(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se()(e);if(t){var i=Se()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ee()(this,n)}}var fa=function(e){Ce()(n,e);var t=pa(n);function n(){var e;d()(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),m()(xe()(e),"renderMediaNodeWithState",(function(t,n,r){return function(a){var o=a.width,s=e.getPos,c=e.reactComponentProps.mediaOptions,l=e.view.state.selection,u=e.getAttrs(),d=u.width,p=u.height;d=d||_.b,p=p||_.a;var f={width:"".concat(o.width,"px"),height:"".concat(p/d*o.width,"px")},h={width:d,height:p};return i.a.createElement(Ge,{view:e.view,node:e.node,getPos:s,selected:e.isNodeInsideSelection(l.from,l.to)||l instanceof w.NodeSelection&&l.from===s(),originalDimensions:h,maxDimensions:f,mediaProvider:t,contextIdentifierProvider:n,uploadComplete:e.uploadComplete(),mediaOptions:c,collabEditProvider:r})}})),m()(xe()(e),"renderMediaNodeWithProviders",(function(t){var n=t.mediaProvider,r=t.contextIdentifierProvider,a=t.collabEditProvider;return i.a.createElement(Tn.a,{editorView:e.view,plugins:{width:ir.b},render:e.renderMediaNodeWithState(n,r,a)})})),e}return f()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return rr.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"viewShouldUpdate",value:function(e){return this.node.attrs!==e.attrs||er()(Se()(n.prototype),"viewShouldUpdate",this).call(this,e)}},{key:"stopEvent",value:function(e){if(-1!==["mousedown","contextmenu"].indexOf(e.type)&&2===e.button)return!0;return!1}},{key:"getAttrs",value:function(){return this.node.attrs}},{key:"uploadComplete",value:function(){return lt(Ae.getState(this.view.state),this.node.attrs.id)}},{key:"render",value:function(){var e=this.reactComponentProps.providerFactory;return i.a.createElement(Rn.a,{providers:["mediaProvider","contextIdentifierProvider","collabEditProvider"],providerFactory:e,renderNode:this.renderMediaNodeWithProviders})}}]),n}(n("LVu0").a),ha=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new fa(i,a,o,e,t,{eventDispatcher:t,providerFactory:n,mediaOptions:da(da({},r),vr)}).init()}};t.a=function(e){return{name:"media",nodes:function(){var t=e||{},n=t.allowMediaGroup,r=void 0===n||n,i=t.allowMediaSingle,c=void 0!==i&&i,l=t.UNSAFE_allowImageCaptions,u=(void 0===l?vr.UNSAFE_allowImageCaptions:l)?a.b:a.a;return[{name:"mediaGroup",node:o.a},{name:"mediaSingle",node:u},{name:"media",node:s.b}].filter((function(e){return"mediaGroup"===e.name?r:"mediaSingle"!==e.name||c}))},pmPlugins:function(){var t=[{name:"media",plugin:function(t){t.schema;var n=t.dispatch,r=t.eventDispatcher,i=t.providerFactory,a=t.errorReporter,o=t.portalProviderAPI,s=t.reactContext,c=t.dispatchAnalyticsEvent;return wt(0,{providerFactory:i,nodeViews:{mediaGroup:Yn(o,r,i,e),mediaSingle:Cr(o,r,i,c,e),media:ha(o,r,i,e)},errorReporter:a,uploadErrorHandler:e&&e.uploadErrorHandler,waitForMediaUpload:e&&e.waitForMediaUpload,customDropzoneContainer:e&&e.customDropzoneContainer,customMediaPicker:e&&e.customMediaPicker,allowResizing:!(!e||!e.allowResizing)},s,n,e)}},{name:"mediaKeymap",plugin:function(){return Mn()}}];return e&&e.allowMediaSingle&&t.push({name:"mediaSingleKeymap",plugin:function(e){return function(e){var t={},n=nn(e);return Kt.bindKeymapWithCommand(Kt.backspace.common,n,t),Object(qt.b)(t)}(e.schema)}}),e&&e.allowAnnotation&&t.push({name:"mediaEditor",plugin:Tt}),e&&e.allowAltTextOnImages&&(t.push({name:"mediaAltText",plugin:Wt}),t.push({name:"mediaAltTextKeymap",plugin:function(e){var t;e.schema;return t={},Kt.bindKeymapWithCommand(Kt.addAltText.common,Yt,t),Kt.bindKeymapWithCommand(Kt.escape.common,Xt,t),Object(qt.b)(t)}})),e&&e.allowLinking&&(t.push({name:"mediaLinking",plugin:function(e){return function(e){return new w.Plugin({key:cn,state:un.createPluginState(e,ln)})}(e.dispatch)}}),t.push({name:"mediaLinkingKeymap",plugin:function(e){var t;e.schema;return t={},Kt.bindKeymapWithCommand(Kt.addLink.common,wn,t),Object(qt.b)(t)}})),t},contentComponent:function(t){var n=t.editorView,r=t.eventDispatcher,a=e&&e.allowAnnotation?i.a.createElement(Tn.a,{editorView:n,plugins:{mediaEditorState:Pt},eventDispatcher:r,render:function(e){var t=e.mediaEditorState;return i.a.createElement(Yi,{mediaEditorState:t,view:n})}}):null;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Tn.a,{editorView:n,plugins:{mediaState:Ae},render:function(e){var t=e.mediaState;return i.a.createElement(ca,{mediaState:t})}}),a)},secondaryToolbarComponent:function(e){var t=e.editorView,n=e.eventDispatcher,r=e.disabled;return i.a.createElement(An,{editorView:t,eventDispatcher:n,pluginKey:Ae,isDisabled:r,isReducedSpacing:!0})},pluginsOptions:{quickInsert:function(e){var t=e.formatMessage;return[{id:"media",title:t(la.a.filesAndImages),description:t(la.a.filesAndImagesDescription),priority:400,keywords:["attachment","gif","media","picture"],icon:function(){return i.a.createElement(Hi.j,{label:t(la.a.filesAndImages)})},action:function(e,t){Ae.getState(t).showMediaPicker();var n=e("");return Object(te.a)(t,n,{action:ee.a.OPENED,actionSubject:ee.b.PICKER,actionSubjectId:ee.c.PICKER_CLOUD,attributes:{inputMethod:ee.e.QUICK_INSERT},eventType:ee.d.UI})}}]},floatingToolbar:function(t,n,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.providerFactory,a=n.allowResizing,o=n.allowAnnotation,s=n.allowLinking,c=n.allowAdvancedToolBarOptions,l=n.allowResizingInTables,u=n.allowAltTextOnImages,d=n.altTextValidator,p=e.schema.nodes.mediaSingle,f=Ae.getState(e),h=pn(e);if(p&&f){var m={title:"Media floating controls",nodeType:p,getDomRef:function(){return f.element}};if(s&&h&&h.visible&&ai(e)){var v=pi(m,h,e,t,r);if(v)return v}var g=[];if(c){if((g=Object(fi.a)(e,t,e.schema.nodes.mediaSingle,a,l)).length&&o&&g.push({type:"custom",render:Wr(f,t)}),s&&ai(e)){var b=g.length>0;g.push({type:"custom",render:function(e,n){if(null!=e&&e.state){var r=function(){if(e){var t=e.state,n=e.dispatch;yn(t,n)}};return i.a.createElement(Ki,{key:n,editorState:e.state,intl:t,mediaLinkingState:h,onAddLink:r,onEditLink:r,onOpenLink:function(){if(e){var t=e.state;return(0,e.dispatch)(Object(te.a)(t,t.tr,{eventType:ee.d.TRACK,action:ee.a.VISITED,actionSubject:ee.b.MEDIA,actionSubjectId:ee.c.LINK})),!0}},showSeparatorLeft:b})}return null}})}g.length&&g.push({type:"separator"})}if(u){var y=Vt(e);if(y.isAltTextEditorOpen)return Ai(m,{altTextValidator:d});g.push(Ii(t,e),{type:"separator"})}var w=[].concat(Er()(g),[{type:"button",appearance:"danger",icon:Sr.a,onMouseEnter:Object(Dr.b)(p,!0),onMouseLeave:Object(Dr.b)(p,!1),title:t.formatMessage(Mr.a.remove),onClick:Qi,testId:"media-toolbar-remove-button"}]);return Ji(Ji({},m),{},{items:w})}}(t,n,{providerFactory:r,allowResizing:vr.allowResizing,allowResizingInTables:vr.allowResizingInTables,allowAnnotation:vr.allowAnnotation,allowLinking:vr.allowLinking,allowAdvancedToolBarOptions:vr.allowAdvancedToolBarOptions,allowAltTextOnImages:vr.allowAltTextOnImages,altTextValidator:e&&e.altTextValidator})}}}}},yWSb:function(e,t,n){e.exports={banner:"banner--MWCHK",grid:"grid--1HNmF",chip:"chip--3hU4-"}}});